/**
 * Copyright (c) 2016 Sendbird DBA (Smile Family, Inc.)
 * Sendbird JavaScript SDK v3.0.132
 */

!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("axios"),require("form-data"),require("ws")):"function"==typeof define&&define.amd?define(["axios","form-data","ws"],n):(e=e||self).SendBird=n(e.axios,e.FormData,e.WebSocket)}(this,function(p,f,r){"use strict";function fe(e){return(fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function i(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,n,t){return n&&i(e.prototype,n),t&&i(e,t),e}function n(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t.push.apply(t,r)}return t}function g(i){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?n(Object(a),!0).forEach(function(e){var n,t,r;n=i,r=a[t=e],t in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(a,e))})}return i}function o(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&a(e,n)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,n){return(a=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function c(e,n,t){return(c=u()?Reflect.construct:function(e,n,t){var r=[null];r.push.apply(r,n);var i=new(Function.bind.apply(e,r));return t&&a(i,t.prototype),i}).apply(null,arguments)}function t(e){var r="function"==typeof Map?new Map:void 0;return(t=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return c(e,arguments,l(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),a(t,e)})(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(a){var s=u();return function(){var e,n,t,r=l(a);if(s){var i=l(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return n=this,!(t=e)||"object"!=typeof t&&"function"!=typeof t?d(n):t}}function _(e,n,t){return(_="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,n,t){var r=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=l(e)););return e}(e,n);if(r){var i=Object.getOwnPropertyDescriptor(r,n);return i.get?i.get.call(t):i.value}})(e,n,t||e)}function B(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],r=!0,i=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(t.push(s.value),!n||t.length!==n);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}return t}(e,n)||y(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,n){if(e){if("string"==typeof e)return m(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?m(e,n):void 0}}function m(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}p=p&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p,f=f&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;var ge=function(){function e(){v(this,e)}return s(e,null,[{key:"OS_VERSION",get:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"}},{key:"SDK_VERSION",get:function(){return"3.0.132"}},{key:"SDK_MAJOR_VERSION",get:function(){return e.SDK_VERSION.split(".")[0]}},{key:"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",get:function(){return 100}},{key:"INTERNAL_CALL",get:function(){return"ic"}}]),e}(),C={},E=new WeakMap,_e=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};v(this,t),E.set(this,"object"===fe(e)&&e?e:{})}return s(t,[{key:"get",value:function(e){return E.get(this)[e]}},{key:"set",value:function(e,n){E.get(this)[e]=n}},{key:"remove",value:function(e){var n=E.get(this);n.hasOwnProperty(e)&&delete n[e]}},{key:"container",get:function(){return E.get(this)}}],[{key:"create",value:function(e,n){return C[e]=new t(n),C[e]}},{key:"get",value:function(e){return e=e||Sn.getInstance()._iid,C[e]}}]),t}(),ye=function(){o(i,t(Error));var r=h(i);function i(e,n){var t;return v(this,i),(t=r.call(this,n)).name="SendBirdException",t.code=n||0,t.message=e,t}return s(i,null,[{key:"INVALID_INITIALIZATION",get:function(){return 800100}},{key:"CONNECTION_REQUIRED",get:function(){return 800101}},{key:"CONNECTION_CANCELED",get:function(){return 800102}},{key:"INVALID_PARAMETER",get:function(){return 800110}},{key:"NETWORK_ERROR",get:function(){return 800120}},{key:"NETWORK_ROUTING_ERROR",get:function(){return 800121}},{key:"MALFORMED_DATA",get:function(){return 800130}},{key:"MALFORMED_ERROR_DATA",get:function(){return 800140}},{key:"WRONG_CHANNEL_TYPE",get:function(){return 800150}},{key:"MARK_AS_READ_RATE_LIMIT_EXCEEDED",get:function(){return 800160}},{key:"QUERY_IN_PROGRESS",get:function(){return 800170}},{key:"ACK_TIMEOUT",get:function(){return 800180}},{key:"LOGIN_TIMEOUT",get:function(){return 800190}},{key:"WEBSOCKET_CONNECTION_CLOSED",get:function(){return 800200}},{key:"WEBSOCKET_CONNECTION_FAILED",get:function(){return 800210}},{key:"REQUEST_FAILED",get:function(){return 800220}},{key:"FILE_UPLOAD_CANCEL_FAILED",get:function(){return 800230}},{key:"REQUEST_CANCELED",get:function(){return 800240}},{key:"REQUEST_DUPLICATED",get:function(){return 800250}}]),i}(),U=function(){function e(){v(this,e),this.sessionKey=null,this.eKey=null}return s(e,[{key:"hasSession",value:function(){return!!this.sessionKey}}]),e}(),e={DEBUG:"debug",PRODUCTION:"production"},A=e.PRODUCTION,me=function(){function n(){v(this,n)}return s(n,null,[{key:"log",value:function(){var e;(e=console).log.apply(e,arguments)}},{key:"debug",value:function(){A===n.Mode.DEBUG&&n.log.apply(n,arguments)}},{key:"Mode",get:function(){return e}},{key:"mode",get:function(){return A},set:function(e){-1<Object.keys(n.Mode).map(function(e){return n.Mode[e]}).indexOf(e)&&(A=e)}}]),n}(),I={},pe=function(){function i(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};for(var t in v(this,i),this._iid=e,n){var r=n[t];"function"==typeof r&&(this[t]=this.getClonedClass(r))}I[e]=this}return s(i,[{key:"getClonedClass",value:function(t){var r=this._iid;return function(){o(n,t);var e=h(n);function n(){return v(this,n),e.apply(this,arguments)}return s(n,[{key:"_iid",get:function(){return r}}],[{key:"_iid",get:function(){return r}},{key:"_name",get:function(){return t.name}}]),n}()}}],[{key:"get",value:function(e){return e?I[e]:{}}}]),i}(),S=function(){function n(e){v(this,n),this.sb=e,this.pingTimer=null,this.pingTimeoutTimer=null}return s(n,[{key:"ping",value:function(){var e=this,n=pe.get(this.sb._iid).Command.bPing(),t=_e.get(this.sb._iid).container,r=t.wsAdapter,i=t.pongTimeout;r.ws.send(n),me.debug("PING"),this.pingTimeoutTimer=setTimeout(function(){me.debug("PING timeout"),e.stop(),r.ws.handler&&r.ws.handler.onError()},i)}},{key:"pong",value:function(){clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=null}},{key:"start",value:function(){var e=this,n=_e.get(this.sb._iid).container.pingInterval;this.stop(),this.ping(),this.pingTimer=setInterval(function(){e.ping()},n)}},{key:"stop",value:function(){clearInterval(this.pingTimer),this.pingTimer=null,clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=null}}]),n}();var N=[ye.CONNECTION_REQUIRED,ye.NETWORK_ERROR,ye.ACK_TIMEOUT,ye.WEBSOCKET_CONNECTION_CLOSED,ye.WEBSOCKET_CONNECTION_FAILED,ye.FILE_UPLOAD_CANCEL_FAILED,ye.REQUEST_CANCELED,500901,500910,900200],ve=function(){function e(){v(this,e)}return s(e,null,[{key:"deepEqual",value:function(e,n){if(e===n)return!0;var t=g({},e),r=g({},n);return(!t.messageId||!r.messageId||t.messageId===r.messageId)&&((!t.reqId||!r.reqId||t.reqId===r.reqId)&&(t.hasOwnProperty("messageId")&&delete t.messageId,t.hasOwnProperty("reqId")&&delete t.reqId,r.hasOwnProperty("messageId")&&delete r.messageId,r.hasOwnProperty("reqId")&&delete r.reqId,JSON.stringify(t)===JSON.stringify(r)))}},{key:"isResendableError",value:function(e){return 0<e&&0<=N.indexOf(e)}},{key:"isFile",value:function(e){var n="object"===fe(e)&&null!==e&&"string"==typeof e.name&&"string"==typeof e.uri&&"string"==typeof e.type;if(!n)if("undefined"==typeof window&&"undefined"!=typeof process){if("undefined"!=typeof Buffer)return e instanceof Buffer}else{if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return n}}]),e}(),k=function(){function t(e){if(v(this,t),this.fields={},e)for(var n in e)this.fields[n]={value:e[n]},ve.isFile(e[n])&&(this.fields[n].filename=e[n].name);this.internal=!1,this.upload={reqId:null,deleteRequest:null,progressHandler:null}}return s(t,[{key:"add",value:function(e,n,t){var r=2<arguments.length&&void 0!==t?t:null;this.fields[e]={value:n,filename:r}}},{key:"remove",value:function(e){this.fields.hasOwnProperty(e)&&delete this.fields[e]}},{key:"yield",value:function(){var e=!1;for(var n in this.fields)if(ve.isFile(this.fields[n].value)){e=!0;break}if(e){var t=new f;for(var r in this.fields){var i=this.fields[r];if(ve.isFile(i.value)){var a=i.value;a.filename||a.name?t.append(r,i.value,a.filename||a.name):a.data?t.append(r,i.value,i.data.name):t.append(r,i.value,"unnamed")}else t.append(r,i.value)}return t}var s={};for(var o in this.fields)s[o]=this.fields[o].value;return s}}]),t}(),R=200,M=400,T=function(){function A(e){v(this,A),this.sb=e,this.cls=pe.get(this.sb._iid)}return s(A,[{key:"checkRouting",value:function(e){if(this.sb.customApiHost&&this.sb.customWsHost)"function"==typeof e&&e(null,{apiHost:this.sb.customApiHost,wsHost:this.sb.customWsHost});else{var n=this.sb.getApplicationId();e(null,{apiHost:"https://api-".concat(n,".sendbird.com"),wsHost:"wss://ws-".concat(n,".sendbird.com")})}}},{key:"_buildUrl",value:function(e){var n=e.apiHost,t=e.url,r=e.params;return r&&r.internal?"".concat(n,"/v").concat(ge.SDK_MAJOR_VERSION,"/sdk").concat(t):"".concat(n,"/v").concat(ge.SDK_MAJOR_VERSION).concat(t)}},{key:"_createHeader",value:function(e){var n=0<arguments.length&&void 0!==e?e:{},t=n instanceof f&&"function"==typeof n.getHeaders?n.getHeaders():{},r=_e.get(this.sb._iid).container,i=r.appId,a=r.auth,s=r.extensions,o=r.getUserAgentWithExtensions;return t.SendBird="JS,".concat(ge.OS_VERSION,",").concat(ge.SDK_VERSION,",").concat(i),t["SB-User-Agent"]=encodeURIComponent(o(s)),a.sessionKey&&(t["Session-Key"]=a.sessionKey),t["Request-Sent-Timestamp"]=(new Date).getTime().toString(),t}},{key:"_createQuery",value:function(n,e){var t=1<arguments.length&&void 0!==e?e:{};try{var r=[];for(var i in t){var a=t[i];if(null!=a){var s="";s="object"===fe(a)?Array.isArray(a)?a.map(function(e){return encodeURIComponent(e)}).join(","):encodeURIComponent(JSON.stringify(a)):encodeURIComponent(a),r.push("".concat(i,"=").concat(s))}}return 0<r.length?"".concat(n,"?").concat(r.join("&")):n}catch(e){return me.debug("createWithEncodedGetParams is failed. - ",e),n}}},{key:"_parseError",value:function(e){if(e.isAbort||e.aborted)return new ye("Request has been canceled.",ye.REQUEST_CANCELED);try{var n=JSON.parse(e.responseText),t=n?n.message:"Request failed.",r=n?n.code:ye.REQUEST_FAILED;return new ye(t,r)}catch(e){return e instanceof ye?e:new ye("Request failed.",ye.REQUEST_FAILED)}}},{key:"get",value:function(a,s,o){var l=this;this.checkRouting(function(e,n){if(e)o(new ye("Request failed.",ye.REQUEST_FAILED),null);else{var t=l._buildUrl({apiHost:n.apiHost,url:a,params:s}),r=s?s.yield():{},i=l._createHeader(r);p.get(l._createQuery(t,r),{headers:i}).then(function(e){var n=e.status,t=e.data,r=e.request;if(R<=n&&n<M)o(null,t);else{var i=l._parseError(r);me.debug(i),o(i,null)}}).catch(function(e){me.debug(e),o(e,null)})}})}},{key:"dummyCall",value:function(a){var s=this;this.checkRouting(function(e,n){if(e)a(new ye("Request failed.",ye.REQUEST_FAILED),null);else{var t=n.apiHost,r=s._createHeader();p.get(s._createQuery(t),{headers:r}).then(function(e){var n=e.status,t=e.data,r=e.request;if(R<=n&&n<M)a(null,t);else{var i=s._parseError(r);me.debug(i),a(i,null)}}).catch(function(e){me.debug(e),a(e,null)})}})}},{key:"post",value:function(u,c,d){var h=this;this.checkRouting(function(e,n){if(e)d(new ye("Request failed.",ye.REQUEST_FAILED),null);else{var t=h._buildUrl({apiHost:n.apiHost,url:u,params:c}),r=c?c.yield():{},i=h._createHeader(r),a=null;if(r instanceof f){var s=p.CancelToken.source();a=s.token;var o=h.cls.FileMessageQueue,l=c.upload.reqId;l&&(o.uploadRequest[l]=s)}p.post(t,"function"==typeof r.getBuffer?r.getBuffer():r,{headers:i,cancelToken:a,onUploadProgress:function(e){c.upload.progressHandler&&c.upload.progressHandler(e,c.upload.reqId)}}).then(function(e){var n=e.status,t=e.data,r=e.request;if(R<=n&&n<M)"function"==typeof c.upload.deleteRequest&&c.upload.deleteRequest(),d(null,t);else{"function"==typeof c.upload.deleteRequest&&c.upload.deleteRequest();var i=h._parseError(r);me.debug(i),d(i,null)}}).catch(function(e){"function"==typeof c.upload.deleteRequest&&c.upload.deleteRequest(),me.debug(e),d(e,null)})}})}},{key:"put",value:function(a,s,o){var l=this;this.checkRouting(function(e,n){if(e)o(new ye("Request failed.",ye.REQUEST_FAILED),null);else{var t=l._buildUrl({apiHost:n.apiHost,url:a,params:s}),r=s?s.yield():{},i=l._createHeader(r);p.put(t,r,{headers:i}).then(function(e){var n=e.status,t=e.data,r=e.request;if(R<=n&&n<M)o(null,t);else{var i=l._parseError(r);me.debug(i),o(i,null)}}).catch(function(e){me.debug(e),o(e,null)})}})}},{key:"delete",value:function(a,s,o){var l=this;this.checkRouting(function(e,n){if(e)o(new ye("Request failed.",ye.REQUEST_FAILED),null);else{var t=l._buildUrl({apiHost:n.apiHost,url:a,params:s}),r=s?s.yield():{},i=l._createHeader(r);p.delete(l._createQuery(t,r),{headers:i}).then(function(e){var n=e.status,t=e.data,r=e.request;if(R<=n&&n<M)o(null,t);else{var i=l._parseError(r);me.debug(i),o(i,null)}}).catch(function(e){me.debug(e),o(e,null)})}})}},{key:"updateCurrentUserInfo",value:function(e,i){var a=this,s=e.nickname,o=e.profileUrl,l=e.profileImage,u=e.preferredLanguages;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_USERID.replace("%s",encodeURIComponent(n.userId)),r=new k;s&&r.add("nickname",s),o&&r.add("profile_url",o),l&&r.add("profile_file",l,l.name),u&&r.add("preferred_languages",u),a.put(t,r,i)}})}},{key:"getMyGroupChannelChangeLogs",value:function(e,i){var a=this,s=e.ts,o=e.token,l=e.customTypes,u=e.includeEmpty,c=e.includeFrozen;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_USERID_MY_GROUP_CHANNEL_CHANGELOGS.replace("%s",encodeURIComponent(n.userId)),r=new k({show_read_receipt:!0,show_delivery_receipt:!0,show_member:!0});o&&r.add("token",o),s&&r.add("change_ts",s),l&&0<l.length&&r.add("custom_types",l),"boolean"==typeof u&&r.add("show_empty",u),"boolean"==typeof c&&r.add("show_frozen",c),a.get(t,r,i)}})}},{key:"getChannelInvitationPreference",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.USERS_USERID_GROUP_CHANNEL_INVITATION_PREFERENCE.replace("%s",encodeURIComponent(n.userId));i.get(t,null,r)}})}},{key:"getGroupChannelCount",value:function(e,s){var o=this,l=e.memberStateFilter;this.sb.ConnectionManager.ready(function(e,n){if(e)s(e,null);else{var t=o.cls.GroupChannel,r=A.Path.USERS_USERID_GROUP_CHANNEL_COUNT.replace("%s",encodeURIComponent(n.userId)),i="";switch(l){case t.MemberStateFilter.JOINED:i="joined";break;case t.MemberStateFilter.INVITED:i="invited";break;case t.MemberStateFilter.INVITED_BY_FRIEND:i="invited_by_friend";break;case t.MemberStateFilter.INVITED_BY_NON_FRIEND:i="invited_by_non_friend";break;default:i="all"}var a=new k({state:i});o.get(r,a,s)}})}},{key:"getUnreadItemCount",value:function(e,i){var a=this,s=e.keys;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_USERID_UNREAD_ITEM_COUNT.replace("%s",encodeURIComponent(n.userId)),r=new k({item_keys:s});a.get(t,r,i)}})}},{key:"getTotalUnreadMessageCount",value:function(e,i){var a=this,s=e.customTypesFilter,o=e.superChannelFilter;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_USERID_UNREAD_MESSAGE_COUNT.replace("%s",encodeURIComponent(n.userId)),r=new k({super_mode:o});null!==s&&0<s.length&&r.add("custom_types",s),a.get(t,r,i)}})}},{key:"getTotalUnreadChannelCount",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.USERS_USERID_UNREAD_CHANNEL_COUNT.replace("%s",encodeURIComponent(n.userId));i.get(t,null,r)}})}},{key:"searchMessages",value:function(e,i){var a=this,s=e.keyword,o=e.limit,l=e.reverse,u=e.exactMatch,c=e.channelUrl,d=e.channelCustomType,h=e.messageTimestampFrom,p=e.messageTimestampTo,f=e.order,g=e.nextToken;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.SEARCH_MESSAGE,r=new k({limit:o,reverse:l,query:s,custom_type:d});h&&r.add("message_ts_from",h),p&&r.add("message_ts_to",p),c&&r.add("channel_url",c),f&&r.add("sort_field",f),"boolean"==typeof u&&r.add("exact_match",u),null!==g&&0<g.length&&r.add("after",g),a.get(t,r,i)}})}},{key:"markAsReadAll",value:function(e,i){var a=this,s=e.channelUrls;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_USERID_MARKASREADALL.replace("%s",encodeURIComponent(n.userId)),r=new k;s&&r.add("channel_urls",s),a.put(t,r,i)}})}},{key:"markAsDelivered",value:function(e,i){var a=this,s=e.channelUrl,o=e.userId;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MARKASDELIVERED.replace("%s",encodeURIComponent(s)),r=new k;o&&r.add("user_id",o),a.put(t,r,i)}})}},{key:"setChannelInvitationPreference",value:function(e,i){var a=this,s=e.isAutoAccept;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_USERID_GROUP_CHANNEL_INVITATION_PREFERENCE.replace("%s",encodeURIComponent(n.userId)),r=new k({auto_accept:s});a.put(t,r,i)}})}},{key:"blockUser",value:function(e,i){var a=this,s=e.blockedUserId;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_USERID_BLOCK.replace("%s",encodeURIComponent(n.userId)),r=new k({target_id:s});a.post(t,r,i)}})}},{key:"unblockUser",value:function(e,r){var i=this,a=e.unblockedUserId;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.USERS_USERID_BLOCK_TARGETID.replace("%s",encodeURIComponent(n.userId)).replace("%s",encodeURIComponent(a));i.delete(t,null,r)}})}},{key:"getPushTriggerOption",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(n.userId));i.get(t,null,r)}})}},{key:"setPushTriggerOption",value:function(e,i){var a=this,s=e.pushTriggerOption;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(n.userId)),r=new k({push_trigger_option:s});a.put(t,r,i)}})}},{key:"getPushTokens",value:function(e,i){var a=this,s=e.ts,o=e.token,l=e.type;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_USERID_PUSH_DEVICE_TOKENS.replace("%s",encodeURIComponent(n.userId)).replace("%s",encodeURIComponent(l)),r=new k;o&&r.add("token",o),s&&r.add("created_ts",s),a.get(t,r,i)}})}},{key:"getPushTemplate",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.USERS_USERID_PUSH_TEMPLATE.replace("%s",encodeURIComponent(n.userId));i.get(t,null,r)}})}},{key:"setPushTemplate",value:function(e,i){var a=this,s=e.templateName;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_USERID_PUSH_TEMPLATE.replace("%s",encodeURIComponent(n.userId)),r=new k({name:s});a.put(t,r,i)}})}},{key:"getDoNotDisturb",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(n.userId));i.get(t,null,r)}})}},{key:"setDoNotDisturb",value:function(e,i){var a=this,s=e.doNotDisturbOn,o=e.startHour,l=e.startMin,u=e.endHour,c=e.endMin,d=e.timezone;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(n.userId)),r=new k({do_not_disturb:s,start_hour:o,start_min:l,end_hour:u,end_min:c,timezone:d});a.put(t,r,i)}})}},{key:"getSnoozePeriod",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(n.userId));i.get(t,null,r)}})}},{key:"setSnoozePeriod",value:function(e,i){var a=this,s=e.snoozeOn,o=e.startTs,l=e.endTs;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(n.userId)),r=new k({snooze_enabled:s,snooze_start_ts:o,snooze_end_ts:l});a.put(t,r,i)}})}},{key:"registerGCMPushToken",value:function(e,i){var a=this,s=e.token;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_USERID_PUSH_GCM.replace("%s",encodeURIComponent(n.userId)),r=new k({gcm_reg_token:s,always_push:!0});a.post(t,r,i)}})}},{key:"unregisterGCMPushToken",value:function(e,r){var i=this,a=e.token;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.USERS_USERID_PUSH_GCM_TOKEN.replace("%s",encodeURIComponent(n.userId)).replace("%s",encodeURIComponent(a));i.delete(t,null,r)}})}},{key:"unregisterAllGCMPushTokens",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.USERS_USERID_PUSH_GCM.replace("%s",encodeURIComponent(n.userId));i.delete(t,null,r)}})}},{key:"registerAPNSPushToken",value:function(e,i){var a=this,s=e.token;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_USERID_PUSH_APNS.replace("%s",encodeURIComponent(n.userId)),r=new k({apns_device_token:s,always_push:!0});a.post(t,r,i)}})}},{key:"unregisterAPNSPushToken",value:function(e,r){var i=this,a=e.token;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.USERS_USERID_PUSH_APNS_TOKEN.replace("%s",encodeURIComponent(n.userId)).replace("%s",encodeURIComponent(a));i.delete(t,null,r)}})}},{key:"unregisterAllAPNSPushTokens",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.USERS_USERID_PUSH_APNS.replace("%s",encodeURIComponent(n.userId));i.delete(t,null,r)}})}},{key:"unregisterAllPushTokens",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.USERS_USERID_PUSH.replace("%s",encodeURIComponent(n.userId));i.delete(t,null,r)}})}},{key:"loadFriendList",value:function(e,i){var a=this,s=e.token,o=e.limit;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.FRIENDS.replace("%s",encodeURIComponent(n.userId)),r=new k({limit:o,token:s});a.get(t,r,i)}})}},{key:"getFriendChangeLogsByToken",value:function(e,i){var a=this,s=e.token;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.FRIENDS_CHANGE_LOGS.replace("%s",encodeURIComponent(n.userId)),r=new k;s&&r.add("token",s),a.get(t,r,i)}})}},{key:"addFriends",value:function(e,i){var a=this,s=e.userIds;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.FRIENDS.replace("%s",encodeURIComponent(n.userId)),r=new k({user_ids:s});a.post(t,r,i)}})}},{key:"deleteFriends",value:function(e,i){var a=this,s=e.userIds;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.FRIENDS.replace("%s",encodeURIComponent(n.userId)),r=new k({user_ids:s});a.delete(t,r,i)}})}},{key:"uploadFriendDiscoveries",value:function(e,a){var s=this,o=e.discoveries;this.sb.ConnectionManager.ready(function(e,n){if(e)a(e,null);else{var t=A.Path.FRIENDS_DISCOVERIES.replace("%s",encodeURIComponent(n.userId)),r=[];o.forEach(function(e){r.push({friend_discovery_key:e.friendDiscoveryKey,friend_name:"string"==typeof e.friendName||e.friendName?e.friendName:null})});var i=new k({friend_discoveries:r});s.put(t,i,a)}})}},{key:"deleteFriendDiscoveries",value:function(e,i){var a=this,s=e.discoveryKeys;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.FRIENDS_DISCOVERIES.replace("%s",encodeURIComponent(n.userId)),r=new k({friend_discovery_keys:s});a.delete(t,r,i)}})}},{key:"loadUserList",value:function(e,i){var a=this,s=e.token,o=e.limit,l=e.userIdsFilter,u=e.metaDataKeyFilter,c=e.metaDataValuesFilter;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS,r=new k({token:s,limit:o});l&&0<l.length&&r.add("user_ids",l),u&&c&&0<c.length&&(r.add("metadatakey",u),r.add("metadatavalues_in",c)),a.get(t,r,i)}})}},{key:"loadBlockedUserList",value:function(e,i){var a=this,s=e.token,o=e.limit,l=e.userIdsFilter;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_USERID_BLOCK.replace("%s",encodeURIComponent(n.userId)),r=new k({token:s,limit:o});l&&0<l.length&&r.add("user_ids",l),a.get(t,r,i)}})}},{key:"createUserMetaData",value:function(e,i){var a=this,s=e.metaData;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_USERID_METADATA.replace("%s",encodeURIComponent(n.userId)),r=new k({metadata:s});a.post(t,r,i)}})}},{key:"updateUserMetaData",value:function(e,i){var a=this,s=e.metaData,o=e.upsert;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_USERID_METADATA.replace("%s",encodeURIComponent(n.userId)),r=new k({metadata:s,upsert:o});a.put(t,r,i)}})}},{key:"deleteUserMetaData",value:function(e,r){var i=this,a=e.metaDataKey;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.USERS_USERID_METADATA_KEY.replace("%s",encodeURIComponent(n.userId)).replace("%s",encodeURIComponent(a));i.delete(t,null,r)}})}},{key:"deleteAllUserMetaData",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.USERS_USERID_METADATA.replace("%s",encodeURIComponent(n.userId));i.delete(t,null,r)}})}},{key:"getMessageChangeLogs",value:function(e,i){var a=this,s=e.channelUrl,o=e.ts,l=e.timestamp,u=e.token,c=e.isOpenChannel,d=e.includeMetaArray,h=e.includeReactions,p=e.includeReplies,f=e.includeParentMessageText,g=e.includeThreadInfo;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=c?A.Path.OPENCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS.replace("%s",encodeURIComponent(s)):A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS.replace("%s",encodeURIComponent(s)),r=new k;u&&r.add("token",u),o&&r.add("change_ts",o),l&&r.add("change_ts",l),"boolean"==typeof d&&r.add("with_sorted_meta_array",d),"boolean"==typeof h&&r.add("include_reactions",h),"boolean"==typeof p&&r.add("include_replies",p),"boolean"==typeof f&&r.add("include_parent_text_message",f),"boolean"==typeof g&&r.add("include_thread_info",g),a.get(t,r,i)}})}},{key:"getMyMutedInfo",value:function(e,r){var i=this,a=e.channelUrl,s=e.userId,o=e.isGroupChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=o?A.Path.GROUPCHANNELS_CHANNELURL_MUTE_USERID.replace("%s",encodeURIComponent(a)).replace("%s",encodeURIComponent(s)):A.Path.OPENCHANNELS_CHANNELURL_MUTE_USERID.replace("%s",encodeURIComponent(a)).replace("%s",encodeURIComponent(s));i.get(t,null,r)}})}},{key:"loadBannedUserList",value:function(e,i){var a=this,s=e.token,o=e.limit,l=e.channelUrl,u=e.isOpenChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=u?A.Path.OPENCHANNELS_CHANNELURL_BAN.replace("%s",encodeURIComponent(l)):A.Path.GROUPCHANNELS_CHANNELURL_BAN.replace("%s",encodeURIComponent(l)),r=new k({token:s,limit:o});a.get(t,r,i)}})}},{key:"loadMutedUserList",value:function(e,i){var a=this,s=e.token,o=e.limit,l=e.channelUrl,u=e.isOpenChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=u?A.Path.OPENCHANNELS_CHANNELURL_MUTE.replace("%s",encodeURIComponent(l)):A.Path.GROUPCHANNELS_CHANNELURL_MUTE.replace("%s",encodeURIComponent(l)),r=new k({token:s,limit:o});a.get(t,r,i)}})}},{key:"getMessageList",value:function(e,i){var a=this,s=e.channel,o=e.token,l=e.tokenType,u=e.isInclusive,n=e.prevResultSize,c=void 0===n?0:n,t=e.nextResultSize,d=void 0===t?0:t,h=e.shouldReverse,p=e.messageType,f=e.customType,g=e.senderUserIds,_=e.includeMetaArray,y=e.includeReactions,m=e.includeThreadInfo,v=e.includeReplies,C=e.includeParentMessageText,E=e.rootMessageId,U=e.parentMessageId;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=s.isOpenChannel()?A.Path.OPENCHANNELS_CHANNELURL_MESSAGES.replace("%s",s.url):A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES.replace("%s",s.url),r=new k({is_sdk:String(!0),prev_limit:String(c),next_limit:String(d),include:String(u),reverse:String(h)});"timestamp"===l?r.add("message_ts",o):"messageId"===l&&r.add("message_id",String(o)),p&&r.add("message_type",String(p)),f&&r.add("custom_type",String(f)),Array.isArray(g)&&0<g.length&&r.add("sender_ids",g),"boolean"==typeof _&&r.add("with_sorted_meta_array",_),"boolean"==typeof y&&r.add("include_reactions",y),"boolean"==typeof m&&r.add("include_thread_info",m),"boolean"==typeof v&&r.add("include_replies",v),"boolean"==typeof C&&r.add("include_parent_message_text",C),E&&r.add("root_message_id",E),U&&r.add("parent_message_id",U),a.get(t,r,i)}})}},{key:"translateUserMessage",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,l=e.messageId,u=e.translationTargetLanguages;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=o?A.Path.OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_TRANSLATION.replace("%s",encodeURIComponent(s)).replace("%s",l):A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_TRANSLATION.replace("%s",encodeURIComponent(s)).replace("%s",l),r=new k({target_langs:u});a.post(t,r,i)}})}},{key:"getMessage",value:function(e,r){var i=this,a=e.channel,s=e.messageId;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=a.isOpenChannel()?A.Path.OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID.replace("%s",encodeURIComponent(a.url)).replace("%s",encodeURIComponent(s)):A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID.replace("%s",encodeURIComponent(a.url)).replace("%s",encodeURIComponent(s));i.get(t,null,r)}})}},{key:"deleteMessage",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel,o=e.messageId;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=s?A.Path.OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID.replace("%s",encodeURIComponent(a)).replace("%s",encodeURIComponent(o)):A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID.replace("%s",encodeURIComponent(a)).replace("%s",encodeURIComponent(o));i.delete(t,null,r)}})}},{key:"muteUser",value:function(e,i){var a=this,s=e.channelUrl,o=e.userId,l=e.description,u=e.seconds,c=e.isGroupChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=c?A.Path.GROUPCHANNELS_CHANNELURL_MUTE.replace("%s",encodeURIComponent(s)):A.Path.OPENCHANNELS_CHANNELURL_MUTE.replace("%s",encodeURIComponent(s)),r=new k({user_id:o});u&&(0<u||-1!==u)&&r.add("seconds",u),l&&r.add("description",l),a.post(t,r,i)}})}},{key:"unmuteUser",value:function(e,r){var i=this,a=e.channelUrl,s=e.userId,o=e.isGroupChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=o?A.Path.GROUPCHANNELS_CHANNELURL_MUTE_USERID.replace("%s",encodeURIComponent(a)).replace("%s",encodeURIComponent(s)):A.Path.OPENCHANNELS_CHANNELURL_MUTE_USERID.replace("%s",encodeURIComponent(a)).replace("%s",encodeURIComponent(s));i.delete(t,null,r)}})}},{key:"banUser",value:function(e,i){var a=this,s=e.channelUrl,o=e.userId,l=e.description,u=e.seconds,c=e.isGroupChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=c?A.Path.GROUPCHANNELS_CHANNELURL_BAN.replace("%s",encodeURIComponent(s)):A.Path.OPENCHANNELS_CHANNELURL_BAN.replace("%s",encodeURIComponent(s)),r=new k({user_id:o});l&&r.add("description",l),r.add("seconds",String(u)),a.post(t,r,i)}})}},{key:"unbanUser",value:function(e,r){var i=this,a=e.channelUrl,s=e.userId,o=e.isGroupChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=o?A.Path.GROUPCHANNELS_CHANNELURL_BAN_USERID.replace("%s",encodeURIComponent(a)).replace("%s",encodeURIComponent(s)):A.Path.OPENCHANNELS_CHANNELURL_BAN_USERID.replace("%s",encodeURIComponent(a)).replace("%s",encodeURIComponent(s));i.delete(t,null,r)}})}},{key:"getMetaCounters",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,l=e.keys;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=o?A.Path.OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(s)):A.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(s)),r=new k({keys:l});a.get(t,r,i)}})}},{key:"createMetaCounters",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,l=e.metaCounter;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=o?A.Path.OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(s)):A.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(s)),r=new k({metacounter:l});a.post(t,r,i)}})}},{key:"updateMetaCounters",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,l=e.metaCounter,u=e.upsert,c=e.mode;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=o?A.Path.OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(s)):A.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(s)),r=new k({metacounter:l,upsert:u,mode:c});a.put(t,r,i)}})}},{key:"deleteMetaCounter",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel,o=e.key;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=s?A.Path.OPENCHANNELS_CHANNELURL_METACOUNTER_KEY.replace("%s",encodeURIComponent(a)).replace("%s",o):A.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER_KEY.replace("%s",encodeURIComponent(a)).replace("%s",o);i.delete(t,null,r)}})}},{key:"deleteAllMetaCounters",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=s?A.Path.OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(a)):A.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(a));i.delete(t,null,r)}})}},{key:"getMetaData",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,l=e.keys;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=o?A.Path.OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(s)):A.Path.GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(s)),r=new k({keys:l});a.get(t,r,i)}})}},{key:"createMetaData",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,l=e.metaData;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=o?A.Path.OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(s)):A.Path.GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(s)),r=new k({metadata:l});a.post(t,r,i)}})}},{key:"updateMetaData",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,l=e.metaData,u=e.upsert;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=o?A.Path.OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(s)):A.Path.GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(s)),r=new k({metadata:l,upsert:u});a.put(t,r,i)}})}},{key:"deleteMetaData",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel,o=e.key;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=s?A.Path.OPENCHANNELS_CHANNELURL_METADATA_KEY.replace("%s",encodeURIComponent(a)).replace("%s",o):A.Path.GROUPCHANNELS_CHANNELURL_METADATA_KEY.replace("%s",encodeURIComponent(a)).replace("%s",o);i.delete(t,null,r)}})}},{key:"deleteAllMetaData",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=s?A.Path.OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(a)):A.Path.GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(a));i.delete(t,null,r)}})}},{key:"loadOperatorList",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,l=e.token,u=e.limit;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=o?A.Path.OPENCHANNELS_OPERATORS.replace("%s",encodeURIComponent(s)):A.Path.GROUPCHANNELS_OPERATORS.replace("%s",encodeURIComponent(s)),r=new k({token:l,limit:u});a.get(t,r,i)}})}},{key:"getOpenChannel",value:function(e,i){var a=this,s=e.channelUrl,o=e.internalCall;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.OPENCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(s)),r=new k({});r.internal=o===ge.INTERNAL_CALL,a.get(t,r,i)}})}},{key:"loadOpenChannelList",value:function(e,i){var a=this,s=e.token,o=e.limit,l=e.nameKeyword,u=e.urlKeyword,c=e.customTypes,d=e.includeFrozen;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.OPENCHANNELS,r=new k({token:s,limit:o});l&&r.add("name_contains",l),u&&r.add("url_contains",u),c&&0<c.length&&r.add("custom_types",c),"boolean"==typeof d&&r.add("show_frozen",d),a.get(t,r,i)}})}},{key:"loadParticipantList",value:function(e,i){var a=this,s=e.token,o=e.limit,l=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.OPENCHANNELS_CHANNELURL_PARTICIPANTS.replace("%s",encodeURIComponent(l)),r=new k({token:s,limit:o});a.get(t,r,i)}})}},{key:"createOpenChannel",value:function(e,i){var a=this,s=e.name,o=e.coverUrlOrImage,l=e.data,u=e.operatorUserIds,c=e.customType;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.OPENCHANNELS,r=new k;"string"==typeof o&&r.add("cover_url",o),ve.isFile(o)&&r.add("cover_file",o),null!==s&&"string"==typeof s&&r.add("name",s),l&&r.add("data",l),u&&(Array.isArray(u)?r.add("operators",u):r.add("operators",[u])),c&&r.add("custom_type",c),a.post(t,r,i)}})}},{key:"updateOpenChannel",value:function(e,i){var a=this,s=e.channelUrl,o=e.name,l=e.coverUrlOrImage,u=e.data,c=e.operatorUserIds,d=e.customType;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.OPENCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(s)),r=new k;"string"==typeof l&&r.add("cover_url",l),ve.isFile(l)&&r.add("cover_file",l,l.name),null!==o&&"string"==typeof o&&r.add("name",o),null!==u&&"string"==typeof u&&r.add("data",u),null!==c&&(Array.isArray(c)?r.add("operator_ids",c):r.add("operator_ids",[c])),null!==d&&"string"==typeof d&&r.add("custom_type",d),a.put(t,r,i)}})}},{key:"deleteOpenChannel",value:function(e,r){var i=this,a=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.OPENCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(a));i.delete(t,null,r)}})}},{key:"getGroupChannel",value:function(e,i){var a=this,s=e.channelUrl,o=e.showMember,l=e.internalCall;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.GROUPCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(s)),r=new k({show_member:o,show_read_receipt:!0,show_delivery_receipt:!0});r.internal=l===ge.INTERNAL_CALL,a.get(t,r,i)}})}},{key:"loadGroupChannelList",value:function(e,i){var a=this,s=e.token,o=e.limit,l=e.includeEmpty,u=e.order,c=e.userIdsFilter,d=e.nicknameContainsFilter,h=e.channelNameContainsFilter,p=e.channelUrlsFilter,f=e.customTypesFilter,g=e.customTypeStartsWithFilter,_=e.memberStateFilter,y=e.superChannelFilter,m=e.publicChannelFilter,v=e.unreadChannelFilter,C=e.metadataOrderKeyFilter,E=e.hiddenChannelFilter,U=e.searchFilter,b=e.includeFrozen;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.MYGROUPCHANNELS.replace("%s",encodeURIComponent(n.userId)),r=new k({token:s,limit:o,order:u,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:String(l),member_state_filter:_});f&&0<f.length&&r.add("custom_types",f),d&&r.add("members_nickname_contains",d),h&&r.add("name_contains",h),U.hasOwnProperty("search_query")&&U.hasOwnProperty("search_fields")&&(r.add("search_query",U.search_query),r.add("search_fields",U.search_fields)),c.userIds&&0<c.userIds.length&&(c.includeMode?(r.add("members_include_in",c.userIds),r.add("query_type",c.queryType.toUpperCase())):r.add("members_exactly_in",c.userIds)),p&&0<p.length&&r.add("channel_urls",p),r.add("super_mode",y),r.add("public_mode",m),r.add("unread_filter",v),C&&r.add("metadata_order_key",C),g&&r.add("custom_type_startswith",g),E&&r.add("hidden_mode",E),"boolean"==typeof b&&r.add("show_frozen",b),a.get(t,r,i)}})}},{key:"loadPublicGroupChannelList",value:function(e,a){var s=this,o=e.token,l=e.limit,u=e.includeEmpty,c=e.order,d=e.channelNameContainsFilter,h=e.channelUrlsFilter,p=e.customTypesFilter,f=e.customTypeStartsWithFilter,g=e.superChannelFilter,_=e.membershipFilter,y=e.metadataOrderKeyFilter,m=e.includeFrozen;this.sb.ConnectionManager.ready(function(e,n){if(e)a(e,null);else{var t=s.cls.GroupChannel,r=A.Path.GROUPCHANNELS,i=new k({token:o,limit:l,order:c,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:String(u),public_mode:t.PublicChannelFilter.PUBLIC,public_membership_mode:_});p&&0<p.length&&i.add("custom_types",p),d&&i.add("name_contains",d),h&&0<h.length&&i.add("channel_urls",h),i.add("super_mode",g),y&&i.add("metadata_order_key",y),f&&i.add("custom_type_startswith",f),"boolean"==typeof m&&i.add("show_frozen",m),s.get(r,i,a)}})}},{key:"createGroupChannel",value:function(e,i){var a=this,s=e.isDistinct,o=e.isSuper,l=e.isBroadcast,u=e.isPublic,c=e.channelUrl,d=e.isDiscoverable,h=e.isStrict,p=e.name,f=e.data,g=e.customType,_=e.coverUrl,y=e.coverImage,m=e.accessCode,v=e.isEphemeral,n=e._invitedUserIds,C=void 0===n?[]:n,E=e.operatorUserIds,U=e.messageSurvivalSeconds;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.GROUPCHANNELS,r=new k({user_ids:[n.userId].concat(b(C)).filter(function(e,n,t){return n===t.indexOf(e)})});null!==_&&"string"==typeof _&&r.add("cover_url",_),ve.isFile(y)&&r.add("cover_file",y,y.name),null!==c&&r.add("channel_url",c),null!==s&&r.add("is_distinct",s),null!==o&&r.add("is_super",o),null!==l&&r.add("is_broadcast",l),null!==u&&r.add("is_public",u),null!==d&&r.add("is_discoverable",d),null!==h&&r.add("strict",h),null!==v&&r.add("is_ephemeral",v),m&&r.add("access_code",m),null!==p&&"string"==typeof p&&r.add("name",p),f&&r.add("data",f),g&&r.add("custom_type",g),Array.isArray(E)&&0<E.length&&r.add("operator_ids",E),null!==U&&-1<U&&r.add("message_survival_seconds",U),a.post(t,r,i)}})}},{key:"updateGroupChannel",value:function(e,i){var a=this,s=e.isDistinct,o=e.isPublic,l=e.channelUrl,u=e.isDiscoverable,c=e.name,d=e.data,h=e.customType,p=e.coverUrl,f=e.coverImage,g=e.accessCode,_=e.operatorUserIds,y=e.messageSurvivalSeconds;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.GROUPCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(l)),r=new k;null!==s&&r.add("is_distinct",s),null!==o&&r.add("is_public",o),null!==u&&r.add("is_discoverable",u),null!==g&&r.add("access_code",g),null!==p&&"string"==typeof p&&r.add("cover_url",p),ve.isFile(f)&&r.add("cover_file",f,f.name),null!==c&&"string"==typeof c&&r.add("name",c),null!==d&&"string"==typeof d&&r.add("data",d),null!==h&&"string"==typeof h&&r.add("custom_type",h),null!==_&&(Array.isArray(_)?r.add("operator_ids",_):_&&r.add("operator_ids",[_])),null!==y&&-1<y&&r.add("message_survival_seconds",y),a.put(t,r,i)}})}},{key:"addOperators",value:function(e,i){var a=this,s=e.channelUrl,n=e.isOpenChannel,o=void 0!==n&&n,l=e.operatorUserIds;this.sb.ConnectionManager.ready(function(e,n){if(!e){var t=(o?A.Path.OPENCHANNELS_CHANNELURL_OPERATORS:A.Path.GROUPCHANNELS_CHANNELURL_OPERATORS).replace("%s",encodeURIComponent(s)),r=new k({operator_ids:l});a.post(t,r,i)}})}},{key:"removeOperators",value:function(e,i){var a=this,s=e.channelUrl,n=e.isOpenChannel,o=void 0!==n&&n,l=e.operatorUserIds;this.sb.ConnectionManager.ready(function(e,n){if(!e){var t=(o?A.Path.OPENCHANNELS_CHANNELURL_OPERATORS:A.Path.GROUPCHANNELS_CHANNELURL_OPERATORS).replace("%s",encodeURIComponent(s)),r=new k({operator_ids:l});a.delete(t,r,i)}})}},{key:"inviteToGroupChannel",value:function(e,i){var a=this,s=e.channelUrl,o=e.userIds;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.GROUPCHANNELS_CHANNELURL_INVITE.replace("%s",encodeURIComponent(s)),r=new k({user_ids:o});a.post(t,r,i)}})}},{key:"acceptInvitation",value:function(e,i){var a=this,s=e.channelUrl,o=e.accessCode;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.GROUPCHANNELS_CHANNELURL_ACCEPT_INVITATION.replace("%s",encodeURIComponent(s)),r=new k({user_id:n.userId});o&&r.add("access_code",o),a.put(t,r,i)}})}},{key:"declineInvitation",value:function(e,i){var a=this,s=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.GROUPCHANNELS_CHANNELURL_DECLINE_INVITATION.replace("%s",encodeURIComponent(s)),r=new k({user_id:n.userId});a.put(t,r,i)}})}},{key:"joinGroupChannel",value:function(e,i){var a=this,s=e.channelUrl,o=e.accessCode;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.GROUPCHANNELS_CHANNELURL_JOIN.replace("%s",encodeURIComponent(s)),r=new k({user_id:n.userId});o&&r.add("access_code",o),a.put(t,r,i)}})}},{key:"leaveGroupChannel",value:function(e,i){var a=this,s=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.GROUPCHANNELS_CHANNELURL_LEAVE.replace("%s",encodeURIComponent(s)),r=new k({user_id:n.userId});a.put(t,r,i)}})}},{key:"hideGroupChannel",value:function(e,i){var a=this,s=e.channelUrl,o=e.hidePreviousMessages,l=e.allowAutoUnhide;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.GROUPCHANNELS_CHANNELURL_HIDE.replace("%s",encodeURIComponent(s)),r=new k({user_id:n.userId,hide_previous_messages:o,allow_auto_unhide:l});a.put(t,r,i)}})}},{key:"unhideGroupChannel",value:function(e,r){var i=this,a=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.GROUPCHANNELS_CHANNELURL_HIDE.replace("%s",encodeURIComponent(a));i.delete(t,null,r)}})}},{key:"freeze",value:function(e,i){var a=this,s=e.channelUrl,o=e.isGroupChannel,l=e.freezing;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=o?A.Path.GROUPCHANNELS_CHANNELURL_FREEZE.replace("%s",encodeURIComponent(s)):A.Path.OPENCHANNELS_CHANNELURL_FREEZE.replace("%s",encodeURIComponent(s)),r=new k({freeze:l});a.put(t,r,i)}})}},{key:"deleteGroupChannel",value:function(e,r){var i=this,a=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.GROUPCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(a));i.delete(t,null,r)}})}},{key:"loadMemberList",value:function(e,i){var a=this,s=e.channelUrl,o=e.token,l=e.limit,u=e.mutedMemberFilter,c=e.order,d=e.memberStateFilter,h=e.nicknameStartsWithFilter;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.GROUPCHANNELS_MEMBERS.replace("%s",encodeURIComponent(s)),r=new k({token:o,limit:l,order:c.toLowerCase(),muted_member_filter:u.toLowerCase(),member_state_filter:d,show_member_is_muted:!0,show_read_receipt:!0,show_delivery_receipt:!0});h&&r.add("nickname_startswith",h),a.get(t,r,i)}})}},{key:"report",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,l=e.reportCategory,u=e.reportingUserId,c=e.reportDescription;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.REPORT_CHANNELS.replace("%s",encodeURIComponent(o?"open_channels":"group_channels")).replace("%s",encodeURIComponent(s)),r=new k({report_category:l});null!=u&&r.add("reporting_user_id",u),null!=c&&r.add("report_description",c),a.post(t,r,i)}})}},{key:"reportUser",value:function(e,i){var a=this,s=e.offendingUserId,o=e.channelUrl,l=e.isOpenChannel,u=e.reportCategory,c=e.reportingUserId,d=e.reportDescription;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.REPORT_USERS.replace("%s",encodeURIComponent(s)),r=new k({channel_url:o,channel_type:l?"open_channels":"group_channels",report_category:u});null!=c&&r.add("reporting_user_id",c),null!=d&&r.add("report_description",d),a.post(t,r,i)}})}},{key:"reportMessage",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,l=e.messageId,u=e.reportCategory,c=e.reportingUserId,d=e.reportDescription,h=e.offendingUserId;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.REPORT_MESSAGES.replace("%s",encodeURIComponent(o?"open_channels":"group_channels")).replace("%s",encodeURIComponent(s)).replace("%s",encodeURIComponent(l)),r=new k({report_category:u,offending_user_id:h});null!=c&&r.add("reporting_user_id",c),null!=d&&r.add("report_description",d),a.post(t,r,i)}})}},{key:"sendUserMessage",value:function(e,a){var s=this,o=e.channelUrl,l=e.isOpenChannel,u=e.message,c=e.data,d=e.customType,h=e.translationTargetLanguages,p=e.metaArrays,f=e.mentionType,g=e.mentionedUserIds,_=e.pushNotificationDeliveryOption,y=e.rootMessageId,m=e.parentMessageId;this.sb.ConnectionManager.ready(function(e,n){if(e)a(e,null);else{var t=s.cls.FileMessageParams,r=l?A.Path.OPENCHANNELS_CHANNELURL_MESSAGES.replace("%s",encodeURIComponent(o)):A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES.replace("%s",encodeURIComponent(o)),i=new k({message_type:"MESG",user_id:n.userId,message:u,mention_type:f,mentioned_user_ids:[]});null!=c&&i.add("data",c),null!=d&&i.add("custom_type",d),h&&i.add("translation_target_langs",h),p&&0<p.length&&i.add("sorted_metaarray",p.map(function(e){return e.encode()})),f===s.cls.BaseMessageParams.MentionType.CHANNEL?i.add("mentioned_user_ids",[]):Array.isArray(g)&&0<g.length&&i.add("mentioned_user_ids",g),_&&_!==t.PushNotificationDeliveryOption.DEFAULT&&i.add("push_option",_),y&&i.add("root_message_id",y),m&&i.add("parent_message_id",m),s.post(r,i,a)}})}},{key:"sendFileMessage",value:function(e,a){var s=this,o=e.channelUrl,l=e.isOpenChannel,u=e.fileUrl,c=e.fileName,d=e.fileSize,h=e.fileType,p=e.data,f=e.customType,g=e.thumbnailSizes,_=e.requireAuth,y=e.metaArrays,m=e.mentionType,v=e.mentionedUserIds,C=e.pushNotificationDeliveryOption,E=e.rootMessageId,U=e.parentMessageId;this.sb.ConnectionManager.ready(function(e,n){if(e)a(e,null);else{var t=s.cls.FileMessageParams,r=l?A.Path.OPENCHANNELS_CHANNELURL_MESSAGES.replace("%s",encodeURIComponent(o)):A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES.replace("%s",encodeURIComponent(o)),i=new k({message_type:"FILE",user_id:n.userId,url:u,mention_type:m,mentioned_user_ids:[]});null!=c&&i.add("file_name",c),null!=d&&i.add("file_size",d),null!=h&&i.add("file_type",h),null!=p&&i.add("custom_field",p),null!=f&&i.add("custom_type",f),g&&i.add("thumbnails",g),_&&i.add("require_auth",_),y&&0<y.length&&i.add("sorted_metaarray",y.map(function(e){return e.encode()})),m===s.cls.BaseMessageParams.MentionType.CHANNEL?i.add("mentioned_user_ids",[]):Array.isArray(v)&&0<v.length&&i.add("mentioned_user_ids",v),C&&C!==t.PushNotificationDeliveryOption.DEFAULT&&i.add("push_option",C),E&&i.add("root_message_id",E),U&&i.add("parent_message_id",U),s.post(r,i,a)}})}},{key:"uploadFile",value:function(e,a){var s=this,o=e.file,l=e.thumbnailSizes,u=e.channelUrl,c=e.progressHandler,d=e.reqId;this.sb.ConnectionManager.ready(function(e,n){if(e)a(e,null);else{var t=A.Path.STORAGE_FILE,r=new k;if(r.add("file",o,o.name),u&&"string"==typeof u&&r.add("channel_url",u),l)for(var i=0;i<l.length;i++)r.add("thumbnail"+(i+1),l[i].maxWidth+","+l[i].maxHeight);r.upload.reqId=d,r.upload.deleteRequest=function(){var e=s.cls.FileMessageQueue;e.uploadRequest[d]&&delete e.uploadRequest[d]},r.upload.progressHandler=function(e){c&&"function"==typeof c&&c(e,d)},s.post(t,r,a)}})}},{key:"registerScheduledUserMessage",value:function(e,i){var a=this,s=e.groupChannelParams,o=e.channelUrl,l=e.isOpenChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=l?A.Path.OPENCHANNELS_CHANNELURL_SCHEDULED_MESSAGES.replace("%s",encodeURIComponent(o)):A.Path.GROUPCHANNELS_CHANNELURL_SCHEDULED_MESSAGES.replace("%s",encodeURIComponent(o)),r=new k({scheduled_dt:s._getScheduleString(),user_id:n.userId,message:s.message,data:s.data});s.customType&&r.add("custom_type",s.customType),s.metaArrayKeys&&0<Object.keys(s.metaArrayKeys).length&&r.add("metaarray",s.metaArrayKeys),s.mentionType&&r.add("mention_type",s._mentionType),s._mentionType===a.cls.BaseMessageParams.MentionType.CHANNEL?r.add("mentioned_user_ids",[]):Array.isArray(s._mentionedUserIds)&&0<s._mentionedUserIds.length&&r.add("mentioned_user_ids",s._mentionedUserIds),s.translationTargetLanguages&&0<s.translationTargetLanguages.length&&r.add("translation_target_langs",s.translationTargetLanguages),s.pushNotificationDeliveryOption&&s.pushNotificationDeliveryOption!==a.cls.BaseMessageParams.PushNotificationDeliveryOption.DEFAULT&&r.add("push_option",s.pushNotificationDeliveryOption),a.post(t,r,i)}})}},{key:"getMyPushTriggerOption",value:function(e,r){var i=this,a=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.USERS_USERID_PUSHPREFERENCE_CHANNELURL.replace("%s",encodeURIComponent(n.userId)).replace("%s",encodeURIComponent(a));i.get(t,null,r)}})}},{key:"setMyPushTriggerOption",value:function(e,i){var a=this,s=e.channelUrl,o=e.pushTriggerOption,l=e.enable;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_USERID_PUSHPREFERENCE_CHANNELURL.replace("%s",encodeURIComponent(n.userId)).replace("%s",encodeURIComponent(s)),r=new k;o&&r.add("push_trigger_option",o),"boolean"==typeof l&&r.add("enable",l),a.put(t,r,i)}})}},{key:"setMyCountPreference",value:function(e,i){var a=this,s=e.channelUrl,o=e.countPreference;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=A.Path.USERS_COUNT_PREFERENCE.replace("%s",encodeURIComponent(n.userId)).replace("%s",encodeURIComponent(s)),r=new k({count_preference:o});a.put(t,r,i)}})}},{key:"resetMyHistory",value:function(e,r){var i=this,a=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.GROUPCHANNELS_RESET_USER_HISTORY.replace("%s",encodeURIComponent(a));i.put(t,null,r)}})}},{key:"addReaction",value:function(e,i){var a=this,s=e.isGroupChannel,o=e.channelUrl,l=e.messageId,u=e.key;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=s?A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_REACTION.replace("%s",encodeURIComponent(o)).replace("%s",encodeURIComponent(l)):A.Path.OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_REACTION.replace("%s",encodeURIComponent(o)).replace("%s",encodeURIComponent(l)),r=new k({reaction:u});a.post(t,r,i)}})}},{key:"deleteReaction",value:function(e,i){var a=this,s=e.isGroupChannel,o=e.channelUrl,l=e.messageId,u=e.key;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=s?A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_REACTION.replace("%s",encodeURIComponent(o)).replace("%s",encodeURIComponent(l)):A.Path.OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_REACTION.replace("%s",encodeURIComponent(o)).replace("%s",encodeURIComponent(l)),r=new k({reaction:u});a.delete(t,r,i)}})}},{key:"getAllEmoji",value:function(t){var r=this;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):r.get(A.Path.EMOJI_CATEGORIES,null,t)})}},{key:"getEmojiCategory",value:function(e,r){var i=this,a=e.categoryId;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.EMOJI_CATEGORIES_CATEGORYID.replace("%s",a);i.get(t,null,r)}})}},{key:"getEmoji",value:function(e,r){var i=this,a=e.emojiKey;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=A.Path.EMOJIS_EMOJIKEY.replace("%s",a);i.get(t,null,r)}})}}],[{key:"Path",get:function(){return{USERS:"/users",USERS_USERID:"/users/%s",USERS_USERID_LOGIN:"/users/%s/login",USERS_USERID_METADATA:"/users/%s/metadata",USERS_USERID_METADATA_KEY:"/users/%s/metadata/%s",USERS_USERID_MARKASREADALL:"/users/%s/mark_as_read_all",USERS_USERID_MY_GROUP_CHANNEL_CHANGELOGS:"/users/%s/my_group_channels/changelogs",USERS_USERID_UNREAD_ITEM_COUNT:"/users/%s/unread_item_count",USERS_USERID_UNREAD_MESSAGE_COUNT:"/users/%s/unread_message_count",USERS_USERID_UNREAD_CHANNEL_COUNT:"/users/%s/unread_channel_count",USERS_USERID_PUSH_GCM_TOKEN:"/users/%s/push/gcm/%s",USERS_USERID_PUSH_GCM:"/users/%s/push/gcm",USERS_USERID_PUSH_DEVICE_TOKENS:"/users/%s/push/%s/device_tokens",USERS_USERID_PUSHPREFERENCE_CHANNELURL:"/users/%s/push_preference/%s",USERS_USERID_PUSHPREFERENCE:"/users/%s/push_preference/",USERS_USERID_PUSH_TEMPLATE:"/users/%s/push/template",USERS_USERID_BLOCK:"/users/%s/block",USERS_USERID_BLOCK_TARGETID:"/users/%s/block/%s",USERS_USERID_PUSH_APNS_TOKEN:"/users/%s/push/apns/%s",USERS_USERID_PUSH_APNS:"/users/%s/push/apns",USERS_USERID_PUSH:"/users/%s/push",USERS_USERID_GROUP_CHANNEL_INVITATION_PREFERENCE:"/users/%s/channel_invitation_preference",USERS_USERID_GROUP_CHANNEL_COUNT:"/users/%s/group_channel_count",USERS_COUNT_PREFERENCE:"/users/%s/count_preference/%s",OPENCHANNELS:"/open_channels",OPENCHANNELS_CHANNELURL:"/open_channels/%s",OPENCHANNELS_CHANNELURL_MESSAGES:"/open_channels/%s/messages",OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID:"/open_channels/%s/messages/%s",OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_TRANSLATION:"/open_channels/%s/messages/%s/translation",OPENCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS:"/open_channels/%s/messages/changelogs",OPENCHANNELS_CHANNELURL_SCHEDULED_MESSAGES:"/open_channels/%s/scheduled_messages",OPENCHANNELS_CHANNELURL_PARTICIPANTS:"/open_channels/%s/participants",OPENCHANNELS_CHANNELURL_OPERATORS:"/open_channels/%s/operators",OPENCHANNELS_CHANNELURL_METADATA:"/open_channels/%s/metadata",OPENCHANNELS_CHANNELURL_METADATA_KEY:"/open_channels/%s/metadata/%s",OPENCHANNELS_CHANNELURL_METACOUNTER:"/open_channels/%s/metacounter",OPENCHANNELS_CHANNELURL_METACOUNTER_KEY:"/open_channels/%s/metacounter/%s",OPENCHANNELS_CHANNELURL_BAN:"/open_channels/%s/ban",OPENCHANNELS_CHANNELURL_BAN_USERID:"/open_channels/%s/ban/%s",OPENCHANNELS_CHANNELURL_MUTE:"/open_channels/%s/mute",OPENCHANNELS_CHANNELURL_MUTE_USERID:"/open_channels/%s/mute/%s",OPENCHANNELS_CHANNELURL_FREEZE:"/open_channels/%s/freeze",OPENCHANNELS_OPERATORS:"/open_channels/%s/operators",OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_REACTION:"/open_channels/%s/messages/%s/reactions",GROUPCHANNELS:"/group_channels",MYGROUPCHANNELS:"/users/%s/my_group_channels",GROUPCHANNELS_CHANNELURL:"/group_channels/%s",GROUPCHANNELS_CHANNELURL_INVITE:"/group_channels/%s/invite",GROUPCHANNELS_CHANNELURL_ACCEPT_INVITATION:"/group_channels/%s/accept",GROUPCHANNELS_CHANNELURL_DECLINE_INVITATION:"/group_channels/%s/decline",GROUPCHANNELS_CHANNELURL_HIDE:"/group_channels/%s/hide",GROUPCHANNELS_CHANNELURL_LEAVE:"/group_channels/%s/leave",GROUPCHANNELS_CHANNELURL_JOIN:"/group_channels/%s/join",GROUPCHANNELS_CHANNELURL_OPERATORS:"/group_channels/%s/operators",GROUPCHANNELS_CHANNELURL_MESSAGES:"/group_channels/%s/messages",GROUPCHANNELS_CHANNELURL_MESSAGES_MARKASREAD:"/group_channels/%s/messages/mark_as_read",GROUPCHANNELS_CHANNELURL_MESSAGES_MARKASDELIVERED:"/group_channels/%s/messages/mark_as_delivered",GROUPCHANNELS_CHANNELURL_MESSAGES_TOTALCOUNT:"/group_channels/%s/messages/total_count",GROUPCHANNELS_CHANNELURL_MESSAGES_UNREADCOUNT:"/group_channels/%s/messages/unread_count",GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID:"/group_channels/%s/messages/%s",GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_TRANSLATION:"/group_channels/%s/messages/%s/translation",GROUPCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS:"/group_channels/%s/messages/changelogs",GROUPCHANNELS_CHANNELURL_SCHEDULED_MESSAGES:"/group_channels/%s/scheduled_messages",GROUPCHANNELS_CHANNELURL_MEMBERS:"/group_channels/%s/members",GROUPCHANNELS_CHANNELURL_METADATA:"/group_channels/%s/metadata",GROUPCHANNELS_CHANNELURL_METADATA_KEY:"/group_channels/%s/metadata/%s",GROUPCHANNELS_CHANNELURL_METACOUNTER:"/group_channels/%s/metacounter",GROUPCHANNELS_CHANNELURL_METACOUNTER_KEY:"/group_channels/%s/metacounter/%s",GROUPCHANNELS_RESET_USER_HISTORY:"/group_channels/%s/reset_user_history",GROUPCHANNELS_OPERATORS:"/group_channels/%s/operators",GROUPCHANNELS_MEMBERS:"/group_channels/%s/members",GROUPCHANNELS_CHANNELURL_BAN:"/group_channels/%s/ban",GROUPCHANNELS_CHANNELURL_BAN_USERID:"/group_channels/%s/ban/%s",GROUPCHANNELS_CHANNELURL_MUTE:"/group_channels/%s/mute",GROUPCHANNELS_CHANNELURL_MUTE_USERID:"/group_channels/%s/mute/%s",GROUPCHANNELS_CHANNELURL_FREEZE:"/group_channels/%s/freeze",GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_REACTION:"/group_channels/%s/messages/%s/reactions",STORAGE_FILE:"/storage/file",STORAGE_PROFILE:"/storage/profile_image",FRIENDS:"/users/%s/friends",FRIENDS_CHANGE_LOGS:"/users/%s/friends/changelogs",FRIENDS_DISCOVERIES:"/users/%s/friend_discoveries",SEARCH_MESSAGE:"/search/messages",REPORT_USERS:"/report/users/%s",REPORT_CHANNELS:"/report/%s/%s",REPORT_MESSAGES:"/report/%s/%s/messages/%s",EMOJIS_EMOJIKEY:"/emojis/%s",EMOJI_CATEGORIES:"/emoji_categories",EMOJI_CATEGORIES_CATEGORYID:"/emoji_categories/%s"}}}]),A}(),O=function(){function t(e,n){v(this,t),this.sb=e,this.ws=null,this.wsHost=null,this.WebSocket=null,this.handler=n||new t.ConnectionHandler,this.explicitDisconnect=!1,this.lastActiveMillis=0;try{this.WebSocket="undefined"==typeof WebSocket?r:WebSocket}catch(e){this.WebSocket=WebSocket}}return s(t,[{key:"connect",value:function(e,n,t){var i=this;me.debug("WSClient connect called");var r=_e.get(this.sb._iid).container,a=r.pinger,s=r.auth,o=r.extensions,l=r.getUserAgentWithExtensions;this.wsHost=t;try{var u="/?p=JS&pv="+encodeURIComponent(ge.OS_VERSION)+"&sv="+encodeURIComponent(ge.SDK_VERSION)+"&ai="+encodeURIComponent(this.sb.getApplicationId());if(s.sessionKey?u+="&key="+encodeURIComponent(s.sessionKey):u+="&user_id="+encodeURIComponent(e)+"&access_token="+encodeURIComponent(n),u+="&active=1",u+="&SB-User-Agent="+encodeURIComponent(l(o)),u+="&Request-Sent-Timestamp="+(new Date).getTime().toString(),u+="&include_extra_data="+encodeURIComponent(["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash"].join(",")),this.ws=new this.WebSocket(this.wsHost+u),!this.ws)return this.sb.isReconnectingOnError=!0,void this.handler.onError("ws does not exist.")}catch(e){return this.sb.isReconnectingOnError=!0,void this.handler.onError(e)}try{this.sb.getDebugMode()&&"undefined"!=typeof window&&(window.ws=this.ws)}catch(e){me.debug("window object does not exist.")}var c=!1;this.ws.onopen=function(e){me.debug("WSClient onopen called"),i.handler.onOpen(e)},this.ws.onmessage=function(e){i.active();var n=e.data.split("\n");for(var t in n){var r=n[t];if(r&&"string"==typeof r){try{if("PONG"===r.substring(0,4)){a.pong();continue}}catch(e){me.debug("ws.onmessage-command check error: ",e)}i.handler.onMessage(r)}}},this.ws.onerror=function(e){me.debug("WSClient ws.onerror called: ",e),a&&a.stop(),c=!0,i.sb.isReconnectingOnError=!0,i.handler.onError(e)},this.ws.onclose=function(e){me.debug("WSClient ws.onclose called - e, explicitDisconnect: ",e,i.explicitDisconnect),a&&a.stop(),i.explicitDisconnect?i.handler.onClose(e):c||i.handler.onError(e),i.explicitDisconnect=!1}}},{key:"disconnect",value:function(e,n){me.debug("WSClient disconnect called [explicit]: ",e);var t=_e.get(this.sb._iid).container.pinger;t&&t.stop(),this.explicitDisconnect=!0===e,this.ws&&(this.ws.onopen=function(){},this.ws.onmessage=function(){},this.ws.onclose=function(){n&&n()},this.ws.onerror=function(){},this.ws.close(),this.ws=null),this.explicitDisconnect?this.handler.onClose():this.handler.onError(),this.explicitDisconnect=!1}},{key:"send",value:function(e,n){1!==this.ws.readyState?n&&n(new ye("Connection is not valid. Please reconnect.",ye.WEBSOCKET_CONNECTION_CLOSED),null):(this.ws.send(e.encode()),n&&n(null,null))}},{key:"active",value:function(){this.lastActiveMillis=(new Date).getTime()}},{key:"getConnectionState",value:function(){try{return 1===this.ws.readyState?this.sb.ConnectionState.OPEN:0===this.ws.readyState?this.sb.ConnectionState.CONNECTING:this.sb.ConnectionState.CLOSED}catch(e){return this.sb.ConnectionState.CLOSED}}}]),t}();O.ConnectionHandler=function(){return function e(){v(this,e),this.onReady=function(){},this.onOpen=function(){},this.onClose=function(){},this.onMessage=function(){},this.onError=function(){}}}(),Number.MAX_SAFE_INTEGER||Object.defineProperty(Number,"MAX_SAFE_INTEGER",{value:Math.pow(2,53)-1});var L=function(){function n(e){v(this,n),this.sb=e,this.cls=pe.get(this.sb._iid),this.ws=new O(this.sb),this.reconnectParams={interval:3,retryCount:3,multiplier:2,maxInterval:24},this.reconnectCount=0,this.reconnectDelay=0}return s(n,[{key:"connect",value:function(t,r){var i=this,e=_e.get(this.sb._iid).container,n=e.auth,a=e.apiClient,s=e.commandHandler,o=this.cls.GroupChannel,l=new O.ConnectionHandler;this.ws=new O(this.sb,l),l.onMessage=function(e){s.onRawCommandReceived(e)},this.sb.loginHandler=function(e,n){if(i.sb.connecting=!1,e)i.disconnect({clearSession:!0,err:e},null);else{clearInterval(i.sb.globalTimer);var t=function(){if(o.cachedChannels)for(var e in o.cachedChannels){var n=o.cachedChannels[e];if(n.invalidateTypingStatus())for(var t in i.sb.channelHandlers){i.sb.channelHandlers[t].onTypingStatusUpdated(n)}}};t(),i.sb.globalTimer=setInterval(function(){return t()},1e3),i.flushConnectionCallbacks(null,n),i.sb.connecting=!1,i.sb.reconnecting=!1,i.sb.ConnectionManager.processAllReadyHandler(null)}},l.onOpen=function(){i.sb.loginTimer=setTimeout(function(){i.sb.loginTimer=null,i.sb.onLoginTimerCancel=null,i.flushConnectionCallbacks(new ye("Connection timeout.",ye.LOGIN_TIMEOUT),null),i.sb.disconnect(null)},i.sb.Options.websocketResponseTimeout),i.sb.onLoginTimerCancel=function(){i.flushConnectionCallbacks(new ye("Connection has been canceled.",ye.REQUEST_FAILED),null)},i.sb.connecting=!1},l.onError=function(e){me.debug("WebSocketClient.ConnectionHandler.onError",e),n.sessionKey?(i.sb.isReconnectingOnError=!0,i.sb.ConnectionManager.errorAllReadyHandler(),i.reconnect(t,!0)):i.flushConnectionCallbacks(new ye("Websocket connection failed.",ye.WEBSOCKET_CONNECTION_FAILED),null),i.sb.connecting=!1},l.onClose=function(){me.debug("WebSocketClient.ConnectionHandler.onClose"),i.sb.connecting=!1},a.checkRouting(function(e,n){if(e)return i.sb.connecting=!1,void i.flushConnectionCallbacks(new ye("Connection routing failed.",ye.REQUEST_FAILED),null);a.dummyCall(function(e){e&&me.log("API dummy call failed",e)}),i.ws.connect(t,r,n.wsHost)})}},{key:"reconnect",value:function(t,e){var i=this,n=!(1<arguments.length&&void 0!==e)||e,r=_e.get(this.sb._iid).container,a=r.auth,s=r.apiClient,o=r.commandHandler,l=this.cls.OpenChannel;if(this.sb.reconnecting=!0,this.sb.reconnectTimer)me.debug("still reconnecting");else{if(this.reconnectCount+=1,this.reconnectCount<=1){if(n)for(var u in this.sb.connectionHandlers){this.sb.connectionHandlers[u].onReconnectStarted()}this.reconnectDelay=0}else this.reconnectDelay=Math.min(1e3*this.reconnectParams.interval*Math.pow(this.reconnectParams.multiplier,this.reconnectCount-2),0<this.reconnectParams.maxInterval?1e3*this.reconnectParams.maxInterval:Number.MAX_SAFE_INTEGER);if(!t||!a.sessionKey||0<this.reconnectParams.retryCount&&this.reconnectCount>this.reconnectParams.retryCount){for(var c in this.disconnect({clearSession:!1,err:new ye("Websocket connection failed.",ye.WEBSOCKET_CONNECTION_FAILED)},null),this.reconnectCount=0,this.sb.connectionHandlers){this.sb.connectionHandlers[c].onReconnectFailed()}return this.sb.connecting=!1,this.sb.reconnecting=!1,this.sb.isReconnectingOnError=!1,void this.sb.ConnectionManager.errorAllReadyHandler()}this.sb.onReconnectTimerCancel=function(){i.reconnectCount=0},this.sb.reconnectTimer=setTimeout(function(){i.sb.reconnectTimer=null,i.sb.onReconnectTimerCancel=null,i.ws&&i.ws.disconnect(!0);var e=new O.ConnectionHandler;i.ws=new O(i.sb,e),i.sb.loginHandler=function(){for(var e in i.reconnectCount=0,i.sb.connecting=!1,i.sb.reconnecting=!1,i.sb.isReconnectingOnError=!1,i.sb.connectionHandlers){i.sb.connectionHandlers[e].onReconnectSucceeded()}if(i.sb.ConnectionManager.processAllReadyHandler(null),i.sb.isReconnectingOnError)for(var n in i.sb.ConnectionManager.networkHandlers)i.sb.ConnectionManager.networkHandlers[n].onReconnected();Object.keys(l.enteredChannels).forEach(function(r){l.enteredChannels[r].enter(function(e,n){if(e){var t=i.cls.FileMessageQueue;delete l.enteredChannels[r],t.delete(r)}})})},e.onOpen=function(){me.debug("reconnect onOpen"),i.sb.loginTimer=setTimeout(function(){me.debug("reconnect loginTimer timeout"),i.sb.loginTimer=null,i.reconnect(t,!0)},i.sb.Options.websocketResponseTimeout),i.sb.onLoginTimerCancel=null,i.sb.reconnecting=!1},e.onMessage=function(e){o.onRawCommandReceived(e)},e.onError=function(e){me.debug("reconnect onError",e),i.sb.isReconnectingOnError=!0,i.sb.ConnectionManager.errorAllReadyHandler(),i.reconnect(t,!0)},e.onClose=function(){me.debug("reconnect onClose"),i.sb.reconnecting=!1},s.checkRouting(function(e,n){e?i.reconnect(t,!0):(i.sb.getCurrentApiHost()!==n.apiHost&&s.get("/",null,function(){}),i.ws.connect(t,null,n.wsHost))})},this.reconnectDelay)}}},{key:"disconnect",value:function(e,n){var t=_e.get(this.sb._iid),r=t.container.ackStateMap,i=this.cls,a=i.GroupChannel,s=i.OpenChannel,o=e.clearSession,l=e.err;if(this.sb.loginTimer&&(clearTimeout(this.sb.loginTimer),this.sb.onLoginTimerCancel&&(this.sb.onLoginTimerCancel(),this.sb.onLoginTimerCancel=null),this.sb.loginTimer=null),this.sb.reconnectTimer&&(clearTimeout(this.sb.reconnectTimer),this.sb.onReconnectTimerCancel&&(this.sb.onReconnectTimerCancel(),this.sb.onReconnectTimerCancel=null),this.sb.reconnectTimer=null),this.ws&&(this.reconnectCount=0,this.ws.disconnect(!0),this.ws=null),o){for(var u in s.clearEnteredChannels(),s.clearCache(),a.clearCache(),this.sb.globalTimer&&(clearInterval(this.sb.globalTimer),this.sb.globalTimer=null),r)clearTimeout(r[u].timer);this.sb.currentUser=null,t.set("ackStateMap",{}),t.set("subscribedUnreadMessageCount",{all:0,custom_types:{},ts:0}),t.set("auth",new U)}l&&(this.flushConnectionCallbacks(l,null),this.sb.connecting=!1,this.sb.reconnecting=!1,this.sb.isReconnectingOnError=!1),n&&n(null,null)}},{key:"flushConnectionCallbacks",value:function(n,t){var e=this.sb.connectionCallbacks;this.sb.connectionCallbacks=[],e.forEach(function(e){return e(n,t)})}}]),n}(),j=function(){function f(e){var n=e.type,t=e.nullable,r=void 0!==t&&t,i=e.optional,a=void 0!==i&&i,s=e.optionalIf,o=void 0===s?null:s,l=e.ignoreIf,u=void 0===l?null:l,c=e.defaultValue,d=void 0===c?null:c,h=e.constraint,p=void 0===h?null:h;v(this,f),this.type=n,this.nullable=r,this.optional=a,this.optionalIf=o,this.ignoreIf=u,this.defaultValue=d,this.constraint=p}return s(f,[{key:"isMatchingType",value:function(t){function n(e,n){return"string"==typeof n?fe(e)===n||"array"===n&&Array.isArray(e)||"file"===n&&ve.isFile(e)||"null"===n&&null===e||"date"===n&&e instanceof Date:"function"==typeof n?e instanceof n:"object"===fe(n)&&-1<Object.keys(n).map(function(e){return n[e]}).indexOf(t)}return n(t,this.type)||Array.isArray(this.type)&&this.type.some(function(e){return n(t,e)})||this.nullable&&null===t}}],[{key:"parse",value:function(e,n){for(e=f.toArray(e);void 0===e[e.length-1];)e.pop();var t=!1,r=null;"callback"===n[n.length-1].type&&("function"==typeof e[e.length-1]&&(r=e.pop()),n.pop(),t=!0);var i=[],a=null,s=0;for(var o in n){var l=n[o];"function"==typeof l.ignoreIf&&l.ignoreIf(e)?i.push(l.hasOwnProperty("defaultValue")?l.defaultValue:null):l.isMatchingType(e[s])?(l.nullable&&null===e[s]||!l.constraint||l.constraint(e[s])||(a=f.error),i.push(e[s]),s++):l.optional||"function"==typeof l.optionalIf&&l.optionalIf(e)?i.push(l.hasOwnProperty("defaultValue")?l.defaultValue:null):(a=f.error,i.push(e[s]),s++)}return t&&r&&i.push(r),e.length!==s&&(a=f.error),[a].concat(i)}},{key:"toArray",value:function(e){for(var n=[],t=0;t<e.length;t++)n.push(e[t]);return n}},{key:"error",get:function(){return new ye("Invalid parameter.",ye.INVALID_PARAMETER)}}]),f}(),P=function(){function n(e){v(this,n),this.sb=e,this.authCount=0,this.readyHandlers=[],this.networkHandlers={},this.authenticateTimer=1e4,this.authInfoRequester=null}return s(n,[{key:"addReadyHandler",value:function(e){e&&"function"==typeof e&&this.readyHandlers.push(e)}},{key:"ready",value:function(e,n){var t=!(1<arguments.length&&void 0!==n)||n,r=_e.get(this.sb._iid).container,i=r.auth,a=r.isInBackground;t&&i.hasSession()?e&&(this.sb.currentUser?e(null,this.sb.currentUser):(this.addReadyHandler(e),this.errorAllReadyHandler()),this.sb.getConnectionState()!==this.sb.ConnectionState.CLOSED||a||this.sb.reconnect()):(this.addReadyHandler(e),this.sb.isReconnectingOnError?this.errorAllReadyHandler():this.sb.getConnectionState()===this.sb.ConnectionState.OPEN?this.processAllReadyHandler(null):this.sb.getConnectionState()===this.sb.ConnectionState.CONNECTING||this.errorAllReadyHandler())}},{key:"processAllReadyHandler",value:function(n){if(0<this.readyHandlers.length){var t=this.sb.currentUser,e=this.readyHandlers;this.readyHandlers=[],e.forEach(function(e){e&&"function"==typeof e&&e(n,t)})}}},{key:"errorAllReadyHandler",value:function(){this.processAllReadyHandler(new ye("Connection should be made first.",ye.CONNECTION_REQUIRED))}},{key:"NetworkHandler",value:function(){this.onReconnected=function(){}}},{key:"addNetworkHandler",value:function(e,n){this.networkHandlers[e]=n}},{key:"removeNetworkHandler",value:function(e){delete this.networkHandlers[e]}},{key:"removeAllNetworkHandler",value:function(){this.networkHandlers={}}},{key:"authenticate",value:function(t){var r=this;if(this.sb.getConnectionState()===this.sb.ConnectionState.OPEN||this.sb.reconnecting)this.sb.connecting=!1,t(null,this.sb.currentUser);else if(this.authInfoRequester&&"function"==typeof this.authInfoRequester){this.sb.connecting=!0,this.authCount++;var i=setTimeout(function(){i=null,r.authCount--,0===r.authCount&&0===r.sb.connectionCallbacks.length&&(r.sb.connecting=!1),r.errorAllReadyHandler(),t(new ye("Connection should be made first.",ye.CONNECTION_REQUIRED),null)},this.authenticateTimer);this.authInfoRequester(function(e){if(i){clearTimeout(i),i=null,r.authCount--;var n=function(e){r.sb.connecting=!1,t(e,null)};e&&e.hasOwnProperty("userId")?e.accessToken?e.apiHost&&e.wsHost?r.sb.connect(e.userId,e.accessToken,e.apiHost,e.wsHost,n):r.sb.connect(e.userId,e.accessToken,n):e.apiHost&&e.wsHost?r.sb.connect(e.userId,e.apiHost,e.wsHost,n):r.sb.connect(e.userId,n):t(j.error,null)}})}else t(j.error,null)}}]),n}(),w=function(){function n(e){v(this,n),this.sb=e}return s(n,[{key:"onlineWorker",value:function(){try{if("undefined"!=typeof navigator&&navigator.onLine){var e=_e.get(this.sb._iid).container.auth;this.sb.reconnecting||this.sb.connecting||!e.sessionKey||this.sb.getConnectionState()===this.sb.ConnectionState.OPEN||this.sb.reconnect()}}catch(e){me.debug("There is no window.addEventListener.ononline or navigator.onLine")}}},{key:"offlineWorker",value:function(){try{if("undefined"!=typeof navigator&&!navigator.onLine){var e=_e.get(this.sb._iid).container,n=e.auth,t=e.pinger;this.sb.reconnecting||this.sb.connecting||!n.sessionKey||(t&&t.stop(),this.sb.reconnect())}}catch(e){me.debug("There is no window.addEventListener.ononline or navigator.onLine")}}},{key:"start",value:function(){try{"undefined"!=typeof window&&window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&"boolean"==typeof navigator.onLine&&(window.addEventListener("online",this.onlineWorker),window.addEventListener("offline",this.offlineWorker))}catch(e){me.debug("There is no window.addEventListener.ononline or navigator.onLine")}}},{key:"stop",value:function(){try{window.removeEventListener("online",this.onlineWorker,!1),window.removeEventListener("offline",this.offlineWorker,!1)}catch(e){me.debug("There is no window.addEventListener.ononline or navigator.onLine")}}}]),n}(),D=(new Date).getTime(),H=function(){function i(e,n){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;switch(v(this,i),this.command=e,this.requestId=t,arguments.length){case 1:if(!e||e.length<=4)this.command="NOOP",this.payload="{}";else if(this.decode(e),this.isRequestIdCommand){var r=this.getJsonElement();r&&(this.requestId=r.req_id||"")}break;case 2:case 3:!this.requestId&&this.isRequestIdCommand&&(this.requestId=i.generateRequestId()),n.req_id=this.requestId||"",this.payload=JSON.stringify(n)}}return s(i,[{key:"encode",value:function(){return this.command+this.payload+"\n"}},{key:"decode",value:function(e){e=e.trim(),this.command=e.substring(0,4),this.payload=e.substring(4)}},{key:"getJsonElement",value:function(){return JSON.parse(this.payload)}},{key:"isRequestIdCommand",get:function(){return this.isAckRequired||"EROR"===this.command}},{key:"isAckRequired",get:function(){return"MESG"===this.command||"FILE"===this.command||"ENTR"===this.command||"EXIT"===this.command||"READ"===this.command||"MEDI"===this.command||"FEDI"===this.command}}],[{key:"bPing",value:function(){return new this("PING",{id:(new Date).getTime(),active:1})}},{key:"bMessage",value:function(e){var n=e.channelUrl,t=e.message,r=e.data,i=e.customType,a=e.metaArrays,s=e.mentionType,o=e.mentionedUserIds,l=e.translationTargetLanguages,u=e.pushNotificationDeliveryOption,c=e.requestId,d=void 0===c?null:c,h=e.silent,p=void 0!==h&&h,f=e.rootMessageId,g=void 0===f?null:f,_=e.parentMessageId,y=void 0===_?null:_,m=pe.get(this._iid),v=m.UserMessageParams,C=m.BaseMessageParams,E={};return E.channel_url=n,E.message=t,E.data=r,a&&0<a.length&&(E.metaarray=a.map(function(e){return e.encode()})),s&&(E.mention_type=s),E.mentioned_user_ids=[],s===C.MentionType.CHANNEL?E.mentioned_user_ids=[]:Array.isArray(o)&&0<o.length&&(E.mentioned_user_ids=o),i&&(E.custom_type=i),l&&0<l.length&&(E.target_langs=l),u&&u!==v.PushNotificationDeliveryOption.DEFAULT&&(E.push_option=u),p&&(E.silent=p),g&&(E.root_message_id=g),y&&(E.parent_message_id=y),new this("MESG",E,d)}},{key:"bFile",value:function(e){var n=e.channelUrl,t=e.url,r=e.name,i=e.type,a=e.size,s=e.data,o=e.customType,l=e.thumbnailSizes,u=e.requireAuth,c=e.metaArrays,d=e.mentionType,h=e.mentionedUserIds,p=e.pushNotificationDeliveryOption,f=e.requestId,g=void 0===f?null:f,_=e.silent,y=void 0!==_&&_,m=e.rootMessageId,v=void 0===m?null:m,C=e.parentMessageId,E=void 0===C?null:C,U=pe.get(this._iid),b=U.BaseMessageParams,A=U.FileMessageParams,I={};return I.channel_url=n,I.url=t,I.name=r||"",I.type=i||"",I.size=a||0,I.custom=s,o&&(I.custom_type=o),l&&(I.thumbnails=l),u&&(I.require_auth=u),c&&0<c.length&&(I.metaarray=c.map(function(e){return e.encode()})),d&&(I.mention_type=d),I.mentioned_user_ids=[],d===b.MentionType.CHANNEL?I.mentioned_user_ids=[]:Array.isArray(h)&&0<h.length&&(I.mentioned_user_ids=h),p&&p!==A.PushNotificationDeliveryOption.DEFAULT&&(I.push_option=p),y&&(I.silent=y),v&&(I.root_message_id=v),E&&(I.parent_message_id=E),new this("FILE",I,g)}},{key:"bUpdateUserMessage",value:function(e){var n=e.channelUrl,t=e.messageId,r=e.message,i=void 0===r?null:r,a=e.data,s=void 0===a?null:a,o=e.customType,l=void 0===o?null:o,u=e.mentionType,c=void 0===u?null:u,d=e.mentionedUserIds,h=void 0===d?null:d,p=e.metaArrayParams,f=void 0===p?null:p,g=pe.get(this._iid).BaseMessageParams,_={};return _.channel_url=n,_.msg_id=t,null!=i&&void 0!==i&&(_.message=i),null!=s&&void 0!==s&&(_.data=s),null!=l&&void 0!==l&&(_.custom_type=l),c&&(_.mention_type=c),c===g.MentionType.CHANNEL?_.mentioned_user_ids=[]:Array.isArray(h)&&0<h.length&&(_.mentioned_user_ids=h),f&&(_.metaarray=f),new this("MEDI",_)}},{key:"bUpdateFileMessage",value:function(e){var n=e.channelUrl,t=e.messageId,r=e.data,i=void 0===r?null:r,a=e.customType,s=void 0===a?null:a,o=e.mentionType,l=void 0===o?null:o,u=e.mentionedUserIds,c=void 0===u?null:u,d=e.metaArrayParams,h=void 0===d?null:d,p=pe.get(this._iid).BaseMessageParams,f={};return f.channel_url=n,f.msg_id=t,null!=i&&void 0!==i&&(f.data=i),null!=s&&void 0!==s&&(f.custom_type=s),l&&(f.mention_type=l),l===p.MentionType.CHANNEL?f.mentioned_user_ids=[]:Array.isArray(c)&&0<c.length&&(f.mentioned_user_ids=c),h&&(f.metaarray=h),new this("FEDI",f)}},{key:"bRead",value:function(e){var n=e.channelUrl,t={};return t.channel_url=n,new this("READ",t)}},{key:"bMessageAck",value:function(e){var n=e.channelUrl,t=e.messageId,r={};return r.channel_url=n,r.msg_id=t,new this("MACK",r)}},{key:"bTypeStart",value:function(e){var n=e.channelUrl,t=e.time,r={};return r.channel_url=n,r.time=t,new this("TPST",r)}},{key:"bTypeEnd",value:function(e){var n=e.channelUrl,t=e.time,r={};return r.channel_url=n,r.time=t,new this("TPEN",r)}},{key:"bEnter",value:function(e){var n=e.channelUrl,t={};return t.channel_url=n,new this("ENTR",t)}},{key:"bExit",value:function(e){var n=e.channelUrl,t={};return t.channel_url=n,new this("EXIT",t)}},{key:"generateRequestId",value:function(){return D++,String(D)}}]),i}(),F=new WeakMap,Ce=function(){function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};v(this,a);var n=[];if(e.hasOwnProperty("premium_feature_list")&&Array.isArray(e.premium_feature_list))try{var t=e.premium_feature_list;n.push.apply(n,b(t))}catch(e){}var r=[];if(e.hasOwnProperty("application_attributes")&&Array.isArray(e.application_attributes))try{var i=e.application_attributes;r.push.apply(r,b(i))}catch(e){}F.set(this,{emojiHash:e.hasOwnProperty("emoji_hash")?e.emoji_hash:"",uploadSizeLimit:e.hasOwnProperty("file_upload_size_limit")?1048576*e.file_upload_size_limit:Number.MAX_VALUE,useReaction:e.hasOwnProperty("use_reaction")&&e.use_reaction,applicationAttributes:r,premiumFeatureList:n})}return s(a,[{key:"emojiHash",get:function(){return F.get(this).emojiHash}},{key:"uploadSizeLimit",get:function(){return F.get(this).uploadSizeLimit}},{key:"premiumFeatureList",get:function(){return F.get(this).premiumFeatureList}},{key:"applicationAttributes",get:function(){return F.get(this).applicationAttributes}},{key:"isUsingReaction",get:function(){return F.get(this).useReaction}}]),a}(),G=function(){function e(){v(this,e),this.messageId=null,this.userId=null,this.key=null,this.operation="",this.updatedAt=null}return s(e,null,[{key:"createFromJson",value:function(e){var n=parseInt(e.msg_id),t=e.user_id,r=e.operation,i=e.reaction,a=e.updated_at;if(n&&"string"==typeof t&&"string"==typeof r&&0<=["add","delete"].indexOf(r.toLowerCase())&&"string"==typeof i&&i&&"number"==typeof a){var s=new this;return s.messageId=n,s.userId=t,s.key=i,s.operation=r.toLowerCase(),s.updatedAt=a,s}return null}}]),e}();var x=function(){function e(){v(this,e)}return s(e,null,[{key:"serialize",value:function(e,n){var t=1<arguments.length&&void 0!==n?n:null,r=JSON.parse(JSON.stringify(e));return t&&t(r),function n(t){return Object.keys(t).forEach(function(e){t[e]&&"object"===fe(t[e])&&n(t[e])}),Object.freeze(t)}(r)}},{key:"deserialize",value:function(e,n){var t=1<arguments.length&&void 0!==n?n:null,r=JSON.parse(JSON.stringify(e));return t&&t(r),r}}]),e}(),q=0,z=1,Q=2;"undefined"==typeof Promise&&(Promise=function(){function l(e){var n=this;v(this,l),this.state=q,this._value=null,this._reason=null;if("function"!=typeof e)throw"Promise resolver ".concat(e," is not a function");e(function(e){n.state===q&&(n.state=z,n._value=e)},function(e){n.state===q&&(n.state=Q,n._reason=e)})}return s(l,[{key:"then",value:function(e,n){var t=this,r=this;switch(this.state){case q:setTimeout(function(){return t.then(e,n)},100);break;case z:e&&"function"==typeof e&&(r=e(this._value));break;case Q:n&&"function"==typeof n&&(r=n(this._reason))}return r instanceof l?r:this}},{key:"catch",value:function(e){var n=this,t=this;switch(this.state){case q:setTimeout(function(){return n.catch(e)},100);break;case z:break;case Q:t=e(this._reason)}return t instanceof l?t:this}},{key:"finally",value:function(e){var n=this,t=this;switch(this.state){case q:setTimeout(function(){return n.finally(e)},100);break;case z:case Q:t=e()}return t instanceof l?t:this}},{key:"length",get:function(){return 1}}],[{key:"all",value:function(o){return new l(function(r,i){if(Array.isArray(o)||"string"==typeof o)if(0<o.length){var e=[];for(var n in o)o[n]instanceof l?e.push(o[n]):e.push(l.resolve(o[n]));var a=new Array(e.length).fill(null),s=e.length,t=function(e,n,t){n?i(n):(s--,a[e]=t,s<=0&&r(a))};e.forEach(function(e,n){e.then(function(e){t(n,null,e)}).catch(function(e){t(n,e,null)})})}else r([]);else i(new Error("Uncaught (in promise) TypeError: ".concat(fe(o)," ").concat(o," is not iterable")))})}},{key:"resolve",value:function(n){return new l(function(e){e(n)})}},{key:"reject",value:function(t){return new l(function(e,n){n(t)})}}]),l}());function Y(t,e,r){return void 0===r?new Promise(function(t,r){e(function(e,n){return e?r(e):t(n)})}):e(function(e,n){r&&(_e.get(t).container.isErrorFirstInCallback?r(e,n):r(n,e))})}var K={TIMESTAMP:"timestamp",MESSAGE_ID:"messageId"},V=new WeakMap,W=function(){function n(e){v(this,n),this.messageId=0,this.messageType=n.MESSAGE_TYPE_BASE,this.channelUrl="",this.data=null,this.customType=null,this.silent=!1,this.createdAt=0,this.updatedAt=0,this.channelType=null,this.metaArrays=[],this.reactions=[],this.mentionType=null,this.mentionedUsers=[],V.set(this,0),this.parentMessageId=0,this.parentMessageText=null,this.threadInfo=null,this.ogMetaData=null,this.isOperatorMessage=!1,e&&this.__update(e)}return s(n,[{key:"serialize",value:function(){return x.serialize(this,function(e){e.hasOwnProperty("_sender")&&(e.sender=e._sender,delete e._sender)})}},{key:"isIdentical",value:function(e){return!("object"!==fe(e)||!e.hasOwnProperty("messageId"))&&(0!==this.messageId&&0!==e.messageId?this.messageId===e.messageId:this.reqId===e.reqId)}},{key:"isEqual",value:function(e){return ve.deepEqual(this,e)}},{key:"isOpenChannel",value:function(){var e=pe.get(this._iid).BaseChannel;return this.channelType===e.CHANNEL_TYPE_OPEN}},{key:"isGroupChannel",value:function(){var e=pe.get(this._iid).BaseChannel;return this.channelType===e.CHANNEL_TYPE_GROUP}},{key:"isUserMessage",value:function(){return this.messageType===n.MESSAGE_TYPE_USER}},{key:"isAdminMessage",value:function(){return this.messageType===n.MESSAGE_TYPE_ADMIN}},{key:"isFileMessage",value:function(){return this.messageType===n.MESSAGE_TYPE_FILE}},{key:"__update",value:function(e){var t=this,n=pe.get(this._iid),r=n.User,i=n.BaseChannel,a=n.BaseMessageParams,s=n.Reaction,o=n.MessageMetaArray,l=n.ThreadInfo,u=n.OGMetaData;e.hasOwnProperty("msg_id")&&(this.messageId=parseInt(e.msg_id)),e.hasOwnProperty("message_id")&&(this.messageId=parseInt(e.message_id)),this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.data=e.hasOwnProperty("data")?String(e.data):"",this.customType=e.hasOwnProperty("custom_type")?String(e.custom_type):"",this.silent=!!e.hasOwnProperty("silent")&&e.silent,this.createdAt=e.hasOwnProperty("ts")?parseInt(e.ts):0,e.hasOwnProperty("created_at")&&(this.createdAt=parseInt(e.created_at)),this.updatedAt=e.hasOwnProperty("updated_at")?parseInt(e.updated_at):0,this.channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):i.CHANNEL_TYPE_GROUP;var c=e.hasOwnProperty("metaarray")?e.metaarray:{},d=e.hasOwnProperty("metaarray_key_order")?e.metaarray_key_order:Object.keys(c).sort(function(e,n){return e.localeCompare(n)});this.metaArrays=[];for(var h=0;h<d.length;h++){var p=d[h];this.metaArrays.push(new o(p,c[p]||[]))}if(e.hasOwnProperty("sorted_metaarray")){var f=e.sorted_metaarray;Array.isArray(f)&&(this.metaArrays=f.map(function(e){return new o(e.key,e.value)}))}if(this.reactions=[],e.hasOwnProperty("reactions")&&Array.isArray(e.reactions))for(var g in e.reactions){var _=s.createFromJson(e.reactions[g]);_&&this.reactions.push(_)}this.mentionType=e.hasOwnProperty("mention_type")?e.mention_type:a.MentionType.USERS,this.mentionedUsers=[],e.hasOwnProperty("mentioned_users")&&e.mentioned_users.forEach(function(e){var n=new r(e);t.mentionedUsers.push(n)});e.hasOwnProperty("root_message_id")&&V.set(this,parseInt(e.root_message_id)),e.hasOwnProperty("parent_message_id")&&(this.parentMessageId=parseInt(e.parent_message_id)),e.hasOwnProperty("parent_message_text")&&(this.parentMessageText=e.parent_message_text),this.threadInfo=new l(e.thread_info),e.hasOwnProperty("og_tag")&&(this.ogMetaData=new u(e.og_tag)),this.isOperatorMessage=!!e.hasOwnProperty("is_op_msg")&&e.is_op_msg}},{key:"getMetaArraysByKeys",value:function(n){return Array.isArray(n)?this.metaArrays.filter(function(e){return-1<n.indexOf(e.key)}):[]}},{key:"getMetaArrayByKeys",value:function(e){var n={};return this.getMetaArraysByKeys(e).forEach(function(e){n[e.key]=e.value}),n}},{key:"applyReactionEvent",value:function(e){var n,t=this,r=pe.get(this._iid).Reaction,i=B(j.parse(arguments,[new j({type:G,constraint:function(e){return parseInt(e.messageId)===parseInt(t.messageId)}})]),2);if(n=i[0],e=i[1],!n){var a=!1;for(var s in this.reactions)if(this.reactions[s].key===e.key){this.reactions[s]._applyEvent(e),this.reactions[s].isEmpty&&this.reactions.splice(s,1),a=!0;break}a||"add"!==e.operation||this.reactions.push(new r(e.key,[e.userId],e.updatedAt))}}},{key:"_getThreadedMessageList",value:function(r,i,a,e){var o,l=this,n=pe.get(this._iid).ThreadedMessageListParams,t=B(j.parse(arguments,[new j({type:"number"}),new j({type:"string",constraint:function(e){return Object.values(K).includes(e)}}),new j({type:n,constraint:function(e){return e._validate()}}),new j({type:"callback"})]),5);return o=t[0],r=t[1],i=t[2],a=t[3],e=t[4],Y(this._iid,function(s){if(o)s(o,null);else{var e=pe.get(l._iid),n=e.GroupChannel,t=e.OpenChannel;l.isGroupChannel()?n.getChannel(l.channelUrl,ge.INTERNAL_CALL,function(e,n){if(SendBird.getInstance(l._iid).getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}n?s(n,null):_e.get(l._iid).container.apiClient.getMessageList(g(g({channel:e,token:r,tokenType:i},a),{},{shouldReverse:a.reverse,rootMessageId:l.messageId,includeReplies:!0,includeThreadInfo:!0}),function(e,n){if(e)s(e,null);else{var t=pe.get(l._iid).BaseChannel,r=n.messages.map(function(e){return t.buildMessage(e,l)}).filter(function(e){return null!==e}),i=r.filter(function(e){return e.messageId===l.messageId})[0],a=r.filter(function(e){return e.parentMessageId===l.messageId});s(null,{parentMessage:i,threadedReplies:a})}})}):l.isOpenChannel()&&t.getChannel(l.channelUrl,ge.INTERNAL_CALL,function(e,n){if(SendBird.getInstance(l._iid).getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}n?s(n,null):_e.get(l._iid).container.apiClient.getMessageList(g(g({channel:e,token:r,tokenType:i},a),{},{shouldReverse:a.reverse,rootMessageId:l.messageId,includeReplies:!0,includeThreadInfo:!0}),function(e,n){if(e)s(e,null);else{var t=pe.get(l._iid).BaseChannel,r=n.messages.map(function(e){return t.buildMessage(e,l)}).filter(function(e){return null!==e}),i=r.filter(function(e){return e.messageId===l.messageId})[0],a=r.filter(function(e){return e.parentMessageId===l.messageId});s(null,{parentMessage:i,threadedReplies:a})}})})}},e)}},{key:"getThreadedMessagesByTimestamp",value:function(e,n,t){return this._getThreadedMessageList(e,K.TIMESTAMP,n,t)}},{key:"applyThreadInfoUpdateEvent",value:function(e){var n,t=pe.get(this._iid),r=t.ThreadInfo,i=t.ThreadInfoUpdateEvent,a=V.get(this),s=B(j.parse(arguments,[new j({type:i,constraint:function(e){return parseInt(e.targetMessageId)===parseInt(a)}})]),2);if(n=s[0],e=s[1],n)return!1;var o=e.threadInfo;return this.threadInfo=new r(o),!0}},{key:"metaArray",get:function(){var n={};return this.metaArrays.forEach(function(e){n[e.key]=e.value}),n},set:function(e){if("object"===fe(e)&&e){var n=pe.get(this._iid).MessageMetaArray,t=[];for(var r in e)t.push(new n(r,e[r]));this.metaArrays=t}}}],[{key:"getMessage",value:function(a,e){var r,s=this,n=pe.get(this._iid),o=n.BaseChannel,t=n.MessageRetrievalParams,i=B(j.parse(arguments,[new j({type:t,constraint:function(e){return e._validate()}}),new j({type:"callback"})]),3);return r=i[0],a=i[1],e=i[2],Y(this._iid,function(i){if(r)i(r,null);else{var e=pe.get(s._iid),n=e.GroupChannel,t=e.OpenChannel;switch(a.channelType){case o.CHANNEL_TYPE_GROUP:n.getChannel(a.channelUrl,ge.INTERNAL_CALL,function(r,e){if(SendBird.getInstance(s._iid).getErrorFirstCallback()){var n=[r,e];e=n[0],r=n[1]}e?i(e,null):_e.get(s._iid).container.apiClient.getMessage(g({channel:r},a),function(e,n){if(e)i(e,null);else{var t=o.buildMessage(n,r);i(null,t)}})});break;case o.CHANNEL_TYPE_OPEN:t.getChannel(a.channelUrl,ge.INTERNAL_CALL,function(r,e){if(SendBird.getInstance(s._iid).getErrorFirstCallback()){var n=[r,e];e=n[0],r=n[1]}e?i(e,null):_e.get(s._iid).container.apiClient.getMessage(g({channel:r},a),function(e,n){if(e)i(e,null);else{var t=o.buildMessage(n,r);i(null,t)}})})}}},e)}},{key:"MESSAGE_TYPE_BASE",get:function(){return"base"}},{key:"MESSAGE_TYPE_ADMIN",get:function(){return"admin"}},{key:"MESSAGE_TYPE_USER",get:function(){return"user"}},{key:"MESSAGE_TYPE_FILE",get:function(){return"file"}},{key:"SendingStatus",get:function(){return{NONE:"none",PENDING:"pending",FAILED:"failed",CANCELED:"canceled",SUCCEEDED:"succeeded"}}}]),n}(),J=function(){function n(e){v(this,n),this.nickname="",this.plainProfileUrl="",this.userId="",this.connectionStatus="",this.lastSeenAt=null,this.metaData={},this.isActive=!0,this.friendDiscoveryKey=null,this.friendName=null,this._preferredLanguages=null,this.requireAuth=null,e&&this.__update(e)}return s(n,[{key:"__update",value:function(e){e.hasOwnProperty("guest_id")&&(this.userId=String(e.guest_id)),e.hasOwnProperty("user_id")&&(this.userId=String(e.user_id)),e.hasOwnProperty("name")&&(this.nickname=String(e.name)),e.hasOwnProperty("nickname")&&(this.nickname=String(e.nickname)),e.hasOwnProperty("image")&&(this.plainProfileUrl=String(e.image)),e.hasOwnProperty("profile_url")&&(this.plainProfileUrl=String(e.profile_url)),!e.hasOwnProperty("is_online")||e.is_online===n.NON_AVAILABLE?this.connectionStatus=n.NON_AVAILABLE:this.connectionStatus=e.is_online?n.ONLINE:n.OFFLINE,e.hasOwnProperty("last_seen_at")?this.lastSeenAt=parseInt(e.last_seen_at):this.lastSeenAt=0,e.hasOwnProperty("metadata")?this.metaData=e.metadata:this.metaData={},e.hasOwnProperty("is_active")?this.isActive=void 0===e.is_active||e.is_active:this.isActive=!0,e.hasOwnProperty("friend_discovery_key")?this.friendDiscoveryKey=e.friend_discovery_key:this.friendDiscoveryKey=null,e.hasOwnProperty("friend_name")?this.friendName=e.friend_name:this.friendName=null,e.hasOwnProperty("preferred_languages")?this._preferredLanguages=e.preferred_languages||null:this._preferredLanguages=null,e.hasOwnProperty("require_auth_for_profile_image")?this.requireAuth=e.require_auth_for_profile_image:this.requireAuth=null}},{key:"_updateMetaData",value:function(e,n){var t=1<arguments.length&&void 0!==n&&n,r=pe.get(this._iid).GroupChannel;for(var i in e)t?delete this.metaData[i]:this.metaData[i]=e[i];for(var a in r.cachedChannels)if(r.cachedChannels.hasOwnProperty(a)){var s=r.cachedChannels[a];if(s.memberMap.hasOwnProperty(this.userId))s.memberMap[this.userId].metaData=this.metaData}}},{key:"serialize",value:function(){return x.serialize(this,function(e){e.hasOwnProperty("_preferredLanguages")&&(e.preferredLanguages=e._preferredLanguages,delete e._preferredLanguages)})}},{key:"getOriginalProfileUrl",value:function(){var e="";if((-1<(e=(e=-1<this.plainProfileUrl.indexOf("://")?this.plainProfileUrl.split("/")[2]:this.plainProfileUrl.split("/")[0]).split("?")[0]).indexOf("sendbird.com")||-1<e.indexOf("intoz.com")||-1<e.indexOf("file-local"))&&-1<this.plainProfileUrl.indexOf(e+"/profile_images/")){var n=this.plainProfileUrl.replace("profile_images/","");return n===this.plainProfileUrl?"":n}return""}},{key:"createMetaData",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"object",constraint:function(e){return 0<Object.keys(e).length&&!Array.isArray(e)}}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.createUserMetaData({metaData:e},function(e,n){e||i._updateMetaData(n),t(e,n)})},n)}},{key:"updateMetaData",value:function(e,n,t){var r,i=this,a=B(j.parse(arguments,[new j({type:"object",constraint:function(n){return!Array.isArray(n)&&0<Object.keys(n).length&&Object.keys(n).map(function(e){return n[e]}).every(function(e){return"string"==typeof e})}}),new j({type:"boolean",optional:!0,defaultValue:!1}),new j({type:"callback"})]),4);return r=a[0],e=a[1],n=a[2],t=a[3],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.updateUserMetaData({metaData:e,upsert:n},function(e,n){e||i._updateMetaData(n),t(e,n)})},t)}},{key:"deleteMetaData",value:function(e,n){var i,a=this,t=B(j.parse(arguments,[new j({type:"string",constraint:function(e){return 0<e.length}}),new j({type:"callback"})]),3);return i=t[0],e=t[1],n=t[2],Y(this._iid,function(t){if(i)t(i,null);else{var r={};r[e]="",_e.get(a._iid).container.apiClient.deleteUserMetaData({metaDataKey:e},function(e,n){e||a._updateMetaData(r,!0),t(e,n)})}},n)}},{key:"deleteAllMetaData",value:function(e){var i=this;return Y(this._iid,function(t){var r=i.metaData;_e.get(i._iid).container.apiClient.deleteAllUserMetaData({},function(e,n){e||i._updateMetaData(r,!0),t(e,n)})},e)}},{key:"profileUrl",get:function(){if(this.requireAuth){var e=_e.get(this._iid).container.auth;return"".concat(this.plainProfileUrl,"?auth=").concat(e.eKey)}return this.plainProfileUrl}},{key:"preferredLanguages",get:function(){return this._preferredLanguages}}],[{key:"objectify",value:function(e){var n=e.userId,t=void 0===n?null:n,r=e.nickname,i=void 0===r?"":r,a=e.plainProfileUrl,s=void 0===a?"":a,o=e.connectionStatus,l=void 0===o?"":o,u=e.lastSeenAt,c=void 0===u?0:u,d=e.metaData,h=void 0===d?{}:d,p=e.isActive,f=void 0===p||p,g=e.friendDiscoveryKey,_=void 0===g?null:g,y=e.friendName,m=void 0===y?null:y,v=e.preferredLanguages,C=void 0===v?null:v,E=e.requireAuth;return{user_id:t,nickname:i,profile_url:s,is_online:l,last_seen_at:c,metadata:h,is_active:f,friend_discovery_key:_,friend_name:m,preferred_languages:C,require_auth_for_profile_image:void 0!==E&&E}}},{key:"build",value:function(e,n,t,r,i,a,s,o,l,u,c){return this.objectify({userId:e,nickname:n,plainProfileUrl:t,connectionStatus:r,lastSeenAt:i,metaData:a,isActive:s,friendDiscoveryKey:o,friendName:l,preferredLanguages:u,requireAuth:c})}},{key:"buildFromSerializedData",value:function(e){var n=pe.get(this._iid).User,t=x.deserialize(e);return new n(n.objectify(t))}},{key:"NON_AVAILABLE",get:function(){return"nonavailable"}},{key:"ONLINE",get:function(){return"online"}},{key:"OFFLINE",get:function(){return"offline"}}]),n}(),X={TIMESTAMP:"timestamp",MESSAGE_ID:"messageId"},Z=function(){function G(e){v(this,G),this.url="",this.channelType=G.CHANNEL_TYPE_BASE,this.name="",this.coverUrl="",this.creator=null,this.createdAt=0,this.data=null,this.customType=null,this.isFrozen=!1,this.isEphemeral=!1,e&&(this.__update(e),e.__wk&&(this.__wk=e.__wk))}return s(G,[{key:"__update",value:function(e){this.url=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.name=e.hasOwnProperty("name")?String(e.name):"",this.coverUrl=e.hasOwnProperty("cover_url")?String(e.cover_url):"",this.createdAt=e.hasOwnProperty("created_at")?1e3*e.created_at:0,this.data=e.hasOwnProperty("data")?String(e.data):"",this.customType=e.hasOwnProperty("custom_type")?e.custom_type:"",this.isFrozen=!!e.hasOwnProperty("freeze")&&e.freeze,this.isEphemeral=!!e.hasOwnProperty("is_ephemeral")&&e.is_ephemeral,e.hasOwnProperty("created_by")&&null!==e.created_by&&"object"===fe(e.created_by)&&0<Object.keys(e.created_by).length?this.creator=new J(e.created_by):this.creator=null}},{key:"isGroupChannel",value:function(){var e=pe.get(this._iid).BaseChannel;return this.channelType===e.CHANNEL_TYPE_GROUP}},{key:"isOpenChannel",value:function(){var e=pe.get(this._iid).BaseChannel;return this.channelType===e.CHANNEL_TYPE_OPEN}},{key:"createOperatorListQuery",value:function(){return new(pe.get(this._iid).OperatorListQuery)(this)}},{key:"createMessageListQuery",value:function(){return new(pe.get(this._iid).MessageListQuery)(this)}},{key:"createPreviousMessageListQuery",value:function(){return new(pe.get(this._iid).PreviousMessageListQuery)(this)}},{key:"serialize",value:function(){return x.serialize(this,function(e){if(null!==e.lastMessage&&"object"===fe(e.lastMessage)){var n=e.lastMessage;n.hasOwnProperty("_sender")&&(n.sender=n._sender,delete n._sender,e.lastMessage=n)}e.hasOwnProperty("_messageOffsetTimestamp")&&(e.messageOffsetTimestamp=e._messageOffsetTimestamp,delete e._messageOffsetTimestamp)})}},{key:"getMessageChangeLogsByTimestamp",value:function(e,n,t,r){var a,s=this,i=B(j.parse(arguments,[new j({type:"number",constraint:function(e){return 0<=e}}),new j({type:"boolean",optional:!0,defaultValue:!1}),new j({type:"boolean",optional:!0,defaultValue:!1}),new j({type:"callback"})]),5);return a=i[0],e=i[1],n=i[2],t=i[3],r=i[4],Y(this._iid,function(i){a?i(a,null):_e.get(s._iid).container.apiClient.getMessageChangeLogs({channelUrl:s.url,ts:e,token:null,isOpenChannel:s.isOpenChannel(),includeMetaArray:n,includeReactions:t},function(e,n){var t=null;if(!e){var r=pe.get(s._iid).BaseChannel;t={updatedMessages:n.updated.map(function(e){return r.buildMessage(e,s)}),deletedMessageIds:n.deleted.map(function(e){return parseInt(e.message_id)}),hasMore:n.has_more,token:n.next}}i(e,t)})},r)}},{key:"getMessageChangeLogsByToken",value:function(e,n,t,r){var a,s=this,i=B(j.parse(arguments,[new j({type:"string",nullable:!0}),new j({type:"boolean",optional:!0,defaultValue:!1}),new j({type:"boolean",optional:!0,defaultValue:!1}),new j({type:"callback"})]),5);return a=i[0],e=i[1],n=i[2],t=i[3],r=i[4],Y(this._iid,function(i){a?i(a,null):_e.get(s._iid).container.apiClient.getMessageChangeLogs({channelUrl:s.url,ts:null,token:e,isOpenChannel:s.isOpenChannel(),includeMetaArray:n,includeReactions:t},function(e,n){var t=null;if(!e){var r=pe.get(s._iid).BaseChannel;t={updatedMessages:n.updated.map(function(e){return r.buildMessage(e,s)}),deletedMessageIds:n.deleted.map(function(e){return parseInt(e.message_id)}),hasMore:n.has_more,token:n.next}}i(e,t)})},r)}},{key:"getMessageChangeLogsSinceToken",value:function(e,n,t){var i,a=this,r=pe.get(this._iid),s=r.BaseChannel,o=r.MessageChangeLogsParams,l=B(j.parse(arguments,[new j({type:"string",nullable:!0}),new j({type:o}),new j({type:"callback"})]),4);return i=l[0],e=l[1],n=l[2],t=l[3],Y(this._iid,function(r){i?r(i,null):_e.get(a._iid).container.apiClient.getMessageChangeLogs(g({channelUrl:a.url,ts:null,token:e,isOpenChannel:a.isOpenChannel()},n),function(e,n){var t=null;e||(t={updatedMessages:n.updated.map(function(e){return s.buildMessage(e,a)}),deletedMessageIds:n.deleted.map(function(e){return parseInt(e.message_id)}),hasMore:n.has_more,token:n.next}),r(e,t)})},t)}},{key:"getMessageChangeLogsSinceTimestamp",value:function(e,n,t){var i,a=this,r=pe.get(this._iid),s=r.BaseChannel,o=r.MessageChangeLogsParams,l=B(j.parse(arguments,[new j({type:"number",constraint:function(e){return 0<=e}}),new j({type:o}),new j({type:"callback"})]),4);return i=l[0],e=l[1],n=l[2],t=l[3],Y(this._iid,function(r){i?r(i,null):_e.get(a._iid).container.apiClient.getMessageChangeLogs(g({channelUrl:a.url,timestamp:e,token:null,isOpenChannel:a.isOpenChannel()},n),function(e,n){var t=null;e||(t={updatedMessages:n.updated.map(function(e){return s.buildMessage(e,a)}),deletedMessageIds:n.deleted.map(function(e){return parseInt(e.message_id)}),hasMore:n.has_more,token:n.next}),r(e,t)})},t)}},{key:"getMyMutedInfo",value:function(e){var n=this;return Y(this._iid,function(r){var e=Sn.getInstance(n._iid);_e.get(n._iid).container.apiClient.getMyMutedInfo({channelUrl:n.url,userId:e.currentUser?e.currentUser.userId:null,isGroupChannel:n.isGroupChannel()},function(e,n){var t=null;e||(t={isMuted:n.is_muted,startAt:n.start_at,endAt:n.end_at,remainingDuration:n.remaining_duration,description:n.description}),r(e,t)})},e)}},{key:"_parseMessageListParams",value:function(e){for(var n=new(pe.get(this._iid).MessageListParams),t=null,r=!1,i=0,a=0,s=!1,o="",l="",u=null,c=!1,d=!1,h=null,p=arguments.length,f=new Array(1<p?p-1:0),g=1;g<p;g++)f[g-1]=arguments[g];switch(e){case"prev":var _=B(j.parse(f,[new j({type:"number"}),new j({type:"boolean"}),new j({type:"number"}),new j({type:"boolean"}),new j({type:"string"}),new j({type:"string"}),new j({type:"array",optional:!0}),new j({type:"boolean",optional:!0,defaultValue:!1}),new j({type:"boolean",optional:!0,defaultValue:!1}),new j({type:"callback"})]),11);t=_[0],_[1],r=_[2],i=_[3],s=_[4],o=_[5],l=_[6],u=_[7],c=_[8],d=_[9],h=_[10];break;case"next":var y=B(j.parse(f,[new j({type:"number"}),new j({type:"boolean"}),new j({type:"number"}),new j({type:"boolean"}),new j({type:"string"}),new j({type:"string"}),new j({type:"array",optional:!0}),new j({type:"boolean",optional:!0,defaultValue:!1}),new j({type:"boolean",optional:!0,defaultValue:!1}),new j({type:"callback"})]),11);t=y[0],y[1],r=y[2],a=y[3],s=y[4],o=y[5],l=y[6],u=y[7],c=y[8],d=y[9],h=y[10];break;case"prevnext":var m=B(j.parse(f,[new j({type:"number"}),new j({type:"number"}),new j({type:"number"}),new j({type:"boolean"}),new j({type:"string"}),new j({type:"string"}),new j({type:"array",optional:!0}),new j({type:"boolean",optional:!0,defaultValue:!1}),new j({type:"boolean",optional:!0,defaultValue:!1}),new j({type:"callback"})]),11);t=m[0],m[1],i=m[2],a=m[3],s=m[4],o=m[5],l=m[6],u=m[7],c=m[8],d=m[9],h=m[10],r=!0}return t?[null,h]:(n.isInclusive=r,n.prevResultSize=i,n.nextResultSize=a,n.reverse=s,n.messageType=o,n.customType=l,n.senderUserIds=u,n.includeMetaArray=c,n.includeReactions=d,[n,h])}},{key:"_getMessageList",value:function(e,n,t,r){var a,s=this,i=pe.get(this._iid).MessageListParams,o=B(j.parse(arguments,[new j({type:"number"}),new j({type:"string",constraint:function(e){return Object.values(X).includes(e)}}),new j({type:i,constraint:function(e){return e._validate()}}),new j({type:"callback"})]),5);return a=o[0],e=o[1],n=o[2],t=o[3],r=o[4],Y(this._iid,function(i){a?i(a,null):_e.get(s._iid).container.apiClient.getMessageList(g(g({channel:s,token:e,tokenType:n},t),{},{shouldReverse:t.reverse}),function(e,n){if(e)i(e,null);else{var t=pe.get(s._iid).BaseChannel,r=n.messages.map(function(e){return t.buildMessage(e,s)}).filter(function(e){return null!==e});i(null,r)}})},r)}},{key:"getPreviousMessagesByTimestamp",value:function(e){var n=B(this._parseMessageListParams.apply(this,["prev"].concat(b(j.toArray(arguments)))),2),t=n[0],r=n[1];return this._getMessageList(e,X.TIMESTAMP,t,r)}},{key:"getNextMessagesByTimestamp",value:function(e){var n=B(this._parseMessageListParams.apply(this,["next"].concat(b(j.toArray(arguments)))),2),t=n[0],r=n[1];return this._getMessageList(e,X.TIMESTAMP,t,r)}},{key:"getPreviousAndNextMessagesByTimestamp",value:function(e){var n=B(this._parseMessageListParams.apply(this,["prevnext"].concat(b(j.toArray(arguments)))),2),t=n[0],r=n[1];return this._getMessageList(e,X.TIMESTAMP,t,r)}},{key:"getPreviousMessagesByID",value:function(e){var n=B(this._parseMessageListParams.apply(this,["prev"].concat(b(j.toArray(arguments)))),2),t=n[0],r=n[1];return this._getMessageList(e,X.MESSAGE_ID,t,r)}},{key:"getNextMessagesByID",value:function(e){var n=B(this._parseMessageListParams.apply(this,["next"].concat(b(j.toArray(arguments)))),2),t=n[0],r=n[1];return this._getMessageList(e,X.MESSAGE_ID,t,r)}},{key:"getPreviousAndNextMessagesByID",value:function(e){var n=B(this._parseMessageListParams.apply(this,["prevnext"].concat(b(j.toArray(arguments)))),2),t=n[0],r=n[1];return this._getMessageList(e,X.MESSAGE_ID,t,r)}},{key:"getMessagesByTimestamp",value:function(e,n,t){return this._getMessageList(e,X.TIMESTAMP,n,t)}},{key:"getMessagesByMessageId",value:function(e,n,t){return this._getMessageList(e,X.MESSAGE_ID,n,t)}},{key:"_sendUserMessage",value:function(e){var o=this,n=e.reqId,t=e.message,r=e.data,i=e.customType,a=e.metaArrays,s=e.mentionType,l=e.mentionedUserIds,u=e.pushNotificationDeliveryOption,c=e.rootMessageId,d=e.parentMessageId,h=e.translationTargetLanguages,p=e.silent,f=void 0!==p&&p,g=e.callback,_=pe.get(this._iid),y=_.Command,m=_.UserMessage;n=n||y.generateRequestId();var v=Sn.getInstance(this._iid),C={};Array.isArray(h)&&h.forEach(function(e){return C[e]=""});var E=m.objectify({messageId:0,reqId:n,user:v.currentUser||{},channel:this,message:t,data:r,customType:i,metaArrays:a,mentionType:s,mentionedUserIds:l,rootMessageId:c,parentMessageId:d,translations:C,silent:f,createdAt:(new Date).getTime()}),U=new m(E);if(U.requestState=v.MessageRequestState.PENDING,U.sendingStatus=v.MessageSendingStatus.PENDING,U.requestedMentionUserIds=l,!v.currentUser){var b=new ye("Connection should be made first.",ye.CONNECTION_REQUIRED),A=new m(E);return A.requestState=v.MessageRequestState.FAILED,A.sendingStatus=v.MessageSendingStatus.FAILED,A.requestedMentionUserIds=l,A.errorCode=b.code,g(b,A),U}var I=y.bMessage({channelUrl:this.url,message:t,data:r,customType:i,metaArrays:a,mentionType:s,mentionedUserIds:l,requestId:n,rootMessageId:c,parentMessageId:d,silent:f,translationTargetLanguages:h,pushNotificationDeliveryOption:u});(U.reqId=I.requestId,this.isGroupChannel()&&v.getConnectionState()!==v.ConnectionState.OPEN&&v.currentUser&&!v.connecting&&!v.reconnecting&&"string"==typeof i&&0===i.indexOf("SB_VIDEOCHAT"))?_e.get(v._iid).container.apiClient.sendUserMessage({channelUrl:this.url,isOpenChannel:this.isOpenChannel(),message:t,data:r,customType:i,translationTargetLanguages:h,metaArrays:a,mentionType:s,mentionedUserIds:l,pushNotificationDeliveryOption:u,rootMessageId:c,parentMessageId:d},function(e,n){var t=null;e?((t=new m(E)).requestState=v.MessageRequestState.FAILED,t.sendingStatus=v.MessageSendingStatus.FAILED,e.code===ye.REQUEST_CANCELED&&(t.sendingStatus=v.MessageSendingStatus.CANCELED),t.requestedMentionUserIds=l,t.errorCode=e.code):((t=new m(n)).requestState=v.MessageRequestState.SUCCEEDED,t.sendingStatus=v.MessageSendingStatus.SUCCEEDED),g(e,t)}):v.sendCommand(I,function(e,n){if(v.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n){var r=new m(E);r.reqId=I.requestId,r.requestState=v.MessageRequestState.FAILED,r.sendingStatus=v.MessageSendingStatus.FAILED,n.code===ye.REQUEST_CANCELED&&(r.sendingStatus=v.MessageSendingStatus.CANCELED),r.requestedMentionUserIds=l,r.errorCode=n.code,g(new ye(n.message,n.code),r)}else{var i=new m(e.getJsonElement()),a=v.currentUser;if(a&&i._sender&&a.userId===i._sender.userId&&(a.nickname!==i._sender.nickname&&(a.nickname=i._sender.nickname),a.plainProfileUrl!==i._sender.plainProfileUrl&&(a.plainProfileUrl=i._sender.plainProfileUrl),ve.deepEqual(a.metaData,i._sender.metaData)||(a.metaData=i._sender.metaData)),o.isGroupChannel())for(var s in o.lastMessage=i,v.channelHandlers){v.channelHandlers[s].onChannelChanged(o)}i.requestState=v.MessageRequestState.SUCCEEDED,i.sendingStatus=v.MessageSendingStatus.SUCCEEDED,g(null,i)}});return U}},{key:"sendUserMessage",value:function(){var e=j.toArray(arguments),t=e.pop(),n=null,r=null,i=pe.get(this._iid).UserMessageParams;if("function"==typeof t)if(e[0]instanceof i)null===(r=e[0]).data&&(r.data=""),null===r.customType&&(r.customType="");else if("string"==typeof e[0])switch((r=new i).message=e[0],e.length){case 1:break;case 2:r.data=e[1]||"";break;case 3:r.data=e[1]||"",r.customType=e[2]||"";break;case 4:r.data=e[1]||"",r.customType=e[2]||"",r.translationTargetLanguages=Array.isArray(e[3])?e[3]:[e[3]];break;default:n=j.error}else n=j.error;else n=j.error;var a=_e.get(this._iid).container.isErrorFirstInCallback;return!n&&r._validate()&&r.message?this._sendUserMessage(g(g({},r),{},{metaArrays:r.metaArrays,mentionType:r.mentionType,mentionedUserIds:r._mentionedUserIds,rootMessageId:r.rootMessageId,parentMessageId:r.parentMessageId,translationTargetLanguages:r._translationTargetLanguages,callback:function(e,n){a?t(e,n):t(n,e)}})):(a?t(j.error,null):t(null,j.error),null)}},{key:"resendUserMessage",value:function(r,e){var i=this,n=pe.get(this._iid),t=n.UserMessage,a=n.UserMessageParams,s=null,o=B(j.parse(arguments,[new j({type:t,constraint:function(e){return 0===e.messageId&&e.isResendable()&&e.reqId&&e.channelUrl===i.url&&"string"==typeof e.message&&"string"==typeof e.data&&"string"==typeof e.customType&&"object"===fe(e.translations)&&!Array.isArray(e.translations)}}),new j({type:"callback"})]),3);return s=o[0],r=o[1],e=o[2],Y(this._iid,function(e){if(s)s.message+=" Please check if the failed message is resend-able with `message.isResendable().`",e(s,null);else{var n=Object.keys(r.translations),t=a.PushNotificationDeliveryOption.DEFAULT;i._sendUserMessage(g(g({},r),{},{mentionedUserIds:r.requestedMentionUserIds,translationTargetLanguages:n,pushNotificationDeliveryOption:t,reqId:r.reqId,callback:e}))}},e)}},{key:"updateUserMessage",value:function(n,e,t,r,i){var s=this,a=pe.get(this._iid),o=a.Command,l=a.UserMessage,u=a.UserMessageParams,c=arguments,d=null,h=null;if("number"==typeof n)switch(c.length){case 3:var p=B(j.parse(c,[new j({type:"number"}),new j({type:u}),new j({type:"callback"})]),4);d=p[0],n=p[1],h=p[2],i=p[3];break;case 5:h=new u;var f=B(j.parse(c,[new j({type:"number"}),new j({type:"string",nullable:!0}),new j({type:"string",nullable:!0}),new j({type:"string",nullable:!0}),new j({type:"callback"})]),6);d=f[0],n=f[1],e=f[2],t=f[3],r=f[4],i=f[5],h.message=e,h.data=t,h.customType=r}return Y(this._iid,function(i){if(!d&&h&&h._validate()){var e=o.bUpdateUserMessage(g(g({channelUrl:s.url,messageId:n},h),{},{mentionType:h._mentionType,mentionedUserIds:h._mentionedUserIds})),a=Sn.getInstance(s._iid);a.sendCommand(e,function(e,n){if(a.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}var r=null;n||(r=new l(e.getJsonElement())),i(n,r)})}else i(j.error,null)},i)}},{key:"translateUserMessage",value:function(e,n,t){var i,a=this,r=Sn.getInstance(this._iid),s=pe.get(this._iid).UserMessage,o=B(j.parse(arguments,[new j({type:s,constraint:function(e){return e.channelUrl===a.url&&e.sendingStatus===r.MessageSendingStatus.SUCCEEDED}}),new j({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new j({type:"callback"})]),4);return i=o[0],e=o[1],n=o[2],t=o[3],Y(this._iid,function(r){i?r(i,null):_e.get(a._iid).container.apiClient.translateUserMessage({channelUrl:a.url,isOpenChannel:a.isOpenChannel(),messageId:e.messageId,translationTargetLanguages:n},function(e,n){var t=null;e||(t=new s(n)),r(e,t)})},t)}},{key:"_parseFileMessageArguments",value:function(e){var n=pe.get(this._iid),t=n.BaseMessageParams,r=n.FileMessageParams,i={error:null,file:null,name:null,type:null,size:null,data:"",customType:"",thumbnailSizes:[],metaArrays:[],mentionType:t.MentionType.USERS,mentionedUserIds:[],pushNotificationDeliveryOption:r.PushNotificationDeliveryOption.DEFAULT,rootMessageId:null,parentMessageId:null,progressHandler:null,silent:!1,callback:null};if("function"==typeof e[e.length-1]&&(i.callback=e.pop()),"function"==typeof e[e.length-1]&&(i.progressHandler=e.pop()),e[0]instanceof r)i.file=e[0].file||e[0].fileUrl,i.name=e[0].fileName,i.type=e[0].mimeType,i.size=e[0].fileSize,i.data=e[0].data,i.customType=e[0].customType,i.thumbnailSizes=e[0].thumbnailSizes,i.metaArrays=e[0].metaArrays,i.mentionType=e[0]._mentionType,i.mentionedUserIds=e[0]._mentionedUserIds,i.pushNotificationDeliveryOption=e[0].pushNotificationDeliveryOption?e[0].pushNotificationDeliveryOption:r.PushNotificationDeliveryOption.DEFAULT,i.rootMessageId=e[0].rootMessageId,i.parentMessageId=e[0].parentMessageId,i.silent=e[0].silent,e[0]._validate()||(i.error=j.error);else if(ve.isFile(e[0])||"string"==typeof e[0]){switch(i.file=e[0],e.length){case 1:break;case 2:i.data=e[1];break;case 3:i.data=e[1],i.customType=e[2];break;case 4:i.data=e[1],i.customType=e[2],i.thumbnailSizes=e[3];break;case 5:i.name=e[1],i.type=e[2],i.size=e[3],i.data=e[4];break;case 6:i.name=e[1],i.type=e[2],i.size=e[3],i.data=e[4],i.customType=e[5];break;case 7:i.name=e[1],i.type=e[2],i.size=e[3],i.data=e[4],i.customType=e[5],i.thumbnailSizes=e[6]}var a=B(j.parse([i.file,i.name,i.type,i.size,i.data,i.customType,i.thumbnailSizes],[new j({type:["file","string"]}),new j({type:"string",nullable:!0}),new j({type:"string",nullable:!0}),new j({type:"number",nullable:!0,constraint:function(e){return 0<=e}}),new j({type:"string",nullable:!0}),new j({type:"string",nullable:!0}),new j({type:"array"})]),8);i.error=a[0],i.file=a[1],i.name=a[2],i.type=a[3],i.size=a[4],i.data=a[5],i.customType=a[6],i.thumbnailSizes=a[7]}else i.error=j.error;return ve.isFile(i.file)&&(i.name=i.name||i.file.name,i.type=i.type||i.file.type,i.size=i.size||i.file.size),i}},{key:"_createTempFileMessage",value:function(e){try{var n=Sn.getInstance(this._iid),t=pe.get(this._iid),r=t.Command,i=t.FileMessage,a=i.objectify(g(g({},e),{},{messageId:0,reqId:r.generateRequestId(),user:n.currentUser||{},channel:this,plainUrl:"string"==typeof e.file?e.file:"",thumbnails:e.thumbnailSizes.map(function(e){return{url:"",plainUrl:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}}),sendingStatus:n.MessageSendingStatus.PENDING,createdAt:(new Date).getTime()}));return new i(a)}catch(e){return null}}},{key:"sendFileMessage",value:function(){var e=this._parseFileMessageArguments(j.toArray(arguments)),n=null,t=pe.get(this._iid).Command.generateRequestId();e.error||((n=this._createTempFileMessage(e)).requestedMentionUserIds=e.mentionedUserIds,t=n.reqId);var r=Sn.getInstance(this._iid);r&&r.currentUser||(e.error=new ye("Connection should be made first.",ye.CONNECTION_REQUIRED));var i=pe.get(this._iid).FileMessageQueue;return i.create(this).addJob(new i.Job({fileInfo:e,pendingMessage:n,requestId:t,error:e.error,response:null})),n}},{key:"sendFileMessages",value:function(r,e){var n=this,t=1<arguments.length&&void 0!==e?e:{},i=t.progress?t.progress:function(){},a=t.sent?t.sent:function(){},s=t.complete?t.complete:function(){};if(Array.isArray(r)&&0<r.length&&r.length<=20){var o=[];return r.forEach(function(e,t){o.push(n.sendFileMessage(e,i,function(e,n){a(e,n),t===r.length-1&&s(null)}))}),o}return s(j.error),null}},{key:"resendFileMessage",value:function(t,r,e){var i=this,n=pe.get(this._iid),a=n.FileMessage,s=n.FileMessageParams,o=null,l=B(j.parse(arguments,[new j({type:a,constraint:function(e){return 0===e.messageId&&e.isResendable()&&e.reqId&&e.channelUrl===i.url&&"string"==typeof e.data&&"string"==typeof e.customType&&Array.isArray(e.thumbnails)}}),new j({type:"file",optionalIf:function(e){return!!e[0].url},defaultValue:null}),new j({type:"callback"})]),4);return o=l[0],t=l[1],r=l[2],e=l[3],Y(this._iid,function(e){if(o)o.message+=" Please check if the failed message is resend-able with `message.isResendable().`",e(o,null);else{var n=new s;t.url?n.fileUrl=t.url:n.file=r,n.fileName=t.name,n.fileSize=t.size,n.mimeType=t.type,n.data=t.data,n.customType=t.customType,n.mentionType=t.mentionType,n.mentionedUserIds=t.requestedMentionUserIds,n.metaArrays=t.metaArrays,n.thumbnailSizes=t.thumbnails.map(function(e){return{maxWidth:e.width,maxHeight:e.height}}),i.sendFileMessage(n,e)}},e)}},{key:"updateFileMessage",value:function(n,e,t,r){var s=this,i=pe.get(this._iid),o=i.Command,l=i.FileMessage,a=i.FileMessageParams,u=arguments,c=null,d=null;if("number"==typeof n)switch(u.length){case 3:var h=B(j.parse(u,[new j({type:"number"}),new j({type:a}),new j({type:"callback"})]),4);c=h[0],n=h[1],d=h[2],r=h[3],d&&(d._isUpdate=!0);break;case 4:d=new a;var p=B(j.parse(u,[new j({type:"number"}),new j({type:"string",nullable:!0}),new j({type:"string",nullable:!0}),new j({type:"callback"})]),5);c=p[0],n=p[1],e=p[2],t=p[3],r=p[4],d.data=e,d.customType=t,d._isUpdate=!0}return Y(this._iid,function(i){if(!c&&d&&d._validate()){var e=o.bUpdateFileMessage(g(g({channelUrl:s.url,messageId:n},d),{},{mentionType:d._mentionType,mentionedUserIds:d._mentionedUserIds})),a=Sn.getInstance(s._iid);a.sendCommand(e,function(e,n){if(a.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}var r=null;n||(r=new l(e.getJsonElement())),i(n,r)})}else i(j.error,null)},r)}},{key:"cancelUploadingFileMessage",value:function(e,t){var n,r=B(j.parse(arguments,[new j({type:["number","string"]}),new j({type:"callback"})]),3);n=r[0],e=r[1],t=r[2];var i=_e.get(this._iid).container.isErrorFirstInCallback;return n?(i?t(n,null):t(null,n),!1):pe.get(this._iid).FileMessageQueue.create(this).cancelUploadItemByRequestId(e,function(e,n){return i?t(e,n):t(n,e)})}},{key:"addReaction",value:function(i,e,n){var t,a=this,s=Sn.getInstance(this._iid),o=pe.get(this._iid).ReactionEvent,r=B(j.parse(arguments,[new j({type:W}),new j({type:"string",constraint:function(e){return 0<e.length}}),new j({type:"callback"})]),4);return t=r[0],i=r[1],e=r[2],n=r[3],Y(this._iid,function(r){t?r(t,null):i.sendingStatus===s.MessageSendingStatus.SUCCEEDED?_e.get(a._iid).container.apiClient.addReaction({isGroupChannel:i.isGroupChannel(),channelUrl:i.channelUrl,messageId:i.messageId,key:e},function(e,n){var t=null;e||(t=o.createFromJson(g(g({},n),{},{msg_id:i.messageId}))),r(e,t)}):r(new ye("Cannot add reaction to a non-succeeded message.",ye.REQUEST_FAILED),null)},n)}},{key:"deleteReaction",value:function(i,e,n){var t,a=this,s=Sn.getInstance(this._iid),o=pe.get(this._iid).ReactionEvent,r=B(j.parse(arguments,[new j({type:W}),new j({type:"string",constraint:function(e){return 0<e.length}}),new j({type:"callback"})]),4);return t=r[0],i=r[1],e=r[2],n=r[3],Y(this._iid,function(r){t?r(t,null):i.sendingStatus===s.MessageSendingStatus.SUCCEEDED?_e.get(a._iid).container.apiClient.deleteReaction({isGroupChannel:i.isGroupChannel(),channelUrl:i.channelUrl,messageId:i.messageId,key:e},function(e,n){var t=null;e||(t=o.createFromJson(g(g({},n),{},{msg_id:i.messageId}))),r(e,t)}):r(new ye("Cannot remove reaction to a non-succeeded message.",ye.REQUEST_FAILED),null)},n)}},{key:"deleteMessage",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"object",constraint:function(e){return!Array.isArray(e)&&null!==e&&e.hasOwnProperty("messageId")}}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.deleteMessage({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),messageId:e.messageId},function(e,n){return t(e,null)})},n)}},{key:"copyUserMessage",value:function(e,n,t){var r,i=pe.get(this._iid),a=(i.Command,i.UserMessage),s=i.BaseMessageParams,o=B(j.parse(arguments,[new j({type:G}),new j({type:a}),new j({type:"callback"})]),4);r=o[0],e=o[1],n=o[2],t=o[3];var l=_e.get(this._iid).container.isErrorFirstInCallback;if(r)return l?t(j.error,null):t(null,j.error),null;if(this.url!==n.channelUrl){var u=new ye("The message does not belong to this channel",ye.INVALID_PARAMETER);return l?t(u,null):t(null,u),null}var c={},d=Object.keys(n.translations);d.forEach(function(e){return c[e]=""});var h=s.PushNotificationDeliveryOption.DEFAULT;return e._sendUserMessage(g(g({},n),{},{reqId:null,pushNotificationDeliveryOption:h,translationTargetLanguages:d,rootMessageId:null,parentMessageId:null,parentMessageText:null,callback:t}))}},{key:"copyFileMessage",value:function(o,e,l){var n,t=pe.get(this._iid),r=t.Command,u=(t.GroupChannel,t.FileMessage),i=t.BaseMessageParams,a=(t.FileMessageParams,t.User),s=B(j.parse(arguments,[new j({type:G}),new j({type:u}),new j({type:"callback"})]),4);n=s[0],o=s[1],e=s[2],l=s[3];var c=_e.get(this._iid),d=c.container.isErrorFirstInCallback;if(n)return d?l(j.error,null):l(null,j.error),null;if(this.url!==e.channelUrl){var h=new ye("The message does not belong to this channel");return d?l(h,null):l(null,h),null}var p=Sn.getInstance(this._iid),f=e.url,g=e.name,_=e.type,y=e.size,m=e.data,v=e.customType,C=e.mentionType,E=e.mentionedUserIds,U=e.mentionedUsers,b=e.metaArrays,A=e.thumbnails,I=e.requireAuth,S=e.messageSurvivalSeconds,N=e.silent,k=r.generateRequestId(),R=p.currentUser||{},M=o.url,T=o.isOpenChannel(),O=U.filter(function(e){return new a(a.objectify(e))}),L=i.PushNotificationDeliveryOption.DEFAULT,P=u.objectify({messageId:0,reqId:k,user:R,channel:o,plainUrl:f,name:g,type:_,size:y,data:m,customType:v,mentionType:C,mentionedUserIds:E,mentionedUsers:O,requestedMentionUserIds:E,metaArrays:b,thumbnails:A,requireAuth:I,messageSurvivalSeconds:S,silent:N,createdAt:(new Date).getTime()}),w=new u(P);if(w.requestState=p.MessageRequestState.PENDING,w.sendingStatus=p.MessageSendingStatus.PENDING,!p.currentUser){var D=new ye("Connection should be made first.",ye.CONNECTION_REQUIRED),H=new u(P);return H.requestState=p.MessageRequestState.FAILED,H.sendingStatus=p.MessageSendingStatus.FAILED,H.errorCode=D.code,d?l(D,H):l(H,D),w}var F=r.bFile({requestId:k,channelUrl:M,url:f,name:g,type:_,size:y,data:m,customType:v,metaArrays:b,mentionType:C,mentionedUserIds:E,thumbnailSizes:A,requireAuth:I,pushNotificationDeliveryOption:L,silent:N});return p.getConnectionState()===p.ConnectionState.OPEN||p.connecting||p.reconnecting?p.sendCommand(F,function(e,n){if(p.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)if(n.code!==ye.INVALID_PARAMETER){var r=new u(P);r.requestState=p.MessageRequestState.FAILED,r.sendingStatus=p.MessageSendingStatus.FAILED,n.code!==ye.FILE_UPLOAD_CANCEL_FAILED&&n.code!==SendBridException.REQUEST_CANCELED||(r.sendingStatus=p.MessageSendingStatus.CANCELED),r.errorCode=n.code,d?l(n,r):l(r,n)}else d?l(n,null):l(null,n);else{var i=new u(e.getJsonElement()),a=i._sender;if(R&&a&&R.userId===a.userId&&(R.nickname!==a.nickname&&(R.nickname=a.nickname),R.plainProfileUrl!==a.plainProfileUrl&&(R.plainProfileUrl=a.plainProfileUrl)),o.isGroupChannel())for(var s in o.lastMessage=i,p.channelHandlers){p.channelHandlers[s].onChannelChanged(o)}d?l(null,i):l(i,null)}}):c.container.apiClient.sendFileMessage({channelUrl:M,isOpenChannel:T,fileUrl:f,fileName:g,fileType:_,fileSize:y,data:m,customType:v,metaArrays:b,mentionType:C,mentionedUserIds:E,thumbnailSizes:A,requireAuth:I,pushNotificationDeliveryOption:L},function(e,n){if(e)if(e.code!==ye.INVALID_PARAMETER){var t=new u(commnad.getJsonElement());t.requestState=p.MessageRequestState.FAILED,t.sendingStatus=p.MessageSendingStatus.FAILED,e.code!==ye.FILE_UPLOAD_CANCEL_FAILED&&e.code!==SendBridException.REQUEST_CANCELED||(t.sendingStatus=p.MessageSendingStatus.CANCELED),t.errorCode=e.code,d?l(e,t):l(t,e)}else d?l(e,null):l(null,e);else{var r=new u(n),i=r._sender;if(R&&i&&R.userId===i.userId&&(R.nickname!==i.nickname&&(R.nickname=i.nickname),R.plainProfileUrl!==i.plainProfileUrl&&(R.plainProfileUrl=i.plainProfileUrl)),o.isGroupChannel())for(var a in o.lastMessage=r,p.channelHandlers){p.channelHandlers[a].onChannelChanged(o)}d?l(null,r):l(r,null)}}),w}},{key:"addOperators",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"array",constraint:function(n){return Object.keys(n).map(function(e){return n[e]}).every(function(e){return"string"==typeof e})}}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.addOperators({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),operatorUserIds:e},function(e,n){return t(e,n)})},n)}},{key:"removeOperators",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"array",constraint:function(n){return Object.keys(n).map(function(e){return n[e]}).every(function(e){return"string"==typeof e})}}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.removeOperators({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),operatorUserIds:e},function(e,n){return t(e,n)})},n)}},{key:"getMetaCounters",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"array",constraint:function(n){return Object.keys(n).map(function(e){return n[e]}).every(function(e){return"string"==typeof e})}}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.getMetaCounters({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),keys:e},function(e,n){return t(e,n)})},n)}},{key:"getAllMetaCounters",value:function(e){var n=this;return Y(this._iid,function(t){_e.get(n._iid).container.apiClient.getMetaCounters({channelUrl:n.url,isOpenChannel:n.isOpenChannel(),keys:[]},function(e,n){return t(e,n)})},e)}},{key:"createMetaCounters",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"object",constraint:function(n){return n&&!Array.isArray(n)&&0<Object.keys(n).length&&Object.keys(n).map(function(e){return n[e]}).every(function(e){return"number"==typeof e})}}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.createMetaCounters({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),metaCounter:e},function(e,n){return t(e,n)})},n)}},{key:"updateMetaCounters",value:function(e,n,t){var r,i=this,a=B(j.parse(arguments,[new j({type:"object",constraint:function(n){return n&&!Array.isArray(n)&&0<Object.keys(n).length&&Object.keys(n).map(function(e){return n[e]}).every(function(e){return"number"==typeof e})}}),new j({type:"boolean",optional:!0,defaultValue:!1}),new j({type:"callback"})]),4);return r=a[0],e=a[1],n=a[2],t=a[3],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.updateMetaCounters({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),metaCounter:e,upsert:n,mode:"set"},function(e,n){return t(e,n)})},t)}},{key:"increaseMetaCounters",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"object",constraint:function(n){return n&&!Array.isArray(n)&&0<Object.keys(n).length&&Object.keys(n).map(function(e){return n[e]}).every(function(e){return"number"==typeof e})}}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.updateMetaCounters({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),metaCounter:e,upsert:!1,mode:"increase"},function(e,n){return t(e,n)})},n)}},{key:"decreaseMetaCounters",value:function(e,n){var t,r=this,i=B(j.parse(arguments,[new j({type:"object",constraint:function(n){return n&&!Array.isArray(n)&&0<Object.keys(n).length&&Object.keys(n).map(function(e){return n[e]}).every(function(e){return"number"==typeof e})}}),new j({type:"callback"})]),3);return t=i[0],e=i[1],n=i[2],Y(this._iid,function(i){t?i(t,null):_e.get(r._iid).container.apiClient.updateMetaCounters({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),metaCounter:e,upsert:!1,mode:"decrease"},function(e,n){var t=null;if(!e)for(var r in t={},n)t[r]=n[r];i(e,t)})},n)}},{key:"deleteMetaCounter",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"string"}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.deleteMetaCounter({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),key:e},function(e,n){return t(e,n)})},n)}},{key:"deleteAllMetaCounters",value:function(e){var n=this;return Y(this._iid,function(t){_e.get(n._iid).container.apiClient.deleteAllMetaCounters({channelUrl:n.url,isOpenChannel:n.isOpenChannel()},function(e,n){return t(e,n)})},e)}},{key:"getMetaData",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"array",constraint:function(n){return Object.keys(n).map(function(e){return n[e]}).every(function(e){return"string"==typeof e})}}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.getMetaData({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),keys:e},function(e,n){return t(e,n)})},n)}},{key:"getAllMetaData",value:function(e){var n=this;return Y(this._iid,function(t){_e.get(n._iid).container.apiClient.getMetaData({channelUrl:n.url,isOpenChannel:n.isOpenChannel(),keys:[]},function(e,n){return t(e,n)})},e)}},{key:"createMetaData",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"object",constraint:function(e){return e&&!Array.isArray(e)&&0<Object.keys(e).length}}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.createMetaData({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),metaData:e},function(e,n){return t(e,n)})},n)}},{key:"updateMetaData",value:function(e,n,t){var r,i=this,a=B(j.parse(arguments,[new j({type:"object",constraint:function(e){return e&&!Array.isArray(e)&&0<Object.keys(e).length}}),new j({type:"boolean",optional:!0,defaultValue:!1}),new j({type:"callback"})]),4);return r=a[0],e=a[1],n=a[2],t=a[3],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.updateMetaData({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),metaData:e,upsert:n},function(e,n){return t(e,n)})},t)}},{key:"deleteMetaData",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"string"}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.deleteMetaData({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),key:e},function(e,n){return t(e,n)})},n)}},{key:"deleteAllMetaData",value:function(e){var n=this;return Y(this._iid,function(t){_e.get(n._iid).container.apiClient.deleteAllMetaData({channelUrl:n.url,isOpenChannel:n.isOpenChannel()},function(e,n){return t(e,n)})},e)}},{key:"_updateMessageMetaArray",value:function(r,u,c,e){var d=this;return Y(this._iid,function(i){var e=pe.get(d._iid),n=e.Command,a=e.UserMessage,s=e.FileMessage,o=e.AdminMessage,t=null;if(u.isUserMessage()?t=n.bUpdateUserMessage({channelUrl:r,messageId:u.messageId,metaArrayParams:c}):u.isFileMessage()&&(t=n.bUpdateFileMessage({channelUrl:r,messageId:u.messageId,metaArrayParams:c})),t){var l=Sn.getInstance(d._iid);l.sendCommand(t,function(e,n){if(l.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}var r=null;n||(u.isUserMessage()?r=new a(e.getJsonElement()):u.isFileMessage()?r=new s(e.getJsonElement()):u.isAdminMessage()&&(r=new o(e.getJsonElement()))),i(n,r)})}else i(j.error,null)},e)}},{key:"createMessageMetaArrayKeys",value:function(e,n,t){var r,i=pe.get(this._iid).MessageMetaArray,a=B(j.parse(arguments,[new j({type:W}),new j({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e&&""!==e})}}),new j({type:"callback"})]),4);if(r=a[0],e=a[1],n=a[2],t=a[3],r)return Y(this._iid,function(e){e(r,null)},t);var s=[];if(Array.isArray(n))for(var o=0;o<n.length;o++){var l=n[o];s.push(new i(l,[]))}return this._updateMessageMetaArray(this.url,e,{array:s.map(function(e){return e.encode()}),mode:"add",upsert:!0},t)}},{key:"deleteMessageMetaArrayKeys",value:function(e,n,t){var r,i=pe.get(this._iid).MessageMetaArray,a=B(j.parse(arguments,[new j({type:W}),new j({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e&&""!==e})}}),new j({type:"callback"})]),4);if(r=a[0],e=a[1],n=a[2],t=a[3],r)return Y(this._iid,function(e){e(r,null)},t);var s=[];if(Array.isArray(n))for(var o=0;o<n.length;o++){var l=n[o];s.push(new i(l,[]))}return this._updateMessageMetaArray(this.url,e,{array:s.map(function(e){return e.encode()}),mode:"remove",upsert:!0},t)}},{key:"addMessageMetaArrayValues",value:function(e,n,t){var r,i=pe.get(this._iid).MessageMetaArray,a=B(j.parse(arguments,[new j({type:W}),new j({type:"object",constraint:function(n){return n&&(Array.isArray(n)&&0<n.length&&n.every(function(e){return e instanceof i})||0<Object.keys(n).length&&Object.keys(n).every(function(e){return Array.isArray(n[e])&&0<n[e].length&&n[e].every(function(e){return"string"==typeof e&&0<e.length})}))}}),new j({type:"callback"})]),4);if(r=a[0],e=a[1],n=a[2],t=a[3],r)return Y(this._iid,function(e){e(r,null)},t);var s=Array.isArray(n)?n.map(function(e){return e.encode()}):Object.keys(n).map(function(e){return{key:e,value:n[e]}});return this._updateMessageMetaArray(this.url,e,{array:s,mode:"add",upsert:!0},t)}},{key:"removeMessageMetaArrayValues",value:function(e,n,t){var r,i=pe.get(this._iid).MessageMetaArray,a=B(j.parse(arguments,[new j({type:W}),new j({type:"object",constraint:function(n){return n&&(Array.isArray(n)&&0<n.length&&n.every(function(e){return e instanceof i})||0<Object.keys(n).length&&Object.keys(n).every(function(e){return Array.isArray(n[e])&&0<n[e].length&&n[e].every(function(e){return"string"==typeof e&&0<e.length})}))}}),new j({type:"callback"})]),4);if(r=a[0],e=a[1],n=a[2],t=a[3],r)return Y(this._iid,function(e){e(r,null)},t);var s=Array.isArray(n)?n.map(function(e){return e.encode()}):Object.keys(n).map(function(e){return{key:e,value:n[e]}});return this._updateMessageMetaArray(this.url,e,{array:s,mode:"remove",upsert:!0},t)}},{key:"report",value:function(n,r,e){var i,a=this,t=pe.get(this._iid).BaseChannel,s=B(j.parse(arguments,[new j({type:t.ReportCategory}),new j({type:"string"}),new j({type:"callback"})]),4);return i=s[0],n=s[1],r=s[2],e=s[3],Y(this._iid,function(t){if(i)t(i,null);else{var e=Sn.getInstance(a._iid);_e.get(a._iid).container.apiClient.report({channelUrl:a.url,isOpenChannel:a.isOpenChannel(),reportCategory:n,reportingUserId:e.currentUser?e.currentUser.userId:null,reportDescription:r},function(e,n){t(e,null)})}},e)}},{key:"reportUser",value:function(n,r,i,e){var a,s=this,t=pe.get(this._iid).BaseChannel,o=B(j.parse(arguments,[new j({type:J}),new j({type:t.ReportCategory}),new j({type:"string"}),new j({type:"callback"})]),5);return a=o[0],n=o[1],r=o[2],i=o[3],e=o[4],Y(this._iid,function(t){if(a)t(a,null);else{var e=Sn.getInstance(s._iid);_e.get(s._iid).container.apiClient.reportUser({channelUrl:s.url,isOpenChannel:s.isOpenChannel(),reportCategory:r,offendingUserId:n.userId,reportingUserId:e.currentUser?e.currentUser.userId:null,reportDescription:i},function(e,n){t(e,null)})}},e)}},{key:"reportMessage",value:function(n,r,i,e){var a,s=this,t=pe.get(this._iid).BaseChannel,o=B(j.parse(arguments,[new j({type:W}),new j({type:t.ReportCategory}),new j({type:"string"}),new j({type:"callback"})]),5);return a=o[0],n=o[1],r=o[2],i=o[3],e=o[4],Y(this._iid,function(t){if(a)t(a,null);else{var e=Sn.getInstance(s._iid);_e.get(s._iid).container.apiClient.reportMessage({messageId:n.messageId,channelUrl:s.url,isOpenChannel:s.isOpenChannel(),reportCategory:r,offendingUserId:n.sender.userId,reportingUserId:e.currentUser?e.currentUser.userId:null,reportDescription:i},function(e,n){t(e,null)})}},e)}}],[{key:"buildMessage",value:function(e,n){var t=pe.get(this._iid),r=t.UserMessage,i=t.FileMessage,a=t.AdminMessage;if(e)switch(e.hasOwnProperty("channel_type")||(e.channel_type=n.channelType),e.type){case"MESG":return new r(e);case"FILE":var s=e.file;return new i(g(g({},e),{},{url:String(s.url),name:String(s.name),type:String(s.type),size:parseInt(s.size),data:String(s.data)}));case"BRDM":case"ADMM":return new a(e)}return null}},{key:"CHANNEL_TYPE_OPEN",get:function(){return"open"}},{key:"CHANNEL_TYPE_GROUP",get:function(){return"group"}},{key:"CHANNEL_TYPE_BASE",get:function(){return"base"}},{key:"MessageTypeFilter",get:function(){return{ALL:"",USER:"MESG",FILE:"FILE",ADMIN:"ADMM"}}},{key:"ReportCategory",get:function(){return{SPAM:"spam",HARASSING:"harassing",SUSPICIOUS:"suspicious",INAPPROPRIATE:"inappropriate"}}}]),G}(),Ee=function(){function n(e){v(this,n),e&&(this.category=e.hasOwnProperty("cat")?parseInt(e.cat):0,this.data=e.hasOwnProperty("data")?e.data:null,this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):Z.CHANNEL_TYPE_GROUP)}return s(n,[{key:"isGroupChannel",value:function(){return this.channelType===Z.CHANNEL_TYPE_GROUP}},{key:"isOpenChannel",value:function(){return this.channelType===Z.CHANNEL_TYPE_OPEN}}]),n}();Ee.CATEGORY_NONE=0,Ee.CATEGORY_CHANNEL_ENTER=10102,Ee.CATEGORY_CHANNEL_EXIT=10103,Ee.CATEGORY_USER_CHANNEL_MUTE=10201,Ee.CATEGORY_USER_CHANNEL_UNMUTE=10200,Ee.CATEGORY_USER_CHANNEL_BAN=10601,Ee.CATEGORY_USER_CHANNEL_UNBAN=10600,Ee.CATEGORY_CHANNEL_FREEZE=10701,Ee.CATEGORY_CHANNEL_UNFREEZE=10700,Ee.CATEGORY_TYPING_START=10900,Ee.CATEGORY_TYPING_END=10901,Ee.CATEGORY_CHANNEL_JOIN=1e4,Ee.CATEGORY_CHANNEL_LEAVE=10001,Ee.CATEGORY_CHANNEL_OPERATOR_UPDATE=10002,Ee.CATEGORY_CHANNEL_INVITE=10020,Ee.CATEGORY_CHANNEL_DECLINE_INVITE=10022,Ee.CATEGORY_CHANNEL_PROP_CHANGED=11e3,Ee.CATEGORY_CHANNEL_DELETED=12e3,Ee.CATEGORY_CHANNEL_META_DATA_CHANGED=11100,Ee.CATEGORY_CHANNEL_META_COUNTERS_CHANGED=11200,Ee.CATEGORY_CHANNEL_HIDE=13e3,Ee.CATEGORY_CHANNEL_UNHIDE=13001;function Ue(e){v(this,Ue),e&&(this.category=e.hasOwnProperty("cat")?parseInt(e.cat):0)}Ue.CATEGORY_USER_BLOCK=20001,Ue.CATEGORY_USER_UNBLOCK=2e4,Ue.CATEGORY_FRIEND_DISCOVERED=20900;var $=function(){function n(e){v(this,n),this.sb=e,this.cls=pe.get(this.sb._iid)}return s(n,[{key:"onRawCommandReceived",value:function(e){var v=this,n=this.cls,t=n.Command,d=n.User,h=n.Member,r=n.BaseChannel,p=n.GroupChannel,o=n.OpenChannel,i=n.UserMessage,a=n.FileMessage,s=n.AdminMessage,C=n.BaseMessageParams,l=n.ReactionEvent,u=n.ReadStatus,c=n.ThreadInfoUpdateEvent,f=_e.get(this.sb._iid),g=f.container,_=g.pinger,y=g.auth,m=g.subscribedUnreadMessageCount,E=g.ackStateMap,U=new t(e),b=U.getJsonElement();if(b.hasOwnProperty("unread_cnt")&&"object"===fe(b.unread_cnt)){var A=!1,I=b.unread_cnt.ts;if("number"==typeof I&&I>m.ts){if(m.all!==b.unread_cnt.all&&(A=!0),m.all=0<=b.unread_cnt.all?b.unread_cnt.all:0,b.unread_cnt.custom_types)for(var S in b.unread_cnt.custom_types)m.custom_types[S]!==b.unread_cnt.custom_types[S]&&(A=!0),m.custom_types[S]=b.unread_cnt.custom_types[S];A=A&&0<m.ts,m.ts=I}if(A)for(var N in this.sb.userEventHandlers)this.sb.userEventHandlers[N].onTotalUnreadMessageCountUpdated(m.all,m.custom_types)}var k=U.requestId;if(k){var R=E[k];if(R){clearTimeout(R.timer);var M=R.handler;M&&("EROR"===U.command?M(new ye(b.message,b.code),null):M(null,U)),E.hasOwnProperty(k)&&delete E[k]}}else switch(_&&"LOGI"!==U.command&&_.start(),U.command){case"LOGI":this.sb.loginTimer&&(clearTimeout(this.sb.loginTimer),this.sb.loginTimer=null,this.sb.onLoginTimerCancel=null,b.hasOwnProperty("error")?(this.sb.isSessionOpened=!1,this.sb.loginHandler(new ye(b.message,b.code),null)):(this.sb.isSessionOpened=!0,b.hasOwnProperty("key")&&(y.sessionKey=b.key),b.hasOwnProperty("ekey")&&(y.eKey=b.ekey),b.hasOwnProperty("user_id")&&(this.sb.currentUser=new d(b)),"number"==typeof b.ping_interval&&0<b.ping_interval&&f.set("pingInterval",1e3*b.ping_interval),"number"==typeof b.pong_timeout&&0<b.pong_timeout&&f.set("pongTimeout",1e3*b.pong_timeout),"number"==typeof b.login_ts&&f.set("connectedAt",1e3*b.login_ts),"number"==typeof b.max_unread_cnt_on_super_group?f.set("maxUnreadCountOfSuperGroupChannel",b.max_unread_cnt_on_super_group):f.set("maxUnreadCountOfSuperGroupChannel",ge.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL),b.profile_image_encryption&&f.set("profileImageEncryption",!0),_&&_.start(),b.hasOwnProperty("file_upload_size_limit")&&b.hasOwnProperty("premium_feature_list")&&b.hasOwnProperty("emoji_hash")&&f.set("appInfo",new Ce(b)),this.sb.loginHandler(null,this.sb.currentUser)),this.sb.connecting=!1,this.sb.reconnecting=!1);break;case"MESG":case"FILE":case"BRDM":case"ADMM":var T=null;if("MESG"===U.command?T=new i(b):"FILE"===U.command?T=new a(b):"BRDM"!==U.command&&"ADMM"!==U.command||(T=new s(b)),T){var O=this.sb.currentUser?this.sb.currentUser.userId:null,L=T.silent,P=!!b.force_update_last_message,w=T._sender&&T._sender.userId===O;if(T.isGroupChannel()){var D=t.bMessageAck({channelUrl:T.channelUrl,messageId:T.messageId});this.sb.sendCommand(D);var H=p.cachedChannels.hasOwnProperty(T.channelUrl);p.getChannel(T.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(!n){if(e.isHidden=!1,e.hiddenState=p.HiddenState.UNHIDDEN,p.cachedChannels[e.url]=e,T._sender&&e.memberMap.hasOwnProperty(T._sender.userId)){var r=e.memberMap[T._sender.userId];r.nickname!==T._sender.nickname&&(r.nickname=T._sender.nickname),r.plainProfileUrl!==T._sender.plainProfileUrl&&(r.plainProfileUrl=T._sender.plainProfileUrl),ve.deepEqual(r.metaData,T._sender.metaData)||(r.metaData=T._sender.metaData),r.isBlockedByMe!==T._sender.isBlockedByMe&&(r.isBlockedByMe=T._sender.isBlockedByMe)}var i=v.sb.currentUser;i&&w&&(i.nickname!==T._sender.nickname&&(i.nickname=T._sender.nickname),i.plainProfileUrl!==T._sender.plainProfileUrl&&(i.plainProfileUrl=T._sender.plainProfileUrl),ve.deepEqual(i.metaData,T._sender.metaData)||(i.metaData=T._sender.metaData));var a=!1;if(T.mentionType===C.MentionType.CHANNEL)w||(a=!0);else if(T.mentionType===C.MentionType.USERS)for(var s=0;s<T.mentionedUsers.length;s++)if(!w&&T.mentionedUsers[s].userId===O){a=!0;break}if(L&&!w||(e.isEphemeral||H)&&((!e.lastMessage||e.lastMessage.createdAt<T.createdAt)&&(e.lastMessage=T),w||e._setGroupChannelUnreadCount(e.unreadMessageCount+1,e.unreadMentionCount+(a?1:0))),P&&(!e.lastMessage||e.lastMessage.createdAt<T.createdAt)&&(e.lastMessage=T),!L||w)for(var o in v.sb.channelHandlers){v.sb.channelHandlers[o].onChannelChanged(e)}for(var l in v.sb.channelHandlers){var u=v.sb.channelHandlers[l];u.onMessageReceived(e,T),a&&u.onMentionReceived(e,T)}}})}else T.isOpenChannel()&&o.getChannel(T.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(!n){var r=!1;if(T.mentionType===C.MentionType.CHANNEL)r=!0;else if(T.mentionType===C.MentionType.USERS)for(var i=0;i<T.mentionedUsers.length;i++)if(T.mentionedUsers[i].userId===O){r=!0;break}for(var a in v.sb.channelHandlers){var s=v.sb.channelHandlers[a];o.enteredChannels[e.url]&&s.onMessageReceived(e,T),r&&s.onMentionReceived(e,T)}}})}break;case"MEDI":case"FEDI":case"AEDI":var F=null;if("MEDI"===U.command?F=new i(b):"FEDI"===U.command?F=new a(b):"AEDI"===U.command&&(F=new s(b)),F){var G=this.sb.currentUser?this.sb.currentUser.userId:null,B=F.silent,j=F.sender&&F.sender.userId===G;if(F.isGroupChannel()){var x=p.cachedChannels.hasOwnProperty(F.channelUrl);p.getChannel(F.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(!n){var r=e.cachedReadReceiptStatus[G],i=r&&r>=F.createAt,a=v.sb.currentUser;a&&j&&(a.nickname!==F._sender.nickname&&(a.nickname=F._sender.nickname),a.plainProfileUrl!==F._sender.plainProfileUrl&&(a.plainProfileUrl=F._sender.plainProfileUrl),ve.deepEqual(a.metaData,F._sender.metaData)||(a.metaData=F._sender.metaData));var s=!1,o=!1;if(!j&&!i&&b&&b.hasOwnProperty("old_values")){var l=b.old_values.mention_type||F.mentionType,u=b.old_values.mentioned_user_ids||F.mentionedUsers.map(function(e){return e.userId});if(l===C.MentionType.USERS&&F.mentionType===C.MentionType.USERS){for(var c=!1,d=!1,h=0;h<u.length;h++)if(u[h]===G){c=!0;break}for(var p=0;p<F.mentionedUsers.length;p++)if(F.mentionedUsers[p].userId===G){d=!0;break}!c&&d&&(o=!0,!B&&x&&(e._setGroupChannelUnreadCount(e.unreadMessageCount,e.unreadMentionCount+1),s=!0))}else if(l===C.MentionType.USERS&&F.mentionType===C.MentionType.CHANNEL){for(var f=!1,g=0;g<u.length;g++)if(u[g]===G){f=!0;break}f||(o=!0,!B&&x&&(e._setGroupChannelUnreadCount(e.unreadMessageCount,e.unreadMentionCount+1),s=!0))}}if(!e.lastMessage||e.lastMessage.createdAt<F.createdAt?(e.lastMessage=F,s=!0):e.lastMessage.createdAt===F.createdAt&&e.lastMessage.messageId===F.messageId&&(x?e.lastMessage.updatedAt<F.updatedAt&&(e.lastMessage=F,s=!0):s=!0),(!B||j)&&s)for(var _ in v.sb.channelHandlers){v.sb.channelHandlers[_].onChannelChanged(e)}for(var y in v.sb.channelHandlers){var m=v.sb.channelHandlers[y];m.onMessageUpdated(e,F),o&&m.onMentionReceived(e,F)}}})}else F.isOpenChannel()&&o.getChannel(F.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(!n)for(var r in v.sb.channelHandlers){v.sb.channelHandlers[r].onMessageUpdated(e,F)}})}break;case"DELM":var q=String(b.channel_type),z=String(b.channel_url),Q=parseInt(b.msg_id);switch(q){case r.CHANNEL_TYPE_GROUP:p.getChannel(z,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command);else for(var r in v.sb.channelHandlers){v.sb.channelHandlers[r].onMessageDeleted(e,Q)}});break;case r.CHANNEL_TYPE_OPEN:o.getChannel(z,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command);else for(var r in v.sb.channelHandlers){v.sb.channelHandlers[r].onMessageDeleted(e,Q)}})}break;case"READ":var Y=new u(b),K=p.cachedChannels.hasOwnProperty(Y.channelUrl);p.getChannel(Y.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(!n&&(K&&e.updateReadReceipt(Y.reader.userId,Y.timestamp),v.sb.currentUser))if(Y.reader.userId===v.sb.currentUser.userId){if(K){if(0<e.unreadMessageCount||0<e.unreadMentionCount)for(var r in e._setGroupChannelUnreadCount(0,0),v.sb.channelHandlers){v.sb.channelHandlers[r].onChannelChanged(e)}}else if(0===e.unreadMessageCount||0===e.unreadMentionCount)for(var i in v.sb.channelHandlers){v.sb.channelHandlers[i].onChannelChanged(e)}}else for(var a in v.sb.channelHandlers){v.sb.channelHandlers[a].onReadReceiptUpdated(e)}});break;case"MRCT":var V=String(b.channel_type),W=String(b.channel_url),J=l.createFromJson(b);switch(V){case r.CHANNEL_TYPE_GROUP:p.getChannel(W,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command);else for(var r in v.sb.channelHandlers){v.sb.channelHandlers[r].onReactionUpdated(e,J)}});break;case r.CHANNEL_TYPE_OPEN:o.getChannel(W,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command);else for(var r in v.sb.channelHandlers){v.sb.channelHandlers[r].onReactionUpdated(e,J)}})}break;case"DLVR":var X=String(b.channel_url),Z=b.hasOwnProperty("updated")?b.updated:null,$=p.cachedChannels.hasOwnProperty(X);p.getChannel(X,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(!n){var r=!1;for(var i in Z)v.sb.currentUser&&i===v.sb.currentUser.userId&&(r=!0),$&&e.updateDeliveryReceipt(i,parseInt(Z[i]));if(p.cachedChannels[e.url]=e,!r||1!==Object.keys(Z).length)for(var a in v.sb.channelHandlers){v.sb.channelHandlers[a].onDeliveryReceiptUpdated(e)}}});break;case"MTHD":var ee=String(b.channel_url),ne=String(b.channel_type),te=c.createFromJson(b);switch(ne){case r.CHANNEL_TYPE_GROUP:p.getChannel(ee,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(!n)for(var r in v.sb.channelHandlers){v.sb.channelHandlers[r].onThreadInfoUpdated(e,te)}});break;case r.CHANNEL_TYPE_OPEN:o.getChannel(ee,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(!n)for(var r in v.sb.channelHandlers){v.sb.channelHandlers[r].onThreadInfoUpdated(e,te)}})}break;case"SYEV":var re=new Ee(b),ie=b.ts;switch(re.category){case Ee.CATEGORY_CHANNEL_JOIN:case Ee.CATEGORY_CHANNEL_LEAVE:p.getChannel(re.channelUrl,ge.INTERNAL_CALL,function(r,e){if(v.sb.getErrorFirstCallback()){var n=[r,e];e=n[0],r=n[1]}if(e)me.debug("Discard command",U.command,re.category);else{var i=re.data.hasOwnProperty("member_count")?re.data.member_count:null,a=re.data.hasOwnProperty("joined_member_count")?re.data.joined_member_count:null;if(re.category===Ee.CATEGORY_CHANNEL_JOIN){(re.data.hasOwnProperty("users")?re.data.users:[re.data]).forEach(function(e){r.isSuper||r.isBroadcast?r.setLatestMemberCount(i,a,b.ts):(e.state=h.JOINED,r.addMember(new h(e),ie),r.updateJoinedMemberCount());var n=new d(e);for(var t in v.sb.currentUser&&n.userId===v.sb.currentUser.userId&&(r.myMemberState="joined",p.cachedChannels[r.url]=r),v.sb.channelHandlers){v.sb.channelHandlers[t].onUserJoined(r,n)}})}else{var t=new d(re.data);for(var s in v.sb.currentUser&&t.userId===v.sb.currentUser.userId?(r.isPublic||p.removeCachedChannel(re.channelUrl),r.myMemberState="none",r.invitedAt=0,r._setGroupChannelUnreadCount(0,0)):p.cachedChannels[r.url]=r,r.isSuper||r.isBroadcast?r.setLatestMemberCount(i,a,b.ts):(r.removeMember(t),r.updateJoinedMemberCount()),v.sb.channelHandlers){v.sb.channelHandlers[s].onUserLeft(r,t)}}}});break;case Ee.CATEGORY_CHANNEL_OPERATOR_UPDATE:re.isGroupChannel()?p.getChannel(re.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command,re.category);else{var r=re.data.operators.map(function(e){return new d(e)}),i=r.map(function(e){return e.userId});for(var a in e.members)e.members[a].role=0<=i.indexOf(e.members[a].userId)?p.Role.OPERATOR:p.Role.NONE;for(var s in e.myRole=v.sb.currentUser&&0<=i.indexOf(v.sb.currentUser.userId)?p.Role.OPERATOR:p.Role.NONE,v.sb.channelHandlers){v.sb.channelHandlers[s].onOperatorUpdated(e,r)}}}):re.isOpenChannel()&&o.getChannel(re.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command,re.category);else for(var r in e.operators=re.data.operators.map(function(e){return new d(e)}),v.sb.channelHandlers){v.sb.channelHandlers[r].onOperatorUpdated(e,e.operators)}});break;case Ee.CATEGORY_CHANNEL_INVITE:p.getChannel(re.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command,re.category);else{var r=null;re.data&&re.data.inviter&&0<Object.keys(re.data.inviter).length&&(r=new d(re.data.inviter));for(var i=[],a=0;a<re.data.invitees.length;a++){var s=new d(re.data.invitees[a]);i.push(s),re.data.invitees[a].state=h.INVITED;var o=new h(re.data.invitees[a]);if(e.isSuper||e.isBroadcast){var l=re.data.hasOwnProperty("member_count")?re.data.member_count:null,u=re.data.hasOwnProperty("joined_member_count")?re.data.joined_member_count:null;e.setLatestMemberCount(l,u,b.ts)}else e.addMember(o,ie);v.sb.currentUser&&o.userId===v.sb.currentUser.userId&&(e.isHidden=!1,"joined"!==e.myMemberState&&(e.myMemberState="invited"),e.invitedAt=b.ts,p.cachedChannels[e.url]=e)}for(var c in v.sb.channelHandlers){v.sb.channelHandlers[c].onUserReceivedInvitation(e,r,i)}}});break;case Ee.CATEGORY_CHANNEL_DECLINE_INVITE:p.getChannel(re.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command,re.category);else{var r=null;re.data&&re.data.inviter&&0<Object.keys(re.data.inviter).length&&(r=new d(re.data.inviter));var i=new d(re.data.invitee);if(v.sb.currentUser&&i.userId===v.sb.currentUser.userId&&(e.invitedAt=0,e.myMemberState="none",e.isPublic||p.removeCachedChannel(re.channelUrl)),e.isSuper||e.isBroadcast){var a=re.data.hasOwnProperty("member_count")?re.data.member_count:null,s=re.data.hasOwnProperty("joined_member_count")?re.data.joined_member_count:null;e.setLatestMemberCount(a,s,b.ts)}else e.removeMember(i);for(var o in v.sb.currentUser&&i.userId!==v.sb.currentUser.userId&&(p.cachedChannels[e.url]=e),v.sb.channelHandlers){v.sb.channelHandlers[o].onUserDeclinedInvitation(e,r,i)}}});break;case Ee.CATEGORY_TYPING_START:case Ee.CATEGORY_TYPING_END:p.getChannel(re.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command,re.category);else{var r=new d(re.data);for(var i in re.category===Ee.CATEGORY_TYPING_START?e.updateTypingStatus(r,!0):e.updateTypingStatus(r,!1),v.sb.channelHandlers){v.sb.channelHandlers[i].onTypingStatusUpdated(e)}}});break;case Ee.CATEGORY_CHANNEL_ENTER:case Ee.CATEGORY_CHANNEL_EXIT:o.getChannel(re.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command,re.category);else{re.data.hasOwnProperty("participant_count")&&(e.participantCount=re.data.participant_count);var r=new d(re.data);if(re.category===Ee.CATEGORY_CHANNEL_ENTER)for(var i in v.sb.channelHandlers){v.sb.channelHandlers[i].onUserEntered(e,r)}else for(var a in v.sb.channelHandlers){v.sb.channelHandlers[a].onUserExited(e,r)}}});break;case Ee.CATEGORY_USER_CHANNEL_MUTE:case Ee.CATEGORY_USER_CHANNEL_UNMUTE:re.isOpenChannel()?o.getChannel(re.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command,re.category);else{var r=new d(re.data);if(re.category===Ee.CATEGORY_USER_CHANNEL_MUTE)for(var i in v.sb.channelHandlers){v.sb.channelHandlers[i].onUserMuted(e,r)}else for(var a in v.sb.channelHandlers){v.sb.channelHandlers[a].onUserUnmuted(e,r)}}}):p.getChannel(re.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command,re.category);else{var r=new d(re.data);if(v.sb.currentUser&&r.userId===v.sb.currentUser.userId&&(e.myMutedState=re.category===Ee.CATEGORY_USER_CHANNEL_MUTE?"muted":"unmuted"),re.category===Ee.CATEGORY_USER_CHANNEL_MUTE)for(var i in v.sb.channelHandlers){v.sb.channelHandlers[i].onUserMuted(e,r)}else for(var a in v.sb.channelHandlers){v.sb.channelHandlers[a].onUserUnmuted(e,r)}}});break;case Ee.CATEGORY_USER_CHANNEL_BAN:case Ee.CATEGORY_USER_CHANNEL_UNBAN:re.isOpenChannel()?o.getChannel(re.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command,re.category);else{var r=new d(re.data);if(re.category===Ee.CATEGORY_USER_CHANNEL_BAN){if(v.sb.currentUser&&r.userId===v.sb.currentUser.userId)delete o.enteredChannels[re.channelUrl],v.cls.FileMessageQueue.delete(re.channelUrl);for(var i in v.sb.channelHandlers){v.sb.channelHandlers[i].onUserBanned(e,r)}}else for(var a in v.sb.channelHandlers){v.sb.channelHandlers[a].onUserUnbanned(e,r)}}}):p.getChannel(re.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command,re.category);else{var r=new d(re.data);if(re.category===Ee.CATEGORY_USER_CHANNEL_BAN){if(v.sb.currentUser&&r.userId===v.sb.currentUser.userId&&(e.isPublic||p.removeCachedChannel(re.channelUrl),e.myMemberState="none",e.invitedAt=0,e._setGroupChannelUnreadCount(0,0)),e.isSuper||e.isBroadcast){var i=re.data.hasOwnProperty("member_count")?re.data.member_count:null,a=re.data.hasOwnProperty("joined_member_count")?re.data.joined_member_count:null;e.setLatestMemberCount(i,a,b.ts)}else e.removeMember(r),e.updateJoinedMemberCount();for(var s in v.sb.channelHandlers){v.sb.channelHandlers[s].onUserBanned(e,r)}}else for(var o in v.sb.channelHandlers){v.sb.channelHandlers[o].onUserUnbanned(e,r)}}});break;case Ee.CATEGORY_CHANNEL_FREEZE:case Ee.CATEGORY_CHANNEL_UNFREEZE:re.isOpenChannel()?o.getChannel(re.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command,re.category);else if(e.isFrozen=re.data.freeze,o.cachedChannels[e.url]=e,re.category===Ee.CATEGORY_CHANNEL_FREEZE)for(var r in v.sb.channelHandlers){v.sb.channelHandlers[r].onChannelFrozen(e)}else for(var i in v.sb.channelHandlers){v.sb.channelHandlers[i].onChannelUnfrozen(e)}}):p.getChannel(re.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command,re.category);else if(e.isFrozen=re.data.freeze,p.cachedChannels[e.url]=e,re.category===Ee.CATEGORY_CHANNEL_FREEZE)for(var r in v.sb.channelHandlers){v.sb.channelHandlers[r].onChannelFrozen(e)}else for(var i in v.sb.channelHandlers){v.sb.channelHandlers[i].onChannelUnfrozen(e)}});break;case Ee.CATEGORY_CHANNEL_DELETED:for(var ae in re.isGroupChannel()?p.removeCachedChannel(re.channelUrl):o.removeCachedChannel(re.channelUrl),this.sb.channelHandlers){this.sb.channelHandlers[ae].onChannelDeleted(re.channelUrl,re.isGroupChannel()?"group":"open")}break;case Ee.CATEGORY_CHANNEL_PROP_CHANGED:re.isOpenChannel()?o.getChannelWithoutCache(re.channelUrl,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command,re.category);else for(var r in v.sb.channelHandlers){v.sb.channelHandlers[r].onChannelChanged(e)}}):p.getChannelWithoutCache(re.channelUrl,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command,re.category);else{var r=e.unreadMessageCount,i=e.unreadMentionCount;for(var a in e.myCountPreference!==p.CountPreference.ALL&&(e.myCountPreference===p.CountPreference.UNREAD_MESSAGE_COUNT_ONLY?i=0:e.myCountPreference===p.CountPreference.UNREAD_MENTION_COUNT_ONLY?r=0:i=r=0),e._setGroupChannelUnreadCount(r,i),v.sb.channelHandlers){v.sb.channelHandlers[a].onChannelChanged(e)}}});break;case Ee.CATEGORY_CHANNEL_META_DATA_CHANGED:case Ee.CATEGORY_CHANNEL_META_COUNTERS_CHANGED:var se=re.data.hasOwnProperty("created"),oe=re.data.hasOwnProperty("updated"),le=re.data.hasOwnProperty("deleted");re.isOpenChannel()?o.getChannel(re.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command,re.category);else for(var r in v.sb.channelHandlers){var i=v.sb.channelHandlers[r];re.category===Ee.CATEGORY_CHANNEL_META_DATA_CHANGED?(se&&i.onMetaDataCreated(e,re.data.created),oe&&i.onMetaDataUpdated(e,re.data.updated),le&&i.onMetaDataDeleted(e,re.data.deleted)):(se&&i.onMetaCountersCreated(e,re.data.created),oe&&i.onMetaCountersUpdated(e,re.data.updated),le&&i.onMetaCountersDeleted(e,re.data.deleted))}}):p.getChannel(re.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command,re.category);else for(var r in v.sb.channelHandlers){var i=v.sb.channelHandlers[r];re.category===Ee.CATEGORY_CHANNEL_META_DATA_CHANGED?(se&&i.onMetaDataCreated(e,re.data.created),oe&&i.onMetaDataUpdated(e,re.data.updated),le&&i.onMetaDataDeleted(e,re.data.deleted)):(se&&i.onMetaCountersCreated(e,re.data.created),oe&&i.onMetaCountersUpdated(e,re.data.updated),le&&i.onMetaCountersDeleted(e,re.data.deleted))}});break;case Ee.CATEGORY_CHANNEL_HIDE:case Ee.CATEGORY_CHANNEL_UNHIDE:p.getChannel(re.channelUrl,ge.INTERNAL_CALL,function(e,n){if(v.sb.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n)me.debug("Discard command",U.command,re.category);else if(re.category===Ee.CATEGORY_CHANNEL_HIDE)for(var r in e.isHidden=!0,re.data&&(re.data.hasOwnProperty("allow_auto_unhide")&&(e.hiddenState=re.data.allow_auto_unhide?p.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE:p.HiddenState.HIDDEN_PREVENT_AUTO_UNHIDE),re.data.hasOwnProperty("hide_previous_messages")&&re.data.hide_previous_messages&&e._setGroupChannelUnreadCount(0,0)),b.hasOwnProperty("ts_message_offset")&&(e._messageOffsetTimestamp=b.ts_message_offset),p.cachedChannels[e.url]=e,v.sb.channelHandlers){v.sb.channelHandlers[r].onChannelHidden(e)}else for(var i in e.isHidden=!1,e.hiddenState=p.HiddenState.UNHIDDEN,p.cachedChannels[e.url]=e,v.sb.channelHandlers){v.sb.channelHandlers[i].onChannelChanged(e)}})}break;case"USEV":var ue=new Ee(b);switch(ue.category){case Ue.CATEGORY_USER_BLOCK:case Ue.CATEGORY_USER_UNBLOCK:var ce=ue.data.blocker.user_id,de=ue.data.blockee.user_id;Object.keys(p.cachedChannels).forEach(function(e){var n=p.cachedChannels[e];try{v.sb.currentUser&&(v.sb.currentUser.userId===ce?n.memberMap[de].isBlockedByMe=ue.category===Ue.CATEGORY_USER_BLOCK:v.sb.currentUser.userId===de&&(n.memberMap[ce].isBlockingMe=ue.category===Ue.CATEGORY_USER_BLOCK))}catch(e){}});break;case Ue.CATEGORY_FRIEND_DISCOVERED:var he=ue.data.friend_discoveries.map(function(e){return new d(e)});for(var pe in this.sb.userEventHandlers){this.sb.userEventHandlers[pe].onFriendsDiscovered(he)}}break;case"LEAV":case"JOIN":case"PONG":case"MTIO":case"TPST":case"TPEN":break;default:me.debug("Discard command",U.command)}}}]),n}(),ee={},ne={},te=function(){function n(e){v(this,n),this.channel=e,this.uploadQueue=[],this.messageQueue=[],this.latestTimestampToSendMessage=0,pe.get(this._iid).FileMessageQueue.queueMap[e.url]=this}return s(n,[{key:"_handleMessageQueueUpdated",value:function(e){var t=this;switch(me.debug("fileMessageQueue message queue updated: ",this.messageQueue),e){case"add":this.uploadQueue.length<6&&this._moveFirstPendingMessageToUploadQueue();break;case"update":case"remove":if(0<this.messageQueue.length){var r=pe.get(this._iid).FileMessageQueue,i=this.messageQueue[0];if(i)if(i.state===r.State.UPLOADED){if(i&&i.state===r.State.UPLOADED){for(i.state=r.State.SENDING,0===this.latestTimestampToSendMessage&&(this.latestTimestampToSendMessage=(new Date).getTime()-200);(new Date).getTime()-this.latestTimestampToSendMessage<200;);this.latestTimestampToSendMessage=(new Date).getTime(),this._sendUploadedMessage(i,function(e,n){i.state=r.State.SENT,i.error=e||null,i.response=n||null,t._handleMessageQueueUpdated("update")})}}else i.state===r.State.SENT&&this._finalizeMessage()}}}},{key:"_handleUploadQueueUpdated",value:function(e,n){var t=this;switch(me.debug("fileMessageQueue upload queue updated: ",this.uploadQueue),e){case"add":var r=pe.get(this._iid).FileMessageQueue;if(n.state=r.State.UPLOADING,n.error)-1<this.messageQueue.map(function(e){return e.requestId}).indexOf(n.requestId)&&(n.state=r.State.SENT,this._handleMessageQueueUpdated("update")),this._finalizeUpload(n.requestId);else this._uploadFile(n,function(e){n.error&&n.state===r.State.SENT||(n.state=r.State.UPLOADED),n.fileInfo=e,t._handleMessageQueueUpdated("update"),t._finalizeUpload(n.requestId)});break;case"update":break;case"remove":this.uploadQueue.length<6&&this._moveFirstPendingMessageToUploadQueue()}}},{key:"_moveFirstPendingMessageToUploadQueue",value:function(){var n=pe.get(this._iid).FileMessageQueue,e=this.messageQueue.filter(function(e){return e.state===n.State.PENDING});if(0<e.length){var t=e[0];this.uploadQueue.push(t),this._handleUploadQueueUpdated("add",t)}}},{key:"_sendUploadedMessage",value:function(e,a){var n=pe.get(this._iid),t=n.Command,s=n.FileMessage,o=e.fileInfo,l=t.bFile(g(g({},o),{},{requestId:e.requestId,channelUrl:this.channel.url,url:o.file,metaArrays:o.metaArrays})),u=Sn.getInstance(this._iid),r=_e.get(this._iid);u.getConnectionState()!==u.ConnectionState.OPEN&&u.currentUser&&!u.connecting?r.container.apiClient.sendFileMessage(g(g({channelUrl:this.channel.url,isOpenChannel:this.channel.isOpenChannel()},o),{},{fileUrl:o.file,fileName:o.name,fileSize:o.size,fileType:o.type,metaArrays:o.metaArrays}),function(e,n){var t=new s(e?l.getJsonElement():n);e&&(t.requestedMentionUserIds=o.mentionedUserIds),a(e,t)}):u.sendCommand(l,function(e,n){if(u.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(n){var r=new s(l.getJsonElement());r.requestedMentionUserIds=o.mentionedUserIds,a(n,r)}else{var i=new s(e.getJsonElement());a(null,i)}})}},{key:"_uploadFile",value:function(r,i){var a=r.fileInfo,e=r.pendingMessage;if("string"!=typeof a.file&&a.file){var s=pe.get(this._iid).FileMessageQueue;_e.get(this._iid).container.apiClient.uploadFile(g(g({},a),{},{fileType:a.type,channelUrl:this.channel.url,reqId:e?e.reqId:null}),function(e,n){if(e)r.state=s.State.SENT,r.error=e,r.response=null,i(a);else{var t="object"===fe(n)?n:JSON.parse(n);a.file=t.url,a.thumbnailSizes=t.hasOwnProperty("thumbnails")?t.thumbnails:[],a.requireAuth=!!t.hasOwnProperty("require_auth")&&t.require_auth,i(a)}})}else a.thumbnailSizes=[],a.requireAuth=!1,i(a)}},{key:"_finalizeUpload",value:function(e){var n=this.uploadQueue.map(function(e){return e.requestId}).indexOf(e);if(-1<n){var t=this.uploadQueue.splice(n,1);0<t.length&&this._handleUploadQueueUpdated("remove",t[0])}}},{key:"_finalizeMessage",value:function(){var e=_e.get(this._iid).container.isErrorFirstInCallback,n=Sn.getInstance(this._iid),t=pe.get(this._iid),r=(t.GroupChannel,t.BaseMessage,t.FileMessageQueue),i=this.messageQueue[0];if(i&&i.state===r.State.SENT){i.state=r.State.DONE;var a=i.response,s=i.error,o=i.fileInfo.callback;if(a&&!s){var l=n.currentUser;if(l&&a._sender&&l.userId===a._sender.userId&&(l.nickname!==a._sender.nickname&&(l.nickname=a._sender.nickname),l.plainProfileUrl!==a._sender.plainProfileUrl&&(l.plainProfileUrl=a._sender.plainProfileUrl)),this.channel.isGroupChannel())for(var u in this.channel.lastMessage=a,n.channelHandlers){n.channelHandlers[u].onChannelChanged(this.channel)}return e?o(null,a):o(a,null),this.messageQueue.shift(),void this._handleMessageQueueUpdated("remove")}s&&(a=i.pendingMessage)&&(s.code!==ye.INVALID_PARAMETER?(a.requestState=n.MessageRequestState.FAILED,a.sendingStatus=n.MessageSendingStatus.FAILED,s.code!==ye.FILE_UPLOAD_CANCEL_FAILED&&s.code!==ye.REQUEST_CANCELED||(a.sendingStatus=n.MessageSendingStatus.CANCELED),a.requestedMentionUserIds=i.fileInfo.mentionedUserIds,a.errorCode=s.code):a=null),e?o(s,a):o(a,s),this.messageQueue.shift(),this._handleMessageQueueUpdated("remove")}}},{key:"addJob",value:function(e){this.messageQueue.push(e),this._handleMessageQueueUpdated("add")}},{key:"cancelUploadItemByRequestId",value:function(e,n){this._finalizeUpload(e);var t=this.messageQueue.map(function(e){return e.requestId}).indexOf(e);if(-1<t){var r=pe.get(this._iid).FileMessageQueue,i=this.messageQueue[t];!i||i.state!==r.State.UPLOADING&&i.state!==r.State.PENDING||(i.state=r.State.SENT,i.response=null,i.error=new ye("Uploading has been completed or canceled.",ye.FILE_UPLOAD_CANCEL_FAILED),this._handleMessageQueueUpdated("update"));var a=r.uploadRequest[e];if(a)return a.cancel("Upload has been canceled."),n(null,!0),!0;n(new ye("Uploading has been completed or canceled.",ye.FILE_UPLOAD_CANCEL_FAILED),!1)}else n(new ye("Uploading has been completed or canceled.",ye.FILE_UPLOAD_CANCEL_FAILED),!1);return!1}}],[{key:"getByChannelUrl",value:function(e){return pe.get(this._iid).FileMessageQueue.queueMap[e]}},{key:"create",value:function(e){var n=pe.get(this._iid).FileMessageQueue;return n.queueMap.hasOwnProperty(e.url)||(n.queueMap[e.url]=new n(e)),n.queueMap[e.url]}},{key:"delete",value:function(e){var n=pe.get(this._iid).FileMessageQueue;n.queueMap.hasOwnProperty(e)&&delete n.queueMap[e]}},{key:"clear",value:function(){ne[this._iid]={}}},{key:"State",get:function(){return{PENDING:"pending",UPLOADING:"uploading",UPLOADED:"uploaded",SENDING:"sending",SENT:"sent",DONE:"done"}}},{key:"queueMap",get:function(){return ne[this._iid]||(ne[this._iid]={}),ne[this._iid]}},{key:"uploadRequest",get:function(){return ee[this._iid]||(ee[this._iid]={}),ee[this._iid]}}]),n}();te.Job=function(){return function e(n){var t=n.fileInfo,r=n.requestId,i=n.pendingMessage,a=n.state,s=n.error,o=void 0===s?null:s,l=n.response,u=void 0===l?null:l;v(this,e),this.fileInfo=t,this.requestId=r,this.pendingMessage=i,this.state=a||te.State.PENDING,this.error=o,this.response=u}}();function re(){v(this,re),this.channelCustomTypesFilter=[],this.superChannelFilter=Ae.SuperChannelFilter.ALL}function ie(){v(this,ie),this.onReconnectStarted=function(){},this.onReconnectSucceeded=function(){},this.onReconnectFailed=function(){}}function ae(){v(this,ae),this.onFriendsDiscovered=function(e){},this.onTotalUnreadMessageCountUpdated=function(e,n){}}function se(){v(this,se),this.onMessageReceived=function(e,n){},this.onMessageUpdated=function(e,n){},this.onMessageDeleted=function(e,n){},this.onReadReceiptUpdated=function(e){},this.onReactionUpdated=function(e,n){},this.onDeliveryReceiptUpdated=function(e){},this.onTypingStatusUpdated=function(e){},this.onUserJoined=function(e,n){},this.onUserLeft=function(e,n){},this.onOperatorUpdated=function(e,n){},this.onUserEntered=function(e,n){},this.onUserExited=function(e,n){},this.onUserMuted=function(e,n){},this.onUserUnmuted=function(e,n){},this.onUserBanned=function(e,n){},this.onUserUnbanned=function(e,n){},this.onChannelFrozen=function(e){},this.onChannelUnfrozen=function(e){},this.onChannelChanged=function(e){},this.onChannelDeleted=function(e,n){},this.onUserReceivedInvitation=function(e,n,t){},this.onUserDeclinedInvitation=function(e,n,t){},this.onMetaDataCreated=function(e,n){},this.onMetaDataUpdated=function(e,n){},this.onMetaDataDeleted=function(e,n){},this.onMetaCountersCreated=function(e,n){},this.onMetaCountersUpdated=function(e,n){},this.onMetaCountersDeleted=function(e,n){},this.onChannelHidden=function(e){},this.onMentionReceived=function(e,n){},this.onThreadInfoUpdated=function(e,n){}}function oe(e){if(v(this,oe),e){var n=pe.get(this._iid),t=n.User,r=n.BaseChannel;this.reader=new t(e.user),this.timestamp=parseInt(e.ts),this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):r.CHANNEL_TYPE_GROUP}}var le=function(){function e(){v(this,e)}return s(e,null,[{key:"create",value:function(){return"".concat(parseInt(1e5*Math.random()),"-").concat((new Date).getTime())}}]),e}(),ue={},ce={},de=new WeakMap,he=new WeakMap,be=new WeakMap,Ae=function(){o(a,Z);var t=h(a);function a(e){var n;return v(this,a),(n=t.call(this,e)).channelType=Z.CHANNEL_TYPE_GROUP,n.isDistinct=!1,n.isSuper=!1,n.isBroadcast=!1,n.isPublic=!1,n.unreadMessageCount=0,n.inviter=null,n.members=[],n.memberMap={},n.lastMessage=null,n.memberCount=0,n.joinedMemberCount=0,n.cachedReadReceiptStatus={},n.cachedDeliveryReceiptStatus=null,n.myPushTriggerOption=a.PushTriggerOption.DEFAULT,n.isPushEnabled,n.isHidden=!1,n.hiddenState=a.HiddenState.UNHIDDEN,n.isDiscoverable=!0,n.myLastRead=0,n.messageSurvivalSeconds=-1,n._messageOffsetTimestamp=0,n._cachedLastDeliveredReceipt={sentAt:0,timeout:null},de.set(d(n),{}),he.set(d(n),{start:0,end:0}),be.set(d(n),0),e&&n._update(e),n}return s(a,[{key:"_setGroupChannelUnreadCount",value:function(e,n){try{if("number"==typeof e&&0<=e)if("all"===this.myCountPreference||"unread_message_count_only"===this.myCountPreference)if(this.isSuper||this.isBroadcast){var t=_e.get(this._iid).container.maxUnreadCountOfSuperGroupChannel;this.unreadMessageCount=t<=e?t:e}else this.unreadMessageCount=e;else this.unreadMessageCount=0;"number"==typeof n&&0<=n&&("all"===this.myCountPreference||"unread_mention_count_only"===this.myCountPreference?this.unreadMentionCount=n:this.unreadMentionCount=0)}catch(e){}}},{key:"_update",value:function(e){var n=pe.get(this._iid),t=n.BaseChannel,r=n.GroupChannel,i=n.User,a=n.Member;if(this.isAccessCodeRequired=!!e.is_access_code_required&&e.is_access_code_required,this.isDistinct=!!e.is_distinct&&e.is_distinct,this.isPushEnabled=!!e.is_push_enabled&&e.is_push_enabled,this.isHidden=!!e.hasOwnProperty("is_hidden")&&e.is_hidden,this.myPushTriggerOption=e.push_trigger_option?e.push_trigger_option:r.PushTriggerOption.DEFAULT,this.myCountPreference=e.hasOwnProperty("count_preference")?e.count_preference:r.CountPreference.ALL,this.unreadMessageCount=0,this.unreadMentionCount=0,this._setGroupChannelUnreadCount(parseInt(e.unread_message_count),parseInt(e.unread_mention_count)),e.hasOwnProperty("read_receipt"))for(var s in this.cachedReadReceiptStatus={},e.read_receipt){var o=e.read_receipt[s];this.updateReadReceipt(s,parseInt(o))}if(e.hasOwnProperty("delivery_receipt")&&"object"===fe(e.delivery_receipt)&&null!==e.delivery_receipt)for(var l in this.cachedDeliveryReceiptStatus||(this.cachedDeliveryReceiptStatus={}),e.delivery_receipt){var u=e.delivery_receipt[l];this.updateDeliveryReceipt(l,parseInt(u))}if(e.hasOwnProperty("user_last_read")&&"number"==typeof e.user_last_read?this.myLastRead=e.user_last_read:this.myLastRead=0,e.hasOwnProperty("members")){this.members=[],this.memberMap={};for(var c=0;c<e.members.length;c++){var d=new a(e.members[c]);this.members.push(d),this.memberMap[d.userId]=d}}this.myMemberState=e.member_state||"none",this.myRole=e.my_role||r.Role.NONE,e.hasOwnProperty("is_muted")?"string"==typeof e.is_muted?this.myMutedState=e.is_muted:"boolean"==typeof e.is_muted?this.myMutedState=e.is_muted?"muted":"unmuted":this.myMutedState="unmuted":this.myMutedState="unmuted",e.hasOwnProperty("member_count")&&(this.memberCount=parseInt(e.member_count)),e.hasOwnProperty("joined_member_count")&&(this.joinedMemberCount=parseInt(e.joined_member_count)),e.hasOwnProperty("last_message")&&"object"===fe(e.last_message)&&e.last_message?e.last_message instanceof W?this.lastMessage=e.last_message:this.lastMessage=t.buildMessage(e.last_message,this):this.lastMessage=null,e.hasOwnProperty("inviter")&&null!==e.inviter&&"object"===fe(e.inviter)&&0<Object.keys(e.inviter).length?this.inviter=new i(e.inviter):this.inviter=null,this.invitedAt=e.invited_at||0,e.hasOwnProperty("is_super")&&"boolean"==typeof e.is_super?this.isSuper=e.is_super:this.isSuper=!1,e.hasOwnProperty("is_broadcast")&&"boolean"==typeof e.is_broadcast?this.isBroadcast=e.is_broadcast:this.isBroadcast=!1,e.hasOwnProperty("is_public")&&"boolean"==typeof e.is_public?this.isPublic=e.is_public:this.isPublic=!1,e.hasOwnProperty("hidden_state")?this.hiddenState=e.hidden_state:this.hiddenState=r.HiddenState.UNHIDDEN,e.hasOwnProperty("is_discoverable")&&"boolean"==typeof e.is_discoverable?this.isDiscoverable=e.is_discoverable:this.isDiscoverable=this.isPublic,e.hasOwnProperty("ts_message_offset")&&(this._messageOffsetTimestamp=e.ts_message_offset),e.hasOwnProperty("message_survival_seconds")&&"number"==typeof e.message_survival_seconds&&(this.messageSurvivalSeconds=e.message_survival_seconds)}},{key:"addMember",value:function(e,n){var t=1<arguments.length&&void 0!==n?n:0;if(!this.isSuper&&!this.isBroadcast){var r=pe.get(this._iid).Member,i=this.removeMember(e);i&&i.state===r.JOINED&&(e.state=r.JOINED),this.memberMap[e.userId]=e,this.members.push(e),this.memberCount++,this.updateReadReceipt(e.userId,t),this.updateDeliveryReceipt(e.userId,t)}}},{key:"removeMember",value:function(e){var n=null;if(!this.isSuper&&!this.isBroadcast&&this.memberMap.hasOwnProperty(e.userId)){delete this.memberMap[e.userId];for(var t=0;t<this.members.length;t++){var r=this.members[t];if(r.userId===e.userId){n=r,this.members.splice(t,1);break}}this.memberCount--}return n}},{key:"parse",value:function(e){this._update(e)}},{key:"update",value:function(e){this.__update(e),this._update(e)}},{key:"isIdentical",value:function(e){return e&&this.url===e.url}},{key:"isEqual",value:function(e){return ve.deepEqual(this,e)}},{key:"createMemberListQuery",value:function(){return new(pe.get(this._iid).MemberListQuery)(this.url)}},{key:"createBannedUserListQuery",value:function(){return new(pe.get(this._iid).BannedUserListQuery)({channelUrl:this.url,isOpenChannel:this.isOpenChannel()})}},{key:"refresh",value:function(e){return pe.get(this._iid).GroupChannel.getChannelWithoutCache(this.url,e)}},{key:"updateChannel",value:function(){var n=this,t=j.toArray(arguments),e=void 0;"function"==typeof t[t.length-1]&&(e=t.pop());var r=pe.get(this._iid),i=r.GroupChannel,a=r.GroupChannelParams;if(t[0]instanceof a&&1===t.length)return Y(this._iid,function(r){var e=t[0];(e.channelUrl=n.url,e._validate())?_e.get(n._iid).container.apiClient.updateGroupChannel(g(g({},e),{},{operatorUserIds:e.operatorUserIds}),function(e,n){var t=null;e||(t=i.upsert(n)),r(e,t)}):r(j.error,null)},e);if(3===t.length){var s=new a;return s.channelUrl=this.url,s.name=t[0],"string"==typeof t[1]?s.coverUrl=t[1]:s.coverImage=t[1],s.data=t[2],this.updateChannel(s,e)}if(4===t.length){var o=new a;return o.channelUrl=this.url,o.isDistinct=t[0],o.name=t[1],"string"==typeof t[1]?o.coverUrl=t[2]:o.coverImage=t[2],o.data=t[3],this.updateChannel(o,e)}if(5!==t.length)return Y(this._iid,function(e){return e(j.error,null)},e);var l=new a;return l.channelUrl=this.url,l.isDistinct=t[0],l.name=t[1],"string"==typeof t[2]?l.coverUrl=t[2]:l.coverImage=t[2],l.data=t[3],l.customType=t[4],this.updateChannel(l,e)}},{key:"invite",value:function(e,n){var t,r=B(j.parse(arguments,[new j({type:"array",constraint:function(e){return 0<e.length&&e.every(function(e){return!!e.userId&&"string"==typeof e.userId})}}),new j({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],t?Y(this._iid,function(e){return e(j.error,null)},n):this.inviteWithUserIds(e.map(function(e){return e.userId}),n)}},{key:"inviteWithUserIds",value:function(e,n){var t,i=this,r=B(j.parse(arguments,[new j({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new j({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],Y(this._iid,function(r){t?r(t,null):_e.get(i._iid).container.apiClient.inviteToGroupChannel({channelUrl:i.url,userIds:e},function(e,n){var t=null;e||(t=pe.get(i._iid).GroupChannel.upsert(n));r(e,t)})},n)}},{key:"acceptInvitation",value:function(e,n){var t,i=this,r=B(j.parse(arguments,[new j({type:"string",optional:!0,defaultValue:null}),new j({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],Y(this._iid,function(r){t?r(t,null):_e.get(i._iid).container.apiClient.acceptInvitation({channelUrl:i.url,accessCode:e},function(e,n){var t=null;e||((t=pe.get(i._iid).GroupChannel.upsert(n)).myMemberState="joined");r(e,t)})},n)}},{key:"declineInvitation",value:function(e){var a=this;return Y(this._iid,function(i){_e.get(a._iid).container.apiClient.declineInvitation({channelUrl:a.url},function(e,n){var t=null;if(!e){var r=pe.get(a._iid).GroupChannel;(t=r.upsert(n)).myMemberState="none",a.isPublic||r.removeCachedChannel(a.url)}i(e,t)})},e)}},{key:"join",value:function(e,n){var t,i=this,r=B(j.parse(arguments,[new j({type:"string",optional:!0,defaultValue:null}),new j({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],Y(this._iid,function(r){t?r(t,null):_e.get(i._iid).container.apiClient.joinGroupChannel({channelUrl:i.url,accessCode:e},function(e,n){var t=null;e||((t=pe.get(i._iid).GroupChannel.upsert(n)).myMemberState="joined");r(e,t)})},n)}},{key:"leave",value:function(e){var n=this;return Y(this._iid,function(t){_e.get(n._iid).container.apiClient.leaveGroupChannel({channelUrl:n.url},function(e,n){return t(e,null)})},e)}},{key:"muteUser",value:function(e,n,t,r){return this.muteUserWithUserId(e?e.userId:null,n,t,r)}},{key:"muteUserWithUserId",value:function(e,n,r,t){var i,a=this,s=B(j.parse(arguments,[new j({type:"string"}),new j({type:"number",optional:!0,defaultValue:-1,constraint:function(e){return-1<=e}}),new j({type:"string",optional:!0,defaultValue:""}),new j({type:"callback"})]),5);return i=s[0],e=s[1],n=s[2],r=s[3],t=s[4],Y(this._iid,function(t){i?t(i,null):_e.get(a._iid).container.apiClient.muteUser({channelUrl:a.url,userId:e,description:r,seconds:n,isGroupChannel:!0},function(e,n){t(e,null)})},t)}},{key:"unmuteUser",value:function(e,n){return this.unmuteUserWithUserId(e?e.userId:null,n)}},{key:"unmuteUserWithUserId",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"string"}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.unmuteUser({channelUrl:i.url,userId:e,isGroupChannel:!0},function(e,n){t(e,null)})},n)}},{key:"banUser",value:function(e,n,t,r){return this.banUserWithUserId(e?e.userId:null,n,t,r)}},{key:"banUserWithUserId",value:function(e,n,r,t){var i,a=this,s=B(j.parse(arguments,[new j({type:"string"}),new j({type:"number",optional:!0,defaultValue:-1,constraint:function(e){return-1<=e}}),new j({type:"string"}),new j({type:"callback"})]),5);return i=s[0],e=s[1],n=s[2],r=s[3],t=s[4],Y(this._iid,function(t){i?t(i,null):_e.get(a._iid).container.apiClient.banUser({channelUrl:a.url,userId:e,description:r,seconds:n,isGroupChannel:!0},function(e,n){t(e,null)})},t)}},{key:"unbanUser",value:function(e,n){return this.unbanUserWithUserId(e?e.userId:null,n)}},{key:"unbanUserWithUserId",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"string"}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.unbanUser({channelUrl:i.url,userId:e,isGroupChannel:!0},function(e,n){t(e,null)})},n)}},{key:"updateJoinedMemberCount",value:function(){if(!this.isSuper&&!this.isBroadcast){var n=pe.get(this._iid).Member;this.joinedMemberCount=this.members.filter(function(e){return e.state===n.JOINED}).length}}},{key:"setLatestMemberCount",value:function(e,n,t){"number"==typeof e&&"number"==typeof n&&"number"==typeof t&&t>=be.get(this)&&(be.set(this,t),this.memberCount=e,this.joinedMemberCount=n)}},{key:"hide",value:function(i,a,e){var n,s=this,t=B(j.parse(arguments,[new j({type:"boolean",optional:!0,defaultValue:!1}),new j({type:"boolean",optional:!0,defaultValue:!0}),new j({type:"callback"})]),4);return n=t[0],i=t[1],a=t[2],e=t[3],Y(this._iid,function(r){n?r(n,null):_e.get(s._iid).container.apiClient.hideGroupChannel({channelUrl:s.url,hidePreviousMessages:i,allowAutoUnhide:a},function(e,n){if(!e){var t=pe.get(s._iid).GroupChannel;s.isHidden=!0,s.hiddenState=a?t.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE:t.HiddenState.HIDDEN_PREVENT_AUTO_UNHIDE,i&&s._setGroupChannelUnreadCount(0,0),n.hasOwnProperty("ts_message_offset")&&(s._messageOffsetTimestamp=n.ts_message_offset),t.cachedChannels[s.url]=s}r(e,n)})},e)}},{key:"unhide",value:function(e){var i=this;return Y(this._iid,function(r){_e.get(i._iid).container.apiClient.unhideGroupChannel({channelUrl:i.url},function(e,n){if(!e){var t=pe.get(i._iid).GroupChannel;i.isHidden=!1,i.hiddenState=t.HiddenState.UNHIDDEN,t.cachedChannels[i.url]=i}r(e,n)})},e)}},{key:"freeze",value:function(e){var i=this;return Y(this._iid,function(r){_e.get(i._iid).container.apiClient.freeze({channelUrl:i.url,isGroupChannel:!0,freezing:!0},function(e,n){if(!e){var t=pe.get(i._iid).GroupChannel;i.isFrozen=!0,t.cachedChannels[i.url]=i}r(e,null)})},e)}},{key:"unfreeze",value:function(e){var i=this;return Y(this._iid,function(r){_e.get(i._iid).container.apiClient.freeze({channelUrl:i.url,isGroupChannel:!0,freezing:!1},function(e,n){if(!e){var t=pe.get(i._iid).GroupChannel;i.isFrozen=!1,t.cachedChannels[i.url]=i}r(e,null)})},e)}},{key:"delete",value:function(e){var r=this;return Y(this._iid,function(t){_e.get(r._iid).container.apiClient.deleteGroupChannel({channelUrl:r.url},function(e,n){e||pe.get(r._iid).GroupChannel.removeCachedChannel(r.url);t(e,n)})},e)}},{key:"markAsRead",value:function(){var i=this,e=pe.get(this._iid).Command,a=Sn.getInstance(this._iid),n=e.bRead({channelUrl:this.url});a.sendCommand(n,function(e,n){if(a.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}if(!n&&a.currentUser&&(i.updateReadReceipt(a.currentUser.userId,e.getJsonElement().ts),0<i.unreadMessageCount||0<i.unreadMentionCount))for(var r in i._setGroupChannelUnreadCount(0,0),a.channelHandlers){a.channelHandlers[r].onChannelChanged(i)}})}},{key:"getUnreadMemberCount",value:function(e){var n=Sn.getInstance(this._iid),t=pe.get(this._iid).Member;if(e instanceof W&&!e.isAdminMessage()&&n.currentUser&&!this.isSuper&&!this.isBroadcast){for(var r=0,i=e.createdAt,a=this.members,s=0;s<a.length;s++){var o=a[s];if(n.currentUser.userId!==o.userId&&o.state===t.JOINED&&(!e.sender||e.sender.userId!==o.userId))(this.cachedReadReceiptStatus[o.userId]||0)<i&&r++}return r}return 0}},{key:"getReadReceipt",value:function(e){return this.getUnreadMemberCount(e)}},{key:"markAsDelivered",value:function(){function e(){var e=Sn.getInstance(i._iid),r=e.currentUser?e.currentUser.userId:null;_e.get(i._iid).container.apiClient.markAsDelivered({channelUrl:i.url,userId:r},function(e,n){if(e)me.debug(e);else{var t=n.hasOwnProperty("ts")?n.ts:0;i.updateDeliveryReceipt(r,t)}})}var i=this,n=this._cachedLastDeliveredReceipt;n&&Date.now()-n.sentAt<1e3?(n.timeout&&clearTimeout(n.timeout),n.timeout=setTimeout(function(){n.sentAt=Date.now(),e()},n.sentAt+1e3-Date.now())):(n.sentAt=Date.now(),e())}},{key:"getUndeliveredMemberCount",value:function(e){var n=Sn.getInstance(this._iid),t=pe.get(this._iid).Member;if(this.cachedDeliveryReceiptStatus&&e instanceof W&&!e.isAdminMessage()&&n.currentUser&&!this.isSuper&&!this.isBroadcast){var r,i=e.createdAt,a=0,s=function(e,n){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=y(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==t.return||t.return()}finally{if(o)throw a}}}}(this.members);try{for(s.s();!(r=s.n()).done;){var o=r.value;n.currentUser.userId===o.userId||o.state!==t.JOINED||e.sender&&e.sender.userId===o.userId||this.cachedDeliveryReceiptStatus[o.userId]<i&&a++}}catch(e){s.e(e)}finally{s.f()}return a}return 0}},{key:"getDeliveryReceipt",value:function(e){return this.getUndeliveredMemberCount(e)}},{key:"getReadMembers",value:function(e,n){var t=1<arguments.length&&void 0!==n&&n,r=Sn.getInstance(this._iid);if(r.currentUser&&!this.isSuper&&!this.isBroadcast&&e instanceof W&&!e.isAdminMessage()){for(var i=[],a=0;a<this.members.length;a++){var s=this.members[a];if(t||s.userId!==r.currentUser.userId&&s.userId!==e.sender.userId)(this.cachedReadReceiptStatus[s.userId]||0)>=e.createdAt&&i.push(s)}return i}return[]}},{key:"getUnreadMembers",value:function(e,n){var t=1<arguments.length&&void 0!==n&&n,r=Sn.getInstance(this._iid);if(r.currentUser&&!this.isSuper&&!this.isBroadcast&&e instanceof W&&!e.isAdminMessage()){for(var i=[],a=0;a<this.members.length;a++){var s=this.members[a];if(t||s.userId!==r.currentUser.userId&&s.userId!==e.sender.userId)(this.cachedReadReceiptStatus[s.userId]||0)<e.createdAt&&i.push(s)}return i}return[]}},{key:"getReadStatus",value:function(e){var r=this,i=0<arguments.length&&void 0!==e&&e,a=Sn.getInstance(this._iid);if(!a.currentUser||this.isSuper||this.isBroadcast)return{};function n(n){if(!i&&n===a.currentUser.userId)return"continue";var e=r.cachedReadReceiptStatus[n],t=r.members.filter(function(e){return e.userId===n});s[n]={user:0<t.length?t[0]:null,last_seen_at:parseInt(e)}}var s={};for(var t in this.cachedReadReceiptStatus)n(t);return s}},{key:"updateReadReceipt",value:function(e,n){var t=this.cachedReadReceiptStatus[e];if(!t||t<n){this.cachedReadReceiptStatus[e]=n;var r=Sn.getInstance(this._iid);r.currentUser&&e===r.currentUser.userId&&(this.myLastRead=n)}}},{key:"updateDeliveryReceipt",value:function(e,n){if(this.cachedDeliveryReceiptStatus)if(this.cachedDeliveryReceiptStatus.hasOwnProperty(e)){var t=this.cachedDeliveryReceiptStatus[e];(!t||t<n)&&(this.cachedDeliveryReceiptStatus[e]=n)}else this.cachedDeliveryReceiptStatus[e]=n}},{key:"startTyping",value:function(){var e=Sn.getInstance(this._iid),n=(new Date).getTime(),t=e.Options.typingIndicatorThrottle;("number"!=typeof t||t<1e3||9e3<t)&&(t=1e3);var r=he.get(this);if(n-r.start>=t){r.end=0,r.start=n;var i=pe.get(this._iid).Command.bTypeStart({channelUrl:this.url,time:r.start});e.sendCommand(i,null)}}},{key:"endTyping",value:function(){var e=Sn.getInstance(this._iid),n=(new Date).getTime(),t=e.Options.typingIndicatorThrottle;("number"!=typeof t||t<1e3||9e3<t)&&(t=1e3);var r=he.get(this);if(n-r.end>=t){r.start=0,r.end=n;var i=pe.get(this._iid).Command.bTypeEnd({channelUrl:this.url,time:r.end});e.sendCommand(i,null)}}},{key:"invalidateTypingStatus",value:function(){var e=de.get(this),n=(new Date).getTime(),t=!1;for(var r in e){1e4<=n-e[r]&&(delete e[r],t=!0)}return t}},{key:"getTypingMembers",value:function(){var e=de.get(this),n=[];for(var t in e){var r=this.memberMap[t];r&&n.push(r)}return n}},{key:"updateTypingStatus",value:function(e,n){var t=de.get(this);n?t[e.userId]=(new Date).getTime():delete t[e.userId]}},{key:"isTyping",value:function(){var e=de.get(this);return 0!==Object.keys(e).length}},{key:"registerScheduledUserMessage",value:function(e,n){var t,a=this,r=pe.get(this._iid),s=r.ScheduledUserMessage,i=r.ScheduledUserMessageParams,o=B(j.parse(arguments,[new j({type:i,constraint:function(e){return"string"==typeof e.message&&"string"==typeof e._getScheduleString()}}),new j({type:"callback"})]),3);return t=o[0],e=o[1],n=o[2],Y(this._iid,function(i){t?i(t,null):_e.get(a._iid).container.apiClient.registerScheduledUserMessage({groupChannelParams:e,channelUrl:a.url,isOpenChannel:!1},function(e,n){var t=null;if(!e){t=new s(n);var r=Sn.getInstance(a._iid).currentUser;r&&t._sender&&r.userId===t._sender.userId&&(r.nickname=t._sender.nickname,r.plainProfileUrl=t._sender.plainProfileUrl,r.metaData=t._sender.metaData)}i(e,t)})},n)}},{key:"getPushPreference",value:function(e){var i=this;return Y(this._iid,function(r){_e.get(i._iid).container.apiClient.getMyPushTriggerOption({channelUrl:i.url},function(e,n){var t=null;if(!e){try{t=n.enable}catch(e){t=!1}i.isPushEnabled=t}r&&r(e,t)})},e)}},{key:"setPushPreference",value:function(e,n){var i=this;return Y(this._iid,function(t){var r=pe.get(i._iid).GroupChannel;_e.get(i._iid).container.apiClient.setMyPushTriggerOption({channelUrl:i.url,enable:e},function(e,n){e||(i.isPushEnabled=n.enable,i.isPushEnabled||(i.myPushTriggerOption=r.PushTriggerOption.OFF)),t(e,n)})},n)}},{key:"getMyPushTriggerOption",value:function(e){var i=this;return Y(this._iid,function(r){_e.get(i._iid).container.apiClient.getMyPushTriggerOption({channelUrl:i.url},function(e,n){var t=null;if(!e){try{t=n.push_trigger_option||a.PushTriggerOption.DEFAULT}catch(e){me.debug(e)}i.myPushTriggerOption=t}r(e,t)})},e)}},{key:"setMyPushTriggerOption",value:function(e,n){var t,i=this,r=pe.get(this._iid).GroupChannel,a=B(j.parse(arguments,[new j({type:r.PushTriggerOption}),new j({type:"callback"})]),3);return t=a[0],e=a[1],n=a[2],Y(this._iid,function(r){t?r(t,null):_e.get(i._iid).container.apiClient.setMyPushTriggerOption({channelUrl:i.url,pushTriggerOption:e},function(e,n){var t=null;if(!e){try{t=n.push_trigger_option}catch(e){me.debug(e)}i.myPushTriggerOption=t}r(e,t)})},n)}},{key:"setMyCountPreference",value:function(e,n){var t,i=this,a=pe.get(this._iid).GroupChannel,r=B(j.parse(arguments,[new j({type:a.CountPreference}),new j({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],Y(this._iid,function(r){t?r(t,null):_e.get(i._iid).container.apiClient.setMyCountPreference({channelUrl:i.url,countPreference:e},function(e,n){var t=null;e||(t=i.myCountPreference=n.count_preference,i._setGroupChannelUnreadCount(i.unreadMessageCount,i.unreadMentionCount),a.cachedChannels[i.url]=i),r(e,t)})},n)}},{key:"resetMyHistory",value:function(e){var i=this;return Y(this._iid,function(r){_e.get(i._iid).container.apiClient.resetMyHistory({channelUrl:i.url},function(e,n){if(!e&&n.hasOwnProperty("ts_message_offset")){var t=pe.get(i._iid).GroupChannel;i._messageOffsetTimestamp=n.ts_message_offset,t.cachedChannels[i.url]=i}r(e,n)})},e)}},{key:"messageOffsetTimestamp",get:function(){return this._messageOffsetTimestamp}}],[{key:"buildFromSerializedData",value:function(e){var n,t=pe.get(this._iid),r=t.User,i=t.Member,a=t.GroupChannel,s=t.BaseMessage,o=t.UserMessage,l=t.FileMessage,u=t.AdminMessage,c=x.deserialize(e);return new a({channel_url:c.url,name:c.name,cover_url:c.coverUrl,data:c.data,custom_type:c.customType,invited_at:c.invitedAt,created_at:c.createdAt/1e3,is_access_code_required:c.isAccessCodeRequired,is_distinct:c.isDistinct,is_super:c.isSuper,is_broadcast:c.isBroadcast,is_public:c.isPublic,is_discoverable:c.isDiscoverable,is_hidden:c.isHidden,is_ephemeral:c.isEphemeral,is_muted:c.myMutedState,is_push_enabled:c.isPushEnabled,freeze:c.isFrozen,unread_message_count:c.unreadMessageCount,unread_mention_count:c.unreadMentionCount,push_trigger_option:c.myPushTriggerOption,count_preference:c.myCountPreference,hidden_state:c.hiddenState,member_count:c.memberCount,joined_member_count:c.joinedMemberCount,member_state:c.myMemberState,my_role:c.myRole,user_last_read:c.myLastRead,ts_message_offset:c.messageOffsetTimestamp,message_survival_seconds:c.messageSurvivalSeconds,read_receipt:c.cachedReadReceiptStatus,delivery_receipt:c.cachedDeliveryReceiptStatus,members:c.members.map(function(e){return i.objectify(g({user:e},e))}),last_message:null!=(n=c.lastMessage)&&"object"===fe(n)?n.messageType===s.MESSAGE_TYPE_USER?new o(o.objectify(g(g({},n),{},{channel:{url:n.channelUrl,channelType:n.channelType},user:n.sender,mentionedUsers:n.mentionedUsers}))):n.messageType===s.MESSAGE_TYPE_FILE?new l(l.objectify(g(g({},n),{},{channel:{url:n.channelUrl,channelType:n.channelType},user:n.sender,mentionedUsers:n.mentionedUsers}))):new u(u.objectify(g(g({},n),{},{channel:{url:n.channelUrl,channelType:n.channelType},mentionedUsers:n.mentionedUsers}))):null,created_by:null!==c.creator&&void 0!==c.creator&&"object"===fe(c.creator)?r.objectify(c.creator):null,inviter:null!==c.inviter&&void 0!==c.inviter&&"object"===fe(c.inviter)?r.objectify(c.inviter):null})}},{key:"upsert",value:function(e){var n=pe.get(this._iid).GroupChannel,t=new n(e);if(n.cachedChannels.hasOwnProperty(t.url)){if(t.isEphemeral){var r=n.cachedChannels[t.url];e.last_message=r.lastMessage,e.unread_message_count=r.unreadMessageCount}n.cachedChannels[t.url].update(e)}else n.cachedChannels[t.url]=t;return n.cachedChannels[t.url]}},{key:"removeCachedChannel",value:function(e){var n=pe.get(this._iid),t=n.GroupChannel,r=n.FileMessageQueue;t.cachedChannels[e]&&delete t.cachedChannels[e],r.delete(e)}},{key:"clearCache",value:function(){ue[this._iid]={},pe.get(this._iid).FileMessageQueue.clear()}},{key:"getChannel",value:function(n,e){var t,r,i=B(j.parse(arguments,[new j({type:"string"}),new j({type:"string",optional:!0,nullable:!0,defaultValue:null}),new j({type:"callback"})]),4);if(t=i[0],n=i[1],r=i[2],e=i[3],t)return Y(this._iid,function(e){e(t,null)},e);var a=pe.get(this._iid).GroupChannel;return a.cachedChannels[n]?Y(this._iid,function(e){e(null,a.cachedChannels[n])},e):a.getChannelWithoutCache(n,r,e)}},{key:"getChannelWithoutCache",value:function(e,n){var t,i,a=this,r=B(j.parse(arguments,[new j({type:"string"}),new j({type:"string",optional:!0,nullable:!0,defaultValue:null}),new j({type:"callback"})]),4);return t=r[0],e=r[1],i=r[2],n=r[3],Y(this._iid,function(r){t?r(t,null):_e.get(a._iid).container.apiClient.getGroupChannel({channelUrl:e,internalCall:i,showMember:!0},function(e,n){var t=null;e||(t=a.upsert(n)),r(e,t)})},n)}},{key:"createDistinctChannelIfNotExist",value:function(e,n){var t,a=this,r=pe.get(this._iid).GroupChannelParams,i=B(j.parse(arguments,[new j({type:r,constraint:function(e){return e._validate()}}),new j({type:"callback"})]),3);return t=i[0],e=i[1],n=i[2],Y(this._iid,function(i){t?i(t,null):(e.isPublic||(e.accessCode=null),_e.get(a._iid).container.apiClient.createGroupChannel(g(g({},e),{},{isDistinct:!0}),function(e,n){var t=null;if(!e){var r=pe.get(a._iid).GroupChannel;t={channel:new r(n),isCreated:n.is_created},r.cachedChannels[t.channel.url]=t.channel}i(e,t)}))},n)}},{key:"createChannel",value:function(){var n=this,t=j.toArray(arguments),e=void 0;"function"==typeof t[t.length-1]&&(e=t.pop());var r=pe.get(this._iid),i=r.GroupChannel,a=r.GroupChannelParams;if(t[0]instanceof a&&1===t.length)return Y(this._iid,function(r){var e=t[0];(e.isPublic||(e.accessCode=null),e._validate())?_e.get(n._iid).container.apiClient.createGroupChannel(e,function(e,n){var t=null;e||(t=new i(n),i.cachedChannels[t.url]=t),r(e,t)}):r(j.error,null)},e);if(Array.isArray(t[0])){var s=new a;switch(t.length){case 1:s.addUsers(t[0]);break;case 2:s.addUsers(t[0]),s.isDistinct=t[1];break;case 3:s.addUsers(t[0]),s.isDistinct=t[1],s.customType=t[2];break;case 5:s.addUsers(t[0]),s.isDistinct=t[1],s.name=t[2],"string"==typeof t[3]?s.coverUrl=t[3]:s.coverImage=t[3],s.data=t[4];break;case 6:s.addUsers(t[0]),s.isDistinct=t[1],s.name=t[2],"string"==typeof t[3]?s.coverUrl=t[3]:s.coverImage=t[3],s.data=t[4],s.customType=t[5];break;default:return Y(this._iid,function(e){return e(j.error,null)},e)}return e?i.createChannel(s,e):i.createChannel(s)}return Y(this._iid,function(e){return e(j.error,null)},e)}},{key:"createChannelWithUserIds",value:function(){var e=j.toArray(arguments),n=void 0;"function"==typeof e[e.length-1]&&(n=e.pop());var t=pe.get(this._iid),r=t.GroupChannel,i=new t.GroupChannelParams;switch(e.length){case 1:i.addUserIds(e[0]);break;case 2:i.addUserIds(e[0]),i.isDistinct=e[1];break;case 3:i.addUserIds(e[0]),i.isDistinct=e[1],i.customType=e[2];break;case 5:i.addUserIds(e[0]),i.isDistinct=e[1],i.name=e[2],"string"==typeof e[3]?i.coverUrl=e[3]:i.coverImage=e[3],i.data=e[4];break;case 6:i.addUserIds(e[0]),i.isDistinct=e[1],i.name=e[2],"string"==typeof e[3]?i.coverUrl=e[3]:i.coverImage=e[3],i.data=e[4],i.customType=e[5];break;default:return Y(this._iid,function(e){return e(j.error,null)},n)}return r.createChannel(i,n)}},{key:"createMyGroupChannelListQuery",value:function(){return new(pe.get(this._iid).GroupChannelListQuery)}},{key:"createPublicGroupChannelListQuery",value:function(){return new(pe.get(this._iid).PublicGroupChannelListQuery)}},{key:"getChannelCount",value:function(e,n){return Sn.getInstance(this._iid).getGroupChannelCount(e,n)}},{key:"getUnreadItemCount",value:function(e,n){return Sn.getInstance(this._iid).getUnreadItemCount(e,n)}},{key:"getTotalUnreadMessageCount",value:function(){var e=j.toArray(arguments),n="function"==typeof e[e.length-1]?e.pop():null,t=Sn.getInstance(this._iid);return t.getTotalUnreadMessageCount.apply(t,b(e).concat([n]))}},{key:"getTotalUnreadChannelCount",value:function(e){return Sn.getInstance(this._iid).getTotalUnreadChannelCount(e)}},{key:"MemberStateFilter",get:function(){return{ALL:"all",JOINED:"joined_only",INVITED:"invited_only",INVITED_BY_FRIEND:"invited_by_friend",INVITED_BY_NON_FRIEND:"invited_by_non_friend"}}},{key:"PushTriggerOption",get:function(){return{DEFAULT:"default",ALL:"all",MENTION_ONLY:"mention_only",OFF:"off"}}},{key:"CountPreference",get:function(){return{ALL:"all",UNREAD_MESSAGE_COUNT_ONLY:"unread_message_count_only",UNREAD_MENTION_COUNT_ONLY:"unread_mention_count_only",OFF:"off"}}},{key:"HiddenState",get:function(){return{UNHIDDEN:"unhidden",HIDDEN_ALLOW_AUTO_UNHIDE:"hidden_allow_auto_unhide",HIDDEN_PREVENT_AUTO_UNHIDE:"hidden_prevent_auto_unhide"}}},{key:"PublicChannelFilter",get:function(){return{ALL:"all",PUBLIC:"public",PRIVATE:"private"}}},{key:"SuperChannelFilter",get:function(){return{ALL:"all",SUPER:"super",NON_SUPER:"nonsuper"}}},{key:"UnreadChannelFilter",get:function(){return{ALL:"all",UNREAD_MESSAGE:"unread_message"}}},{key:"HiddenChannelFilter",get:function(){return{UNHIDDEN:"unhidden_only",HIDDEN:"hidden_only",HIDDEN_ALLOW_AUTO_UNHIDE:"hidden_allow_auto_unhide",HIDDEN_PREVENT_AUTO_UNHIDE:"hidden_prevent_auto_unhide"}}},{key:"Role",get:function(){return{OPERATOR:"operator",NONE:"none"}}},{key:"UnreadItemKey",get:function(){return{GROUP_CHANNEL_UNREAD_MENTION_COUNT:"group_channel_unread_mention_count",NONSUPER_UNREAD_MENTION_COUNT:"non_super_group_channel_unread_mention_count",SUPER_UNREAD_MENTION_COUNT:"super_group_channel_unread_mention_count",GROUP_CHANNEL_UNREAD_MESSAGE_COUNT:"group_channel_unread_message_count",NONSUPER_UNREAD_MESSAGE_COUNT:"non_super_group_channel_unread_message_count",SUPER_UNREAD_MESSAGE_COUNT:"super_group_channel_unread_message_count",GROUP_CHANNEL_INVITATION_COUNT:"group_channel_invitation_count",NONSUPER_INVITATION_COUNT:"non_super_group_channel_invitation_count",SUPER_INVITATION_COUNT:"super_group_channel_invitation_count"}}},{key:"cachedChannels",get:function(){return ue[this._iid]||(ue[this._iid]={}),ue[this._iid]}},{key:"markAsReadAllLastSentAt",get:function(){return ce[this._iid]||0},set:function(e){ce[this._iid]=e}}]),a}(),Ie=function(){o(r,J);var t=h(r);function r(e){var n;return v(this,r),(n=t.call(this,e)).state="",n.role="",n.isMuted=!1,n.isBlockedByMe=!1,n.isBlockingMe=!1,e&&n._update(e),n}return s(r,[{key:"_update",value:function(e){this.state=e.state,this.role=e.role||Ae.Role.NONE,e.hasOwnProperty("is_muted")&&(this.isMuted=e.is_muted),e.hasOwnProperty("is_blocked_by_me")&&(this.isBlockedByMe=e.is_blocked_by_me),e.hasOwnProperty("is_blocking_me")&&(this.isBlockingMe=e.is_blocking_me)}},{key:"parse",value:function(e){this._update(e)}}],[{key:"objectify",value:function(e){var n=pe.get(this._iid).User,t=e.user,r=e.state,i=e.role,a=void 0===i?"":i,s=e.isMuted,o=void 0!==s&&s,l=e.isBlockedByMe,u=void 0!==l&&l,c=e.isBlockingMe,d=void 0!==c&&c,h=n.objectify(t);return h.state=r,h.role=a,h.is_muted=o,h.is_blocked_by_me=u,h.is_blocking_me=d,h}},{key:"build",value:function(e,n,t,r,i,a){var s=pe.get(this._iid).User;return this.objectify({user:new s(e),state:n,role:t,isMuted:r,isBlockedByMe:i,isBlockingMe:a})}},{key:"buildFromSerializedData",value:function(e){var n=pe.get(this._iid).Member,t=x.deserialize(e);return new n(n.objectify(g({user:t},t)))}},{key:"JOINED",get:function(){return"joined"}},{key:"INVITED",get:function(){return"invited"}}]),r}(),Se=function(){o(r,J);var t=h(r);function r(e){var n;return v(this,r),(n=t.call(this,e)).role="",n.isBlockedByMe=!1,e&&n._update(e),n}return s(r,[{key:"parse",value:function(e){this._update(e)}},{key:"_update",value:function(e){this.role=e.role||Ae.Role.NONE,e.hasOwnProperty("is_blocked_by_me")&&(this.isBlockedByMe=e.is_blocked_by_me)}}],[{key:"objectify",value:function(e){var n=pe.get(this._iid).User,t=e.user,r=e.role,i=void 0===r?"":r,a=e.isBlockedByMe,s=void 0!==a&&a,o=n.objectify(t);return o.role=i,o.is_blocked_by_me=s,o}},{key:"build",value:function(e,n){var t=pe.get(this._iid).User;return this.objectify({user:new t(e),isBlockedByMe:n})}},{key:"buildFromSerializedData",value:function(e){var n=pe.get(this._iid).Sender,t=x.deserialize(e);return new n(n.objectify(g({user:t},t)))}}]),r}(),Ne=function(){function n(e){v(this,n),this.emojiHash=null,this.emojiCategories=null,e&&this._update(e)}return s(n,[{key:"_update",value:function(e){var n=pe.get(this._iid).EmojiCategory;this.emojiHash=e.emoji_hash||"",this.emojiCategories=e.emoji_categories?e.emoji_categories.map(function(e){return new n(e)}):[]}}]),n}(),ke=function(){function n(e){v(this,n),this.id=null,this.name=null,this.url=null,this.emojis=null,e&&this._update(e)}return s(n,[{key:"_update",value:function(e){var n=pe.get(this._iid).Emoji;this.id=e.id||0,this.name=e.name||"",this.url=e.url||"",this.emojis=e.emojis?e.emojis.map(function(e){return new n(e)}):[]}}]),n}(),Re=function(){function n(e){v(this,n),this.key=null,this.url=null,e&&this._update(e)}return s(n,[{key:"_update",value:function(e){this.key=e.key,this.url=e.url}}]),n}(),Me={},Te={},Oe=function(){o(r,Z);var t=h(r);function r(e){var n;return v(this,r),(n=t.call(this,e)).channelType=Z.CHANNEL_TYPE_OPEN,n.participantCount=0,n.operators=[],e&&n._update(e),n}return s(r,[{key:"_update",value:function(e){var n=pe.get(this._iid).User;e.hasOwnProperty("participant_count")&&(this.participantCount=parseInt(e.participant_count)),e.hasOwnProperty("operators")&&Array.isArray(e.operators)&&(this.operators=e.operators.map(function(e){return new n(e)}))}},{key:"parse",value:function(e){this._update(e)}},{key:"update",value:function(e){this.__update(e),this._update(e)}},{key:"createParticipantListQuery",value:function(){return new(pe.get(this._iid).ParticipantListQuery)({channelUrl:this.url})}},{key:"createMutedUserListQuery",value:function(){return new(pe.get(this._iid).MutedUserListQuery)({channelUrl:this.url,isOpenChannel:!0})}},{key:"createBannedUserListQuery",value:function(){return new(pe.get(this._iid).BannedUserListQuery)({channelUrl:this.url,isOpenChannel:!0})}},{key:"isOperator",value:function(e){return!!e&&this.isOperatorWithUserId(e.userId)}},{key:"isOperatorWithUserId",value:function(e){return-1<this.operators.map(function(e){return e.userId}).indexOf(e)}},{key:"refresh",value:function(e){return pe.get(this._iid).OpenChannel.getChannelWithoutCache(this.url,e)}},{key:"enter",value:function(e){var a=this;return Y(this._iid,function(r){var e=pe.get(a._iid).Command.bEnter({channelUrl:a.url}),i=Sn.getInstance(a._iid);i.sendCommand(e,function(e,n){if(i.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}n?(n=n?new ye(n.message,n.code):null,r(n,null)):(pe.get(a._iid).OpenChannel.enteredChannels[a.url]=a).refresh(function(){return r(null,null)})})},e)}},{key:"exit",value:function(e){var s=this;return Y(this._iid,function(r){var e=pe.get(s._iid),n=e.Command,i=e.FileMessageQueue,t=n.bExit({channelUrl:s.url}),a=Sn.getInstance(s._iid);a.sendCommand(t,function(e,n){if(a.getErrorFirstCallback()){var t=[e,n];n=t[0],e=t[1]}n?(n=n?new ye(n.message,n.code):null,r(n,null)):(delete pe.get(s._iid).OpenChannel.enteredChannels[s.url],i.delete(s.url),r(null,null))})},e)}},{key:"updateChannel",value:function(e,n,t,i,a,r){var s,o=this,l=B(j.parse(arguments,[new j({type:"string",nullable:!0}),new j({type:["string","file"],nullable:!0}),new j({type:"string",nullable:!0}),new j({type:"array",nullable:!0,optional:!0,defaultValue:null,constraint:function(e){return e.map(function(e){return"string"==typeof e})}}),new j({type:"string",nullable:!0,optional:!0}),new j({type:"callback"})]),7);return s=l[0],e=l[1],n=l[2],t=l[3],i=l[4],a=l[5],r=l[6],Y(this._iid,function(r){s?r(s,null):_e.get(o._iid).container.apiClient.updateOpenChannel({channelUrl:o.url,name:e,coverUrlOrImage:n,data:t,operatorUserIds:i,customType:a},function(e,n){var t=null;e||(t=pe.get(o._iid).OpenChannel.upsert(n));r(e,t)})},r)}},{key:"updateChannelWithOperatorUserIds",value:function(){var e=j.toArray(arguments),n=void 0;switch("function"==typeof e[e.length-1]&&(n=e.pop()),e.length){case 4:case 5:return this.updateChannel.apply(this,b(e).concat([n]));default:return Y(this._iid,function(e){return e(j.error,null)},n)}}},{key:"muteUser",value:function(e,n,t,r){return this.muteUserWithUserId(e?e.userId:null,n,t,r)}},{key:"muteUserWithUserId",value:function(e,n,r,t){var i,a=this,s=B(j.parse(arguments,[new j({type:"string"}),new j({type:"number",optional:!0,defaultValue:-1,constraint:function(e){return-1<=e}}),new j({type:"string",optional:!0,defaultValue:""}),new j({type:"callback"})]),5);return i=s[0],e=s[1],n=s[2],r=s[3],t=s[4],Y(this._iid,function(t){i?t(i,null):_e.get(a._iid).container.apiClient.muteUser({channelUrl:a.url,userId:e,description:r,seconds:n,isGroupChannel:!1},function(e,n){t(e,null)})},t)}},{key:"unmuteUser",value:function(e,n){return this.unmuteUserWithUserId(e?e.userId:null,n)}},{key:"unmuteUserWithUserId",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"string"}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.unmuteUser({channelUrl:i.url,userId:e,isGroupChannel:!1},function(e,n){t(e,null)})},n)}},{key:"banUser",value:function(e,n,t){return this.banUserWithUserId(e?e.userId:null,n,t)}},{key:"banUserWithUserId",value:function(e,n,t){var r,i=this,a=B(j.parse(arguments,[new j({type:"string"}),new j({type:"number",optional:!0,defaultValue:-1,constraint:function(e){return-1<=e}}),new j({type:"callback"})]),4);return r=a[0],e=a[1],n=a[2],t=a[3],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.banUser({channelUrl:i.url,userId:e,description:null,seconds:n,isGroupChannel:!1},function(e,n){t(e,null)})},t)}},{key:"unbanUser",value:function(e,n){return this.unbanUserWithUserId(e?e.userId:null,n)}},{key:"unbanUserWithUserId",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"string"}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.unbanUser({channelUrl:i.url,userId:e,isGroupChannel:!1},function(e,n){t(e,null)})},n)}},{key:"delete",value:function(e){var r=this;return Y(this._iid,function(t){_e.get(r._iid).container.apiClient.deleteOpenChannel({channelUrl:r.url},function(e,n){e||(delete pe.get(r._iid).OpenChannel.cachedChannels[r.url],pe.get(r._iid).FileMessageQueue.delete(r.url));t(e,n)})},e)}}],[{key:"buildFromSerializedData",value:function(e){var n=pe.get(this._iid),t=n.User,r=n.OpenChannel,i=x.deserialize(e);return new r({channel_url:i.url,name:i.name,cover_url:i.coverUrl,data:i.data,custom_type:i.customType,created_at:i.createdAt/1e3,freeze:i.isFrozen,is_ephemeral:i.isEphemeral,participant_count:i.participantCount,operators:i.operators.map(function(e){return t.objectify(e)})})}},{key:"getChannel",value:function(n,e){var t,r,i=B(j.parse(arguments,[new j({type:"string"}),new j({type:"string",optional:!0,nullable:!0,defaultValue:null}),new j({type:"callback"})]),4);if(t=i[0],n=i[1],r=i[2],e=i[3],t)return Y(this._iid,function(e){e(t,null)},e);var a=pe.get(this._iid).OpenChannel;return a.cachedChannels[n]?Y(this._iid,function(e){e(null,a.cachedChannels[n])},e):a.getChannelWithoutCache(n,r,e)}},{key:"getChannelWithoutCache",value:function(e,n){var t,i,a=this,r=B(j.parse(arguments,[new j({type:"string"}),new j({type:"string",optional:!0,nullable:!0,defaultValue:null}),new j({type:"callback"})]),4);return t=r[0],e=r[1],i=r[2],n=r[3],Y(this._iid,function(r){t?r(t,null):_e.get(a._iid).container.apiClient.getOpenChannel({channelUrl:e,internalCall:i},function(e,n){var t=null;e||(t=pe.get(a._iid).OpenChannel.upsert(n));r(e,t)})},n)}},{key:"createChannel",value:function(e,n,t,i,a,r){var s,o=this,l=B(j.parse(arguments,[new j({type:"string",nullable:!0,ignoreIf:function(e){return 0===e.length}}),new j({type:["string","file"],nullable:!0,ignoreIf:function(e){return 0===e.length}}),new j({type:"string",nullable:!0,ignoreIf:function(e){return 0===e.length}}),new j({type:"array",nullable:!0,ignoreIf:function(e){return e.length<4},constraint:function(e){return e.map(function(e){return"string"==typeof e})}}),new j({type:"string",nullable:!0,ignoreIf:function(e){return e.length<5}}),new j({type:"callback"})]),7);return s=l[0],e=l[1],n=l[2],t=l[3],i=l[4],a=l[5],r=l[6],Y(this._iid,function(r){s?r(s,null):_e.get(o._iid).container.apiClient.createOpenChannel({name:e,coverUrlOrImage:n,data:t,operatorUserIds:i,customType:a},function(e,n){var t=null;e||(t=pe.get(o._iid).OpenChannel.upsert(n));r(e,t)})},r)}},{key:"createChannelWithOperatorUserIds",value:function(){var e=j.toArray(arguments),n=void 0;switch("function"==typeof e[e.length-1]&&(n=e.pop()),e.length){case 4:case 5:return this.createChannel.apply(this,b(e).concat([n]));default:return Y(this._iid,function(e){return e(j.error,null)},n)}}},{key:"upsert",value:function(e){var n=new(pe.get(this._iid).OpenChannel)(e);return this.cachedChannels.hasOwnProperty(n.url)?this.cachedChannels[n.url].update(e):this.cachedChannels[n.url]=n,this.cachedChannels[n.url]}},{key:"removeCachedChannel",value:function(e){this.cachedChannels[e]&&delete this.cachedChannels[e],pe.get(this._iid).FileMessageQueue.delete(e)}},{key:"clearCache",value:function(){Me[this._iid]={},pe.get(this._iid).FileMessageQueue.clear()}},{key:"clearEnteredChannels",value:function(){Te[this._iid]={}}},{key:"createOpenChannelListQuery",value:function(){return new(pe.get(this._iid).OpenChannelListQuery)}},{key:"cachedChannels",get:function(){return Me[this._iid]||(Me[this._iid]={}),Me[this._iid]}},{key:"enteredChannels",get:function(){return Te[this._iid]||(Te[this._iid]={}),Te[this._iid]}}]),r}(),Le=function(){o(r,W);var t=h(r);function r(e){var n;return v(this,r),(n=t.call(this,e)).messageType=W.MESSAGE_TYPE_USER,n.message=null,n._sender=null,n.reqId="",n.translations={},n.requestState=null,n.sendingStatus=null,n.requestedMentionUserIds=[],n.errorCode=0,n.messageSurvivalSeconds=-1,e&&n._update(e),n}return s(r,[{key:"_update",value:function(e){var n=Sn.getInstance(this._iid),t=pe.get(this._iid).Sender;this.message=String(e.message),this._sender=new t(e.user),this.reqId=e.hasOwnProperty("req_id")?String(e.req_id):"",this.translations=e.hasOwnProperty("translations")?e.translations:{},this.sendingStatus=0<this.messageId?n.MessageSendingStatus.SUCCEEDED:n.MessageSendingStatus.FAILED,e.hasOwnProperty("sending_status")&&(this.sendingStatus=e.sending_status),this.requestState=0<this.messageId?n.MessageRequestState.SUCCEEDED:n.MessageRequestState.FAILED,e.hasOwnProperty("sending_status")&&(this.requestState=e.sending_status,this.requestState===n.MessageSendingStatus.CANCELED&&(this.requestState=n.MessageRequestState.FAILED)),this.requestedMentionUserIds=[],e.hasOwnProperty("requested_mention_user_ids")&&(this.requestedMentionUserIds=e.requested_mention_user_ids),this.errorCode=0,e.hasOwnProperty("error_code")&&(this.errorCode=e.error_code),this.messageSurvivalSeconds=-1,e.hasOwnProperty("message_survival_seconds")&&(this.messageSurvivalSeconds=e.message_survival_seconds)}},{key:"isResendable",value:function(){var e=Sn.getInstance(this._iid);return this.sendingStatus===e.MessageSendingStatus.FAILED&&ve.isResendableError(this.errorCode)}},{key:"sender",get:function(){var e=Sn.getInstance(this._iid),n=pe.get(this._iid).GroupChannel;if(e.Options.useMemberAsMessageSender&&this.isGroupChannel()){var t=n.cachedChannels[this.channelUrl];if(t){var r=t.memberMap[this._sender.userId];r&&(this._sender.nickname!==r.nickname&&(this._sender.nickname=r.nickname),this._sender.plainProfileUrl!==r.plainProfileUrl&&(this._sender.plainProfileUrl=r.plainProfileUrl),ve.deepEqual(this._sender.metaData,r.metaData)||(this._sender.metaData=r.metaData))}}return this._sender},set:function(e){this._sender=e}}],[{key:"objectify",value:function(e){var n=Sn.getInstance(this._iid),t=pe.get(this._iid),r=t.BaseChannel,i=t.BaseMessageParams,a=t.Sender,s=t.User,o=t.ThreadInfo,l=t.OGMetaData,u=e.messageId,c=e.reqId,d=void 0===c?"":c,h=e.user,p=e.channel,f=e.message,g=e.data,_=void 0===g?"":g,y=e.customType,m=void 0===y?"":y,v=e.mentionType,C=void 0===v?i.MentionType.USERS:v,E=e.mentionedUsers,U=void 0===E?[]:E,b=e.mentionedUserIds,A=void 0===b?[]:b,I=e.requestedMentionUserIds,S=void 0===I?[]:I,N=e.reactions,k=void 0===N?[]:N,R=e.metaArrays,M=void 0===R?[]:R,T=e.rootMessageId,O=void 0===T?0:T,L=e.parentMessageId,P=void 0===L?0:L,w=e.parentMessageText,D=void 0===w?"":w,H=e.threadInfo,F=void 0===H?null:H,G=e.translations,B=void 0===G?{}:G,j=e.sendingStatus,x=e.errorCode,q=void 0===x?0:x,z=e.silent,Q=void 0!==z&&z,Y=e.isGlobalBlocked,K=void 0!==Y&&Y,V=e.messageSurvivalSeconds,W=void 0===V?-1:V,J=e.ogMetaData,X=void 0===J?null:J,Z=e.isOperatorMessage,$=void 0!==Z&&Z,ee=e.createdAt,ne=e.updatedAt,te=void 0===ne?0:ne,re={};for(var ie in re.req_id=d,re.msg_id=u,re.user=a.objectify({user:h,isBlockedByMe:h.isBlockedByMe}),re.channel_url=p.url,re.channel_type=p.channelType===r.CHANNEL_TYPE_OPEN?r.CHANNEL_TYPE_OPEN:r.CHANNEL_TYPE_GROUP,re.message=f,re.data=_,re.custom_type=m,re.translations=B,re.is_global_block=!!K,re.ts=ee,re.updated_at=te,re.mention_type=C,re.mentioned_users=U.map(function(e){return s.objectify(e)}),re.mentioned_user_ids=A,re.requested_mention_user_ids=S,re.reactions=k.map(function(e){return e.serialize()}),re.metaarray={},M){var ae=M[ie].key;re.metaarray[ae]=M[ie].value}return re.metaarray_key_order=M.map(function(e){return e.key}),re.root_message_id=O,re.parent_message_id=P,re.parent_message_text=D,F&&(re.thread_info=o.objectify(F)),re.sending_status=0<u?n.MessageSendingStatus.SUCCEEDED:n.MessageSendingStatus.FAILED,j&&(re.sending_status=j),re.silent=!!Q,re.error_code=q,re.message_survival_seconds=W,X&&(re.og_tag=l.objectify(X)),re.is_op_msg=!!$,re}},{key:"build",value:function(e,n,t,r,i,a,s,o,l,u,c,d,h,p,f,g,_,y,m,v,C,E,U,b,A,I){return this.objectify({messageId:n,reqId:e,user:t,channel:r,message:i,data:a,customType:s,mentionType:p,mentionedUsers:f,mentionedUserIds:v,requestedMentionUserIds:E,reactions:h,metaArrays:d,rootMessageId:g,parentMessageId:_,parentMessageText:y,threadInfo:m,translations:o,sendingStatus:C,errorCode:U,isGlobalBlocked:l,messageSurvivalSeconds:b,ogMetaData:A,isOperatorMessage:I,createdAt:u,updatedAt:c})}},{key:"buildFromSerializedData",value:function(e){var n=pe.get(this._iid).UserMessage,t=x.deserialize(e);return new n(n.objectify(g(g({},t),{},{channel:{url:t.channelUrl,channelType:t.channelType},user:t.sender})))}}]),r}(),Pe=function(){o(r,W);var t=h(r);function r(e){var n;return v(this,r),(n=t.call(this,e)).messageType=W.MESSAGE_TYPE_FILE,n.plainUrl=null,n.name="File",n.size=0,n.type=null,n.thumbnails=[],n._sender=null,n.reqId="",n.requireAuth=null,n.requestState=null,n.sendingStatus=null,n.requestedMentionUserIds=[],n.errorCode=0,n.messageSurvivalSeconds=-1,e&&n._update(e),n}return s(r,[{key:"_update",value:function(e){var n=Sn.getInstance(this._iid),t=_e.get(this._iid).container.auth,r=pe.get(this._iid).Sender;if(this._sender=new r(e.user),this.requireAuth=!!e.hasOwnProperty("require_auth")&&e.require_auth,this.plainUrl=String(e.url).split("?auth=")[0],this.name=e.hasOwnProperty("name")?e.name:"File",this.size=parseInt(e.size)||0,this.type=String(e.type),e.hasOwnProperty("custom")&&(this.data=String(e.custom)),this.reqId=e.hasOwnProperty("req_id")?String(e.req_id):"",this.thumbnails=e.hasOwnProperty("thumbnails")?e.thumbnails:[],this.requireAuth)for(var i in this.thumbnails)this.thumbnails[i].plainUrl=String(this.thumbnails[i].url).split("?auth=")[0],this.thumbnails[i].url=this.requireAuth?"".concat(this.thumbnails[i].plainUrl,"?auth=").concat(t.eKey):this.thumbnails[i].plainUrl;this.sendingStatus=0<this.messageId?n.MessageSendingStatus.SUCCEEDED:n.MessageSendingStatus.FAILED,e.hasOwnProperty("sending_status")&&(this.sendingStatus=e.sending_status),this.requestState=0<this.messageId?n.MessageRequestState.SUCCEEDED:n.MessageRequestState.FAILED,e.hasOwnProperty("sending_status")&&(this.requestState=e.sending_status,this.requestState===n.MessageSendingStatus.CANCELED&&(this.requestState=n.MessageRequestState.FAILED)),this.requestedMentionUserIds=[],e.hasOwnProperty("requested_mention_user_ids")&&(this.requestedMentionUserIds=e.requested_mention_user_ids),this.errorCode=0,e.hasOwnProperty("error_code")&&(this.errorCode=e.error_code),this.messageSurvivalSeconds=-1,e.hasOwnProperty("message_survival_seconds")&&(this.messageSurvivalSeconds=e.message_survival_seconds)}},{key:"isResendable",value:function(){var e=Sn.getInstance(this._iid);return this.sendingStatus===e.MessageSendingStatus.FAILED&&ve.isResendableError(this.errorCode)}},{key:"sender",get:function(){var e=Sn.getInstance(this._iid),n=pe.get(this._iid).GroupChannel;if(e.Options.useMemberAsMessageSender&&this.isGroupChannel()){var t=n.cachedChannels[this.channelUrl];if(t){var r=t.memberMap[this._sender.userId];r&&(this._sender.nickname!==r.nickname&&(this._sender.nickname=r.nickname),this._sender.plainProfileUrl!==r.plainProfileUrl&&(this._sender.plainProfileUrl=r.plainProfileUrl),ve.deepEqual(this._sender.metaData,r.metaData)||(this._sender.metaData=r.metaData))}}return this._sender},set:function(e){this._sender=e}},{key:"url",get:function(){if(this.requireAuth){var e=_e.get(this._iid).container.auth;return"".concat(this.plainUrl,"?auth=").concat(e.eKey)}return this.plainUrl}}],[{key:"objectify",value:function(e){var n=Sn.getInstance(this._iid),t=pe.get(this._iid),r=t.BaseChannel,i=t.BaseMessageParams,a=t.Sender,s=t.User,o=t.ThreadInfo,l=t.OGMetaData,u=e.messageId,c=e.reqId,d=void 0===c?"":c,h=e.user,p=void 0===h?{}:h,f=e.channel,g=e.plainUrl,_=e.name,y=e.type,m=e.size,v=void 0===m?0:m,C=e.data,E=void 0===C?"":C,U=e.customType,b=void 0===U?"":U,A=e.mentionType,I=void 0===A?i.MentionType.USERS:A,S=e.mentionedUsers,N=void 0===S?[]:S,k=e.mentionedUserIds,R=void 0===k?[]:k,M=e.requestedMentionUserIds,T=void 0===M?[]:M,O=e.reactions,L=void 0===O?[]:O,P=e.metaArrays,w=void 0===P?[]:P,D=e.rootMessageId,H=void 0===D?0:D,F=e.parentMessageId,G=void 0===F?0:F,B=e.parentMessageText,j=void 0===B?"":B,x=e.threadInfo,q=void 0===x?null:x,z=e.thumbnails,Q=void 0===z?[]:z,Y=e.requireAuth,K=void 0!==Y&&Y,V=e.sendingStatus,W=e.errorCode,J=void 0===W?0:W,X=e.silent,Z=void 0!==X&&X,$=e.isGlobalBlocked,ee=void 0!==$&&$,ne=e.messageSurvivalSeconds,te=void 0===ne?-1:ne,re=e.ogMetaData,ie=void 0===re?null:re,ae=e.isOperatorMessage,se=void 0!==ae&&ae,oe=e.createdAt,le=e.updatedAt,ue=void 0===le?0:le,ce={};ce.req_id=d,ce.msg_id=u,ce.user=a.objectify({user:p,isBlockedByMe:p.isBlockedByMe}),ce.channel_url=f.url,ce.channel_type=f.channelType===r.CHANNEL_TYPE_OPEN?r.CHANNEL_TYPE_OPEN:r.CHANNEL_TYPE_GROUP,ce.url=g,ce.name=_,ce.type=y,ce.size=v,ce.custom=E,ce.custom_type=b,ce.thumbnails=Q,ce.require_auth=K,ce.is_global_block=!!ee,ce.ts=oe,ce.updated_at=ue,ce.mention_type=I,ce.mentioned_users=N.map(function(e){return s.objectify(e)}),ce.mentioned_user_ids=R,ce.requested_mention_user_ids=T,ce.reactions=L.map(function(e){return e.serialize()}),ce.metaarray={};for(var de=0;de<w.length;de++){var he=w[de].key;ce.metaarray[he]=w[de].value}return ce.metaarray_key_order=w.map(function(e){return e.key}),ce.root_message_id=H,ce.parent_message_id=G,ce.parent_message_text=j,q&&(ce.thread_info=o.objectify(q)),ce.sending_status=0<u?n.MessageSendingStatus.SUCCEEDED:n.MessageSendingStatus.FAILED,V&&(ce.sending_status=V),ce.silent=!!Z,ce.error_code=J,ce.message_survival_seconds=te,ie&&(ce.og_tag=l.objectify(ie)),ce.is_op_msg=!!se,ce}},{key:"build",value:function(e,n,t,r,i,a,s,o,l,u,c,d,h,p,f,g,_,y,m,v,C,E,U,b,A,I,S,N,k,R){return this.objectify({messageId:n,reqId:e,user:t,channel:r,plainUrl:i,name:a,type:s,size:o,data:l,customType:u,mentionType:y,mentionedUsers:m,mentionedUserIds:b,requestedMentionUserIds:I,reactions:_,metaArrays:g,rootMessageId:v,parentMessageId:C,parentMessageText:E,threadInfo:U,thumbnails:h,requireAuth:p,sendingStatus:A,errorCode:S,isGlobalBlocked:c,messageSurvivalSeconds:N,ogMetaData:k,isOperatorMessage:R,createdAt:d,updatedAt:f})}},{key:"buildFromSerializedData",value:function(e){var n=pe.get(this._iid).FileMessage,t=x.deserialize(e);return new n(n.objectify(g(g({},t),{},{channel:{url:t.channelUrl,channelType:t.channelType},user:t.sender})))}}]),r}(),we=function(){o(r,W);var t=h(r);function r(e){var n;return v(this,r),(n=t.call(this,e)).messageType=W.MESSAGE_TYPE_ADMIN,n.message="",n.translations={},e&&n._update(e),n}return s(r,[{key:"_update",value:function(e){this.message=String(e.message),this.translations=e.hasOwnProperty("translations")?e.translations:{}}}],[{key:"objectify",value:function(e){var n=pe.get(this._iid),t=n.BaseChannel,r=n.BaseMessageParams,i=n.User,a=n.ThreadInfo,s=n.OGMetaData,o=e.messageId,l=e.channel,u=e.message,c=e.data,d=void 0===c?"":c,h=e.customType,p=void 0===h?"":h,f=e.mentionType,g=void 0===f?r.MentionType.USERS:f,_=e.mentionedUsers,y=void 0===_?[]:_,m=e.reactions,v=void 0===m?[]:m,C=e.metaArrays,E=void 0===C?[]:C,U=e.rootMessageId,b=void 0===U?0:U,A=e.parentMessageId,I=void 0===A?0:A,S=e.parentMessageText,N=void 0===S?"":S,k=e.threadInfo,R=void 0===k?null:k,M=e.translations,T=void 0===M?{}:M,O=e.silent,L=void 0!==O&&O,P=e.ogMetaData,w=void 0===P?null:P,D=e.createdAt,H=e.updatedAt,F=void 0===H?0:H,G={msg_id:o,channel_url:l.url,channel_type:l.channelType===t.CHANNEL_TYPE_OPEN?t.CHANNEL_TYPE_OPEN:t.CHANNEL_TYPE_GROUP,message:u,data:d,custom_type:p,silent:L,ts:D,updated_at:F};G.translations=T,G.mention_type=g,G.mentioned_users=y.map(function(e){return i.objectify(e)}),G.reactions=v.map(function(e){return e.serialize()}),G.metaarray={};for(var B=0;B<E.length;B++){var j=E[B].key;G.metaarray[j]=E[B].value}return G.metaarray_key_order=E.map(function(e){return e.key}),G.root_message_id=b,G.parent_message_id=I,G.parent_message_text=N,R&&(G.thread_info=a.objectify(R)),w&&(G.og_tag=s.objectify(w)),G}},{key:"build",value:function(e,n,t,r,i,a,s,o,l,u,c,d,h,p,f,g,_){return this.objectify({messageId:e,channel:n,message:t,data:r,customType:i,mentionType:c,mentionedUsers:d,reactions:u,metaArrays:l,rootMessageId:h,parentMessageId:p,parentMessageText:f,threadInfo:g,translations:a,ogMetaData:_,createdAt:s,updatedAt:o})}},{key:"buildFromSerializedData",value:function(e){var n=pe.get(this._iid).AdminMessage,t=x.deserialize(e);return new n(n.objectify(g(g({},t),{},{channel:{url:t.channelUrl,channelType:t.channelType}})))}}]),r}(),De=function(){function d(e){v(this,d);var n=pe.get(this._iid),t=n.BaseMessage,r=n.BaseMessageParams;this.scheduledId=0,this.scheduledDateTimeString="",this.scheduledTimezone="",this.status=d.Status.SCHEDULED,this.createdAt=0,this.updatedAt=0,this._messageType=t.MESSAGE_TYPE_BASE,this._sender=null,this._channelType="",this.channelUrl="",this.message="",this.customType="",this.data="",this.metaArrays=[],this.mentionType=r.MentionType.USERS,this.mentionedUsers=[],this.pushNotificationDeliveryOption=r.PushNotificationDeliveryOption.DEFAULT,this.translationTargetLanguages=[],this.errorMessage="",this.errorCode=0,e&&this._update(e)}return s(d,[{key:"_update",value:function(e){var t=this,n=pe.get(this._iid),r=n.User,i=n.Sender,a=n.BaseMessageParams,s=n.MessageMetaArray;this.scheduledId=e.hasOwnProperty("scheduled_id")?parseInt(e.scheduled_id):0,this.scheduledDateTimeString=e.hasOwnProperty("scheduled_dt")?String(e.scheduled_dt):"",this.scheduledTimezone=e.hasOwnProperty("scheduled_timezone")?String(e.scheduled_timezone):"",this.status=e.hasOwnProperty("status")?String(e.status):"",this.createdAt=e.hasOwnProperty("created_at")?parseInt(e.created_at):0,this.updatedAt=e.hasOwnProperty("updated_at")?parseInt(e.updated_at):0,this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this._channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):"",this._messageType=e.hasOwnProperty("type")?String(e.type):"",this._sender=e.hasOwnProperty("user")?new i(e.user):"",this.message=e.hasOwnProperty("message")?String(e.message):"",this.customType=e.hasOwnProperty("custom_type")?String(e.custom_type):"",this.data=e.hasOwnProperty("data")?String(e.data):"";var o=e.hasOwnProperty("metaarray")?e.metaarray:{},l=e.hasOwnProperty("metaarray_key_order")?e.metaarray_key_order:Object.keys(o).sort(function(e,n){return e.localeCompare(n)});this.metaArrays=[];for(var u=0;u<l.length;u++){var c=l[u];this.metaArrays.push(new s(c,o[c]||[]))}this.mentionType=e.hasOwnProperty("mention_type")?e.mention_type:a.MentionType.USERS,this.mentionedUsers=[],e.hasOwnProperty("mentioned_users")&&e.mentioned_users.forEach(function(e){var n=new r(e);t.mentionedUsers.push(n)});this.pushNotificationDeliveryOption=e.hasOwnProperty("push_option")?e.push_option:a.PushNotificationDeliveryOption.DEFAULT,this.translationTargetLanguages=e.hasOwnProperty("translation_target_langs")?e.translation_target_langs:[],this.status===d.Status.FAILED&&(e.hasOwnProperty("error")&&e.error.hasOwnProperty("message")&&(this.errorMessage=String(e.error.message)),e.hasOwnProperty("error")&&e.error.hasOwnProperty("code")&&(this.errorCode=parseInt(e.error.code)))}},{key:"isOpenChannel",value:function(){var e=pe.get(this._iid).BaseChannel;return this._channelType===e.CHANNEL_TYPE_OPEN}},{key:"isGroupChannel",value:function(){var e=pe.get(this._iid).BaseChannel;return this._channelType===e.CHANNEL_TYPE_GROUP}},{key:"sender",get:function(){var e=Sn.getInstance(this._iid),n=pe.get(this._iid).GroupChannel;if(e.Options.useMemberAsMessageSender&&this.isGroupChannel()){var t=n.cachedChannels[this.channelUrl];if(t){var r=t.memberMap[this._sender.userId];r&&(this._sender.nickname!==r.nickname&&(this._sender.nickname=r.nickname),this._sender.plainProfileUrl!==r.plainProfileUrl&&(this._sender.plainProfileUrl=r.plainProfileUrl),ve.deepEqual(this._sender.metaData,r.metaData)||(this._sender.metaData=r.metaData))}}return this._sender},set:function(e){this._sender=e}},{key:"metaArray",get:function(){var n={};return this.metaArrays.forEach(function(e){n[e.key]=e.value}),n},set:function(e){if("object"===fe(e)&&e){var n=pe.get(this._iid).MessageMetaArray,t=[];for(var r in e)t.push(new n(r,e[r]));this.metaArrays=t}}}],[{key:"Status",get:function(){return{SCHEDULED:"scheduled",SENT:"sent",CANCELED:"canceled",FAILED:"failed"}}}]),d}(),He=function(){function e(){v(this,e),this.threadInfo=null,this.targetMessageId=0,this.channelUrl=null,this.channelType=null}return s(e,null,[{key:"createFromJson",value:function(e){var n=pe.get(this._iid),t=n.BaseChannel,r=n.ThreadInfo,i=e.thread_info,a=e.root_message_id,s=e.channel_url,o=e.channel_type;if(!i||"object"!==fe(i)||"string"!=typeof a&&"number"!=typeof a||"string"!=typeof s||"string"!=typeof o||![t.CHANNEL_TYPE_GROUP].includes(o))return null;var l=new this;return l.threadInfo=new r(i),l.targetMessageId=parseInt(a),l.channelUrl=s,l.channelType=o,l}}]),e}(),Fe=function(){function e(){v(this,e),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.userIdsFilter=[],this.metaDataKeyFilter="",this.metaDataValuesFilter=[],this._token=""}return s(e,[{key:"next",value:function(e){var s=this;return Y(this._iid,function(a){"number"==typeof s.limit&&0<s.limit&&Array.isArray(s.userIdsFilter)&&"string"==typeof s.metaDataKeyFilter&&Array.isArray(s.metaDataValuesFilter)&&!!s.metaDataKeyFilter==0<s.metaDataValuesFilter.length?s.isLoading?a(new ye("Query in progress.",ye.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,_e.get(s._iid).container.apiClient.loadUserList(g(g({},s),{},{token:s._token}),function(e,n){var t=null;if(!e){var r=pe.get(s._iid).User,i=String(n.next);s._token=i,s.hasNext=!!i,t=n.users.map(function(e){return new r(e)})}s.isLoading=!1,a(e,t)})):a(null,[]):a(j.error,null)},e)}}]),e}(),Ge=function(){function n(e){v(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this._isOpenChannel=!1,this._channelUrl=null,this._token="",e.channelUrl&&(this._channelUrl=e.channelUrl),e.isOpenChannel&&(this._isOpenChannel=e.isOpenChannel)}return s(n,[{key:"next",value:function(e){var s=this;return Y(this._iid,function(a){"number"==typeof s.limit&&0<s.limit?s.isLoading?a(new ye("Query in progress.",ye.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,_e.get(s._iid).container.apiClient.loadBannedUserList(g(g({},s),{},{channelUrl:s._channelUrl,isOpenChannel:s._isOpenChannel,token:s._token}),function(e,n){var t=null;if(!e){var r=pe.get(s._iid).User,i=String(n.next);s._token=i,s.hasNext=!!i,t=n.banned_list.map(function(e){return new r(e.user)})}s.isLoading=!1,a(e,t)})):a(null,[]):a(j.error,null)},e)}}]),n}(),Be=function(){function e(){v(this,e),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.userIdsFilter=[],this._token=""}return s(e,[{key:"next",value:function(e){var s=this;return Y(this._iid,function(a){"number"==typeof s.limit&&0<s.limit&&Array.isArray(s.userIdsFilter)?s.isLoading?a(new ye("Query in progress.",ye.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,_e.get(s._iid).container.apiClient.loadBlockedUserList(g(g({},s),{},{token:s._token}),function(e,n){var t=null;if(!e){var r=pe.get(s._iid).User,i=String(n.next);s._token=i,s.hasNext=!!i,t=n.users.map(function(e){return new r(e)})}s.isLoading=!1,a(e,t)})):a(null,[]):a(j.error,null)},e)}}]),e}(),je=function(){function e(){v(this,e),this.isLoading=!1,this.hasMore=!0,this.limit=20,this._token=""}return s(e,[{key:"next",value:function(e){var s=this;return Y(this._iid,function(a){"number"==typeof s.limit&&0<s.limit?s.isLoading?a(new ye("Query in progress.",ye.QUERY_IN_PROGRESS),null):s.hasMore?(s.isLoading=!0,_e.get(s._iid).container.apiClient.loadFriendList(g(g({},s),{},{token:s._token}),function(e,n){var t=null;if(!e){var r=pe.get(s._iid).User,i=String(n.next);s._token=i,s.hasMore=!!i,t=n.users.map(function(e){return new r(e)})}s.isLoading=!1,a(e,t)})):a(null,[]):a(j.error,null)},e)}}]),e}(),xe=function(){function n(){v(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.includeEmpty=!1,this.order=n.ORDER_LATEST_LAST_MESSAGE,this._token="",this._searchFilter={},this._userIdsFilter={userIds:[],includeMode:!0,queryType:n.QueryType.AND},this._userIdsExactFilter=[],this._userIdsIncludeFilter=[],this._userIdsIncludeFilterQueryType=n.QueryType.AND,this.nicknameContainsFilter="",this.channelNameContainsFilter="",this.memberStateFilter=Ae.MemberStateFilter.ALL,this.customTypesFilter=[],this.channelUrlsFilter=[],this.superChannelFilter=Ae.SuperChannelFilter.ALL,this.publicChannelFilter=Ae.PublicChannelFilter.ALL,this.customTypeStartsWithFilter=null,this.unreadChannelFilter=Ae.UnreadChannelFilter.ALL,this.metadataOrderKeyFilter=null,this.hiddenChannelFilter=Ae.HiddenChannelFilter.UNHIDDEN,this.includeFrozen=!0}return s(n,[{key:"setSearchFilter",value:function(e,n){Array.isArray(e)&&0!==e.length&&"string"==typeof n&&n&&(this._searchFilter={search_query:n,search_fields:e.join(",").toLocaleLowerCase()})}},{key:"serialize",value:function(){return x.serialize(this,function(e){e.isLoading=!1})}},{key:"next",value:function(e){var u=this;return Y(this._iid,function(o){var e=pe.get(u._iid),l=e.GroupChannel,n=e.GroupChannelListQuery;!("number"==typeof u.limit&&0<u.limit&&"boolean"==typeof u.includeEmpty&&"string"==typeof u.order&&-1<[n.ORDER_CHRONOLOGICAL,n.ORDER_LATEST_LAST_MESSAGE,n.CHANNEL_NAME_ALPHABETICAL,n.METADATA_VALUE_ALPHABETICAL].indexOf(u.order.toLowerCase())&&Array.isArray(u._userIdsExactFilter)&&Array.isArray(u._userIdsIncludeFilter)&&Array.isArray(u.customTypesFilter)&&Array.isArray(u.channelUrlsFilter)&&-1<Object.keys(n.QueryType).map(function(e){return n.QueryType[e]}).indexOf(u._userIdsIncludeFilterQueryType.toUpperCase())&&-1<Object.keys(l.MemberStateFilter).map(function(e){return l.MemberStateFilter[e]}).indexOf(u.memberStateFilter)&&-1<Object.keys(l.SuperChannelFilter).map(function(e){return l.SuperChannelFilter[e]}).indexOf(u.superChannelFilter)&&-1<Object.keys(l.PublicChannelFilter).map(function(e){return l.PublicChannelFilter[e]}).indexOf(u.publicChannelFilter)&&-1<Object.keys(l.UnreadChannelFilter).map(function(e){return l.UnreadChannelFilter[e]}).indexOf(u.unreadChannelFilter)&&-1<Object.keys(l.HiddenChannelFilter).map(function(e){return l.HiddenChannelFilter[e]}).indexOf(u.hiddenChannelFilter))||"string"!=typeof u.customTypeStartsWithFilter&&null!==u.customTypeStartsWithFilter||"string"!=typeof u.nicknameContainsFilter||"string"!=typeof u.channelNameContainsFilter||"string"!=typeof u.metadataOrderKeyFilter&&null!==u.metadataOrderKeyFilter||"boolean"!=typeof u.includeFrozen?o(j.error,null):u.isLoading?o(new ye("Query in progress.",ye.QUERY_IN_PROGRESS),null):u.hasNext?(u.isLoading=!0,_e.get(u._iid).container.apiClient.loadGroupChannelList(g(g({},u),{},{token:u._token,userIdsFilter:u._userIdsFilter,searchFilter:u._searchFilter}),function(e,n){if(e)return u.isLoading=!1,void o(e,null);var t=[],r=String(n.next);u._token=r,u.hasNext=!!r;for(var i=n.channels,a=0;a<i.length;a++){var s=l.upsert(i[a]);t.push(s)}u.isLoading=!1,o(e,t)})):o(null,[])},e)}},{key:"userIdsExactFilter",get:function(){return this._userIdsExactFilter},set:function(e){Array.isArray(e)&&(this._userIdsExactFilter=e,this._userIdsIncludeFilter=[],this._userIdsFilter.userIds=this._userIdsExactFilter,this._userIdsFilter.includeMode=!1)}},{key:"userIdsIncludeFilter",get:function(){return this._userIdsIncludeFilter},set:function(e){Array.isArray(e)&&(this._userIdsIncludeFilter=e,this._userIdsExactFilter=[],this._userIdsFilter.userIds=this._userIdsIncludeFilter,this._userIdsFilter.includeMode=!0)}},{key:"userIdsIncludeFilterQueryType",get:function(){return this._userIdsIncludeFilterQueryType},set:function(e){-1<Object.keys(n.QueryType).map(function(e){return n.QueryType[e]}).indexOf(e)&&(this._userIdsIncludeFilterQueryType=e.toUpperCase(),this._userIdsFilter.queryType=this._userIdsIncludeFilterQueryType)}}],[{key:"buildFromSerializedData",value:function(e){var n=pe.get(this._iid).GroupChannel,t=x.deserialize(e),r=n.createMyGroupChannelListQuery();for(var i in t)r.hasOwnProperty(i)&&(r[i]=t[i]);return r}},{key:"ORDER_LATEST_LAST_MESSAGE",get:function(){return"latest_last_message"}},{key:"ORDER_CHRONOLOGICAL",get:function(){return"chronological"}},{key:"CHANNEL_NAME_ALPHABETICAL",get:function(){return"channel_name_alphabetical"}},{key:"METADATA_VALUE_ALPHABETICAL",get:function(){return"metadata_value_alphabetical"}},{key:"QueryType",get:function(){return{AND:"AND",OR:"OR"}}},{key:"SearchField",get:function(){return{MEMBER_NICKNAME:"member_nickname",CHANNEL_NAME:"channel_name"}}}]),n}(),qe=function(){function n(e){v(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.mutedMemberFilter=n.MutedMemberFilter.ALL,this.memberStateFilter=Ae.MemberStateFilter.ALL,this.nicknameStartsWithFilter=null,this.order=n.Order.MEMBER_NICKNAME_ALPHABETICAL,this._token="",this._channelUrl=e}return s(n,[{key:"next",value:function(e){var s=this;return Y(this._iid,function(i){var e=pe.get(s._iid),n=e.GroupChannel,a=e.Member,t=e.MemberListQuery;"number"==typeof s.limit&&0<s.limit&&-1<Object.keys(t.MutedMemberFilter).map(function(e){return t.MutedMemberFilter[e]}).indexOf(s.mutedMemberFilter)&&-1<Object.keys(n.MemberStateFilter).map(function(e){return n.MemberStateFilter[e]}).indexOf(s.memberStateFilter)&&-1<Object.keys(t.Order).map(function(e){return t.Order[e]}).indexOf(s.order)&&("string"==typeof s.nicknameStartsWithFilter||null===s.nicknameStartsWithFilter)?s.isLoading?i(new ye("Query in progress.",ye.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,_e.get(s._iid).container.apiClient.loadMemberList(g(g({},s),{},{channelUrl:s._channelUrl,token:s._token}),function(e,n){var t=null;if(!e){var r=String(n.next);s._token=r,s.hasNext=!!r,t=n.members.map(function(e){return new a(e)})}s.isLoading=!1,i(e,t)})):i(null,[]):i(j.error,null)},e)}}],[{key:"MutedMemberFilter",get:function(){return{ALL:"all",MUTED:"muted",UNMUTED:"unmuted"}}},{key:"Order",get:function(){return{MEMBER_NICKNAME_ALPHABETICAL:"member_nickname_alphabetical",OPERATOR_THEN_MEMBER_ALPHABETICAL:"operator_then_member_alphabetical"}}}]),n}(),ze=function(){function n(e){v(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this._token="",e.channelUrl&&(this._channelUrl=e.channelUrl),e.isOpenChannel&&(this._isOpenChannel=e.isOpenChannel)}return s(n,[{key:"next",value:function(e){var s=this;return Y(this._iid,function(a){"number"==typeof s.limit&&0<s.limit?s.isLoading?a(new ye("Query in progress.",ye.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,_e.get(s._iid).container.apiClient.loadMutedUserList(g(g({},s),{},{channelUrl:s._channelUrl,isOpenChannel:s._isOpenChannel,token:s._token}),function(e,n){var t=null;if(!e){var r=pe.get(s._iid).User,i=String(n.next);s._token=i,s.hasNext=!!i,t=n.muted_list.map(function(e){return new r(e)})}s.isLoading=!1,a(e,t)})):a(null,[]):a(j.error,null)},e)}}]),n}(),Qe=function(){function e(){v(this,e),this.limit=20,this.isLoading=!1,this.hasNext=!0,this.nameKeyword=null,this.urlKeyword=null,this.customTypes=[],this.includeFrozen=!0}return s(e,[{key:"next",value:function(e){var s=this;return Y(this._iid,function(a){!("number"==typeof s.limit&&0<s.limit&&Array.isArray(s.customTypes))||"string"!=typeof s.nameKeyword&&null!==s.nameKeyword||"string"!=typeof s.urlKeyword&&null!==s.urlKeyword||"boolean"!=typeof s.includeFrozen?a(j.error,null):s.isLoading?a(new ye("Query in progress.",ye.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,_e.get(s._iid).container.apiClient.loadOpenChannelList(g(g({},s),{},{token:s._token}),function(e,n){var t=null;if(!e){var r=pe.get(s._iid).OpenChannel,i=String(n.next);s._token=i,s.hasNext=!!i,t=n.channels.map(function(e){return r.upsert(e)})}s.isLoading=!1,a(e,t)})):a(null,[])},e)}}]),e}(),Ye=new WeakMap,Ke=function(){function n(e){v(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this._token="",Ye.set(this,e)}return s(n,[{key:"next",value:function(e){var s=this;return Y(this._iid,function(a){if("number"==typeof s.limit&&0<s.limit)if(s.isLoading)a(new ye("Query in progress.",ye.QUERY_IN_PROGRESS),null);else if(s.hasNext){s.isLoading=!0;var e=Ye.get(s);_e.get(s._iid).container.apiClient.loadOperatorList(g(g({},s),{},{token:s._token,channelUrl:e.url,isOpenChannel:e.isOpenChannel()}),function(e,n){var t=null;if(!e){var r=pe.get(s._iid).User,i=String(n.next);s._token=i,s.hasNext=!!i,t=n.operators.map(function(e){return new r(e)})}s.isLoading=!1,a(e,t)})}else a(null,[]);else a(j.error,null)},e)}}]),n}(),Ve=new WeakMap,We=function(){function n(e){v(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this._token="",e&&Ve.set(this,e.channelUrl)}return s(n,[{key:"next",value:function(e){var s=this;return Y(this._iid,function(a){"number"==typeof s.limit&&0<s.limit?s.isLoading?a(new ye("Query in progress.",ye.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,_e.get(s._iid).container.apiClient.loadParticipantList(g(g({},s),{},{channelUrl:Ve.get(s),token:s._token}),function(e,n){var t=null;if(!e){var r=pe.get(s._iid).User,i=String(n.next);s._token=i,s.hasNext=!!i,t=n.participants.map(function(e){return new r(e)})}s.isLoading=!1,a(e,t)})):a(null,[]):a(j.error,null)},e)}}]),n}(),Je=new WeakMap,Xe=function(){function m(e,n){var t=n.limit,r=void 0===t?20:t,i=n.reverse,a=void 0!==i&&i,s=n.exactMatch,o=void 0!==s&&s,l=n.channelUrl,u=void 0===l?"":l,c=n.channelCustomType,d=void 0===c?"":c,h=n.messageTimestampFrom,p=void 0===h?null:h,f=n.messageTimestampTo,g=void 0===f?null:f,_=n.order,y=void 0===_?"score":_;v(this,m),this.isLoading=!1,this.hasNext=!0,Je.set(this,{keyword:e,limit:r,reverse:a,exactMatch:o,channelUrl:u,channelCustomType:d,messageTimestampFrom:p,messageTimestampTo:g,order:y,previousToken:"",nextToken:""})}return s(m,[{key:"next",value:function(e){var h=this,n=pe.get(this._iid),p=n.BaseChannel,f=n.GroupChannel,g=n.OpenChannel;return Y(this._iid,function(s){var e=Je.get(h),n=e.keyword,t=e.limit,r=e.reverse,i=e.exactMatch,a=e.channelUrl,o=e.channelCustomType,l=e.messageTimestampFrom,u=e.messageTimestampTo,c=e.order,d=e.nextToken;!("number"==typeof t&&0<t&&t<=1e3&&"boolean"==typeof r&&"boolean"==typeof i)||"string"!=typeof a&&null!==a||"string"!=typeof o&&null!==o||"number"!=typeof l&&null!==l||"number"!=typeof u&&null!==u||!(0<=["score","ts"].indexOf(c))?s(j.error,null):h.isLoading?s(new ye("Query in progress.",ye.QUERY_IN_PROGRESS),null):h.hasNext?(h.isLoading=!0,_e.get(h._iid).container.apiClient.searchMessages({keyword:n,limit:t,reverse:r,exactMatch:i,channelUrl:a,channelCustomType:o,messageTimestampFrom:l,messageTimestampTo:u,order:c,nextToken:d},function(e,n){var t=null;if(!e){for(var r in t=[],n.results){var i=n.results[r],a=null;i.channel.hasOwnProperty("members")?(a=new f(i.channel),f.cachedChannels[a.url]=a):(a=new g(i.channel),g.cachedChannels[a.url]=a),t.push(p.buildMessage(i,a))}h.hasNext=n.has_next,Je.get(h).nextToken=n.end_cursor}h.isLoading=!1,s(e,t)})):s(null,[])},e)}},{key:"key",get:function(){return Je.get(this).keyword}},{key:"limit",get:function(){return Je.get(this).limit}},{key:"reverse",get:function(){return Je.get(this).reverse}},{key:"exactMatch",get:function(){return Je.get(this).exactMatch}},{key:"channelUrl",get:function(){return Je.get(this).channelUrl}},{key:"channelCustomType",get:function(){return Je.get(this).channelCustomType}},{key:"messageTimestampFrom",get:function(){return Je.get(this).messageTimestampFrom}},{key:"messageTimestampTo",get:function(){return Je.get(this).messageTimestampTo}},{key:"order",get:function(){return Je.get(this).order}}]),m}(),Ze=new WeakMap,$e=new WeakMap,en=function(){function n(e){v(this,n),this.isLoading=!1,this.hasMore=!0,this.limit=20,$e.set(this,Number.MAX_SAFE_INTEGER),Ze.set(this,e),this.reverse=!1,this.messageTypeFilter=null,this.customTypeFilter=null,this.senderUserIdsFilter=[],this.includeMetaArray=!1,this.includeReaction=null,this.includeReactions=!1,this.includeReplies=!1,this.includeParentMessageText=!1,this.includeThreadInfo=!1}return s(n,[{key:"load",value:function(s,n,t,e){var o=this,l=pe.get(this._iid).BaseChannel,r=null,i=B(j.parse(arguments,[new j({type:"number",optional:!0,defaultValue:this.limit}),new j({type:"boolean",optional:!0,defaultValue:this.reverse}),new j({type:["string","number"],optional:!0,defaultValue:this.messageTypeFilter,constraint:function(e){return-1<Object.keys(l.MessageTypeFilter).map(function(e){return l.MessageTypeFilter[e]}).indexOf(e)||-1<[0,1,2,3].indexOf(e)}}),new j({type:"callback"})]),5);return r=i[0],s=i[1],n=i[2],t=i[3],e=i[4],Y(this._iid,function(i){if(Array.isArray(o.senderUserIdsFilter)&&!o.senderUserIdsFilter.some(function(e){return"string"!=typeof e})||(r=j.error),r)i(r,null);else{if(o.limit=s,o.reverse=n,o.messageTypeFilter=t,"number"==typeof o.messageTypeFilter)switch(o.messageTypeFilter){case 0:o.messageTypeFilter=l.MessageTypeFilter.ALL;break;case 1:o.messageTypeFilter=l.MessageTypeFilter.USER;break;case 2:o.messageTypeFilter=l.MessageTypeFilter.FILE;break;case 3:o.messageTypeFilter=l.MessageTypeFilter.ADMIN}if(o.isLoading)i(new ye("Query in progress.",ye.QUERY_IN_PROGRESS),null);else if(o.hasMore){o.isLoading=!0;var a=Ze.get(o),e=_e.get(o._iid);"boolean"==typeof o.includeReaction&&o.includeReaction&&(o.includeReactions=o.includeReaction),e.container.apiClient.getMessageList({channel:a,token:$e.get(o)||(new Date).getTime()+1e4,tokenType:"timestamp",isInclusive:!1,prevResultSize:s,nextResultSize:0,shouldReverse:n,messageType:t,customType:o.customTypeFilter,senderUserIds:o.senderUserIdsFilter,includeMetaArray:o.includeMetaArray,includeReactions:o.includeReactions,includeReplies:o.includeReplies,includeParentMessageText:o.includeParentMessageText,includeThreadInfo:o.includeThreadInfo},function(e,n){var t=null;if(!e){(0===(t=n.messages.map(function(e){return l.buildMessage(e,a)})).length||t.length<s)&&(o.hasMore=!1);var r=$e.get(o);$e.set(o,Math.min.apply(Math,b(t.map(function(e){return e.createdAt})).concat([r])))}o.isLoading=!1,i(e,t)})}else i(null,[])}},e)}}]),n}(),nn=function(){function n(){v(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.includeEmpty=!1,this.order=xe.ORDER_LATEST_LAST_MESSAGE,this._token="",this.channelNameContainsFilter="",this.channelUrlsFilter=[],this.customTypesFilter=[],this.customTypeStartsWithFilter=null,this.superChannelFilter=Ae.SuperChannelFilter.ALL,this.membershipFilter=n.MembershipType.JOINED,this.metadataOrderKeyFilter=null,this.includeFrozen=!0}return s(n,[{key:"next",value:function(e){var s=this;return Y(this._iid,function(i){var a=pe.get(s._iid).GroupChannel;!("number"==typeof s.limit&&0<s.limit&&"boolean"==typeof s.includeEmpty&&"string"==typeof s.order&&-1<[n.ORDER_CHRONOLOGICAL,n.CHANNEL_NAME_ALPHABETICAL,n.METADATA_VALUE_ALPHABETICAL,n.ORDER_LATEST_LAST_MESSAGE].indexOf(s.order.toLowerCase())&&Array.isArray(s.customTypesFilter)&&Array.isArray(s.channelUrlsFilter)&&-1<Object.keys(n.MembershipType).map(function(e){return n.MembershipType[e]}).indexOf(s.membershipFilter)&&-1<Object.keys(a.SuperChannelFilter).map(function(e){return a.SuperChannelFilter[e]}).indexOf(s.superChannelFilter))||"string"!=typeof s.customTypeStartsWithFilter&&null!==s.customTypeStartsWithFilter||"string"!=typeof s.channelNameContainsFilter||"string"!=typeof s.metadataOrderKeyFilter&&null!==s.metadataOrderKeyFilter||"boolean"!=typeof s.includeFrozen?i(j.error,null):s.isLoading?i(new ye("Query in progress.",ye.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,_e.get(s._iid).container.apiClient.loadPublicGroupChannelList(g(g({},s),{},{token:s._token}),function(e,n){var t=null;if(!e){var r=String(n.next);s._token=r,s.hasNext=!!r,t=n.channels.map(function(e){return a.upsert(e)})}s.isLoading=!1,i(e,t)})):i(null,[])},e)}}],[{key:"MembershipType",get:function(){return{ALL:"all",JOINED:"joined"}}},{key:"ORDER_LATEST_LAST_MESSAGE",get:function(){return"latest_last_message"}},{key:"ORDER_CHRONOLOGICAL",get:function(){return"chronological"}},{key:"CHANNEL_NAME_ALPHABETICAL",get:function(){return"channel_name_alphabetical"}},{key:"METADATA_VALUE_ALPHABETICAL",get:function(){return"metadata_value_alphabetical"}}]),n}(),tn=function(){function e(){v(this,e),this.isDistinct=null,this.isSuper=null,this.isBroadcast=null,this.isPublic=null,this.channelUrl=null,this.isEphemeral=null,this.isDiscoverable=null,this.isStrict=null,this.name=null,this.data=null,this.customType=null,this.channelCover=null,this.coverUrl=null,this.coverImage=null,this.accessCode=null,this.messageSurvivalSeconds=null,this._invitedUserIds=[];var n=null;Object.defineProperty(this,"operators",{set:function(e){Array.isArray(e)&&e.filter(function(e){return e.hasOwnProperty("userId")}).length===e.length&&(n=e.map(function(e){return e.userId}))}}),Object.defineProperty(this,"operatorUserIds",{get:function(){return n},set:function(e){Array.isArray(e)&&e.filter(function(e){return"string"==typeof e}).length===e.length&&(n=e)}})}return s(e,[{key:"_validate",value:function(){return Array.isArray(this._invitedUserIds)&&this._invitedUserIds.every(function(e){return"string"==typeof e})&&("string"==typeof this.channelUrl||null===this.channelUrl)&&("string"==typeof this.coverUrl||null===this.coverUrl)&&(ve.isFile(this.coverImage)||null===this.coverImage)&&("string"==typeof this.name||null===this.name)&&("string"==typeof this.data||null===this.data)&&("string"==typeof this.customType||null===this.customType)&&("boolean"==typeof this.isDistinct||null===this.isDistinct)&&("boolean"==typeof this.isSuper||null===this.isSuper)&&("boolean"==typeof this.isBroadcast||null===this.isBroadcast)&&("boolean"==typeof this.isPublic||null===this.isPublic)&&("boolean"==typeof this.isEphemeral||null===this.isEphemeral)&&("boolean"==typeof this.isDiscoverable||null===this.isDiscoverable)&&("boolean"==typeof this.isStrict||null===this.isStrict)&&(Array.isArray(this.operatorUserIds)&&this.operatorUserIds.every(function(e){return"string"==typeof e})||null===this.operatorUserIds)&&("string"==typeof this.accessCode||null===this.accessCode)&&("number"==typeof this.messageSurvivalSeconds||null===this.messageSurvivalSeconds)}},{key:"addUsers",value:function(e){if(Array.isArray(e)){var n,t=e.filter(function(e){return e.hasOwnProperty("userId")&&"string"==typeof e.userId}).map(function(e){return e.userId});(n=this._invitedUserIds).push.apply(n,b(t))}}},{key:"addUser",value:function(e){e.hasOwnProperty("userId")&&"string"==typeof e.userId&&this._invitedUserIds.push(e.userId)}},{key:"addUserIds",value:function(e){if(Array.isArray(e)){var n,t=e.filter(function(e){return"string"==typeof e});(n=this._invitedUserIds).push.apply(n,b(t))}}},{key:"addUserId",value:function(e){"string"==typeof e&&this._invitedUserIds.push(e)}}]),e}(),rn=new WeakMap,an=function(){function e(){v(this,e),this._mentionType=e.MentionType.USERS,this._mentionedUserIds=[],this._cachedMentionedUsers=[],this._cachedMentionedUserIds=[],this._metaArrays=[],rn.set(this,null),this._parentMessageId=null}return s(e,[{key:"_validate",value:function(){var e=pe.get(this._iid),n=e.BaseMessageParams,t=e.MessageMetaArray,r=rn.get(this);return-1<Object.keys(n.MentionType).map(function(e){return n.MentionType[e]}).indexOf(this.mentionType)&&this._mentionedUserIds.every(function(e){return"string"==typeof e})&&Array.isArray(this._metaArrays)&&this._metaArrays.every(function(e){return e instanceof t})&&("number"==typeof r||null===r)&&("number"==typeof this._parentMessageId||null===this._parentMessageId)}},{key:"mentionType",get:function(){return this._mentionType},set:function(e){var n=pe.get(this._iid).BaseMessageParams;-1<Object.keys(n.MentionType).map(function(e){return n.MentionType[e]}).indexOf(e)&&(this._mentionType=e)}},{key:"mentionedUserIds",get:function(){return this._cachedMentionedUserIds},set:function(e){if(Array.isArray(e))for(var n=Sn.getInstance(this._iid),t=0;t<e.length;t++){var r=e[t];if("string"!=typeof r){this._cachedMentionedUserIds=[],this._mentionedUserIds=[];break}this._mentionedUserIds.indexOf(r)<0&&n.currentUser&&n.currentUser.userId!==r&&(this._cachedMentionedUserIds.push(r),this._mentionedUserIds.push(r))}}},{key:"mentionedUsers",get:function(){return this._cachedMentionedUsers},set:function(e){if(Array.isArray(e))for(var n=Sn.getInstance(this._iid),t=0;t<e.length;t++){var r=e[t];if(!r.hasOwnProperty("userId")){this._cachedMentionedUsers=[],this._mentionedUserIds=[];break}this._mentionedUserIds.indexOf(r.userId)<0&&n.currentUser&&n.currentUser.userId!==r.userId&&(this._cachedMentionedUsers.push(r),this._mentionedUserIds.push(r.userId))}}},{key:"metaArrayKeys",get:function(){return this._metaArrays.map(function(e){return e.key})},set:function(e){var n=pe.get(this._iid).MessageMetaArray,t={};if(Array.isArray(e)){this._metaArrays=[];for(var r=0;r<e.length;r++)"string"!=typeof e[r]||t[e[r]]||(t[e[r]]=!0,this._metaArrays.push(new n(e[r])))}}},{key:"metaArrays",get:function(){return this._metaArrays},set:function(e){var n=pe.get(this._iid).MessageMetaArray;if(Array.isArray(e)){this._metaArrays=[];for(var t=0;t<e.length;t++){var r=e[t];if(r instanceof n){var i,a=this._metaArrays.map(function(e){return e.key}).indexOf(r.key);if(a<0)this._metaArrays.push(r);else(i=this._metaArrays[a].value).push.apply(i,b(r.value))}}}}},{key:"rootMessageId",get:function(){return rn.get(this)}},{key:"parentMessageId",get:function(){return this._parentMessageId},set:function(e){rn.set(this,e),this._parentMessageId=e}}],[{key:"MentionType",get:function(){return{USERS:"users",CHANNEL:"channel"}}},{key:"PushNotificationDeliveryOption",get:function(){return{DEFAULT:"default",SUPPRESS:"suppress"}}}]),e}(),sn=function(){o(t,an);var n=h(t);function t(){var e;return v(this,t),(e=n.call(this)).message=null,e.data=null,e.customType=null,e.pushNotificationDeliveryOption=null,e._translationTargetLanguages=[],e}return s(t,[{key:"_validate",value:function(){var n=pe.get(this._iid).BaseMessageParams;return _(l(t.prototype),"_validate",this).call(this)&&("string"==typeof this.message||null===this.message)&&("string"==typeof this.data||null===this.data)&&("string"==typeof this.customType||null===this.customType)&&Array.isArray(this.translationTargetLanguages)&&this.translationTargetLanguages.every(function(e){return"string"==typeof e})&&(null===this.pushNotificationDeliveryOption||-1<Object.keys(n.PushNotificationDeliveryOption).map(function(e){return n.PushNotificationDeliveryOption[e]}).indexOf(this.pushNotificationDeliveryOption))}},{key:"targetLanguages",get:function(){return this.translationTargetLanguages},set:function(e){this.translationTargetLanguages=e}},{key:"translationTargetLanguages",get:function(){return this._translationTargetLanguages},set:function(e){if(Array.isArray(e)){for(var n=0;n<e.length;n++)if("string"!=typeof e[n])return void(this._translationTargetLanguages=[]);this._translationTargetLanguages=e}}}]),t}(),on=function(){o(t,an);var n=h(t);function t(){var e;return v(this,t),(e=n.call(this)).fileName=null,e.mimeType=null,e.fileSize=null,e.data=null,e.customType=null,e.pushNotificationDeliveryOption=null,e._isUpdate=!1,e._file=null,e._fileUrl=null,e._thumbnailSizes=[],e}return s(t,[{key:"_validate",value:function(){var n=pe.get(this._iid).BaseMessageParams;return _(l(t.prototype),"_validate",this).call(this)&&(this._isUpdate||ve.isFile(this.file)||"string"==typeof this.fileUrl)&&("string"==typeof this.fileName||null===this.fileName)&&("string"==typeof this.mimeType||null===this.mimeType)&&("number"==typeof this.fileSize||null===this.fileSize)&&("string"==typeof this.data||null===this.data)&&("string"==typeof this.customType||null===this.customType)&&(null===this._thumbnailSizes||this._thumbnailSizes.every(function(e){return"object"===fe(e)&&0<e.maxWidth&&0<e.maxHeight}))&&(null===this.pushNotificationDeliveryOption||-1<Object.keys(n.PushNotificationDeliveryOption).map(function(e){return n.PushNotificationDeliveryOption[e]}).indexOf(this.pushNotificationDeliveryOption))}},{key:"file",get:function(){return this._file},set:function(e){ve.isFile(e)&&(this._fileUrl=null,this._file=e)}},{key:"fileUrl",get:function(){return this._fileUrl},set:function(e){"string"==typeof e&&(this._fileUrl=e,this._file=null)}},{key:"thumbnailSizes",get:function(){return this._thumbnailSizes},set:function(e){if(Array.isArray(e)){for(var n=0;n<e.length;n++)if("object"!==fe(e[n])||"number"!=typeof e[n].maxWidth||"number"!=typeof e[n].maxHeight)return void(this._thumbnailSizes=[]);this._thumbnailSizes=e}}}]),t}(),ln=function(){o(r,sn);var t=h(r);function r(e){var n;return v(this,r),(n=t.call(this)).year=null,n.month=null,n.day=null,n.hour=null,n.min=null,n.timezone=null,n._scheduledDateTimeString=null,e&&n._update(e),n}return s(r,[{key:"_update",value:function(e){e.hasOwnProperty("message")&&(this.message=e.message),e.hasOwnProperty("year")&&(this.year=e.year),e.hasOwnProperty("month")&&(this.month=e.month),e.hasOwnProperty("day")&&(this.day=e.day),e.hasOwnProperty("hour")&&(this.hour=e.hour),e.hasOwnProperty("min")&&(this.min=e.min),e.hasOwnProperty("timezone")&&(this.timezone=e.timezone)}},{key:"_getScheduleString",value:function(){return this.scheduledDateTimeString?this.scheduledDateTimeString+" "+this.timezone:"number"==typeof this.year&&4===this.year.toString().length&&"number"==typeof this.month&&1<=this.month&&this.month<=12&&"number"==typeof this.day&&1<=this.day&&this.day<=31&&"number"==typeof this.hour&&0<=this.hour&&this.hour<=24&&"number"==typeof this.min&&0<=this.min&&this.min<=60&&"string"==typeof this.timezone&&0<this.timezone.length?this.year.toString()+"-"+("0"+this.month.toString()).substr(-2)+"-"+("0"+this.day.toString()).substr(-2)+" "+("0"+this.hour.toString()).substr(-2)+":"+("0"+this.min.toString()).substr(-2)+" "+this.timezone:null}},{key:"setSchedule",value:function(e,n,t,r,i,a){"number"==typeof e&&4===e.toString().length&&"number"==typeof n&&1<=n&&n<=12&&"number"==typeof t&&1<=t&&t<=31&&"number"==typeof r&&0<=r&&r<=24&&"number"==typeof i&&0<=i&&i<=60&&"string"==typeof a&&0<a.length&&(this.scheduledDateTimeString=e.toString()+"-"+("0"+n.toString()).substr(-2)+"-"+("0"+t.toString()).substr(-2)+" "+("0"+r.toString()).substr(-2)+":"+("0"+i.toString()).substr(-2),this.timezone=a)}},{key:"scheduledDateTimeString",get:function(){return this._scheduledDateTimeString?this._scheduledDateTimeString:"number"==typeof this.year&&4===this.year.toString().length&&"number"==typeof this.month&&1<=this.month&&this.month<=12&&"number"==typeof this.day&&1<=this.day&&this.day<=31&&"number"==typeof this.hour&&0<=this.hour&&this.hour<=24&&"number"==typeof this.min&&0<=this.min&&this.min<=60&&"string"==typeof this.timezone&&0<this.timezone.length?this.year.toString()+"-"+("0"+this.month.toString()).substr(-2)+"-"+("0"+this.day.toString()).substr(-2)+" "+("0"+this.hour.toString()).substr(-2)+":"+("0"+this.min.toString()).substr(-2):null},set:function(e){e&&"string"==typeof e&&(this._scheduledDateTimeString=e)}}]),r}(),un=function(){function e(){v(this,e),this.channelUrl=null,this.channelType=null,this.messageId=0,this.includeMetaArray=!1,this.includeParentMessageText=!1,this.includeThreadInfo=!1}return s(e,[{key:"_validate",value:function(){var e=pe.get(this._iid).BaseChannel;return"string"==typeof this.channelUrl&&"string"==typeof this.channelType&&[e.CHANNEL_TYPE_BASE,e.CHANNEL_TYPE_OPEN,e.CHANNEL_TYPE_GROUP].includes(this.channelType)&&"number"==typeof this.messageId&&"boolean"==typeof this.includeMetaArray&&"boolean"==typeof this.includeParentMessageText&&"boolean"==typeof this.includeThreadInfo}}]),e}(),cn=function(){function n(){v(this,n);var e=pe.get(this._iid).BaseChannel;this.prevResultSize=0,this.nextResultSize=0,this.isInclusive=!1,this.reverse=!1,this.messageType=e.MessageTypeFilter.ALL,this.customType=null,this.senderUserIds=null,this.includeMetaArray=!1,this.includeReaction=null,this.includeReactions=!1,this.includeReplies=!1,this.includeParentMessageText=!1,this.includeThreadInfo=!1}return s(n,[{key:"_validate",value:function(){"boolean"==typeof this.includeReaction&&this.includeReaction&&(this.includeReactions=this.includeReaction);var e=pe.get(this._iid).BaseChannel;return"number"==typeof this.prevResultSize&&"number"==typeof this.nextResultSize&&"boolean"==typeof this.isInclusive&&"boolean"==typeof this.reverse&&"string"==typeof this.messageType&&Object.values(e.MessageTypeFilter).includes(this.messageType)&&("string"==typeof this.customType||null===this.customType)&&(Array.isArray(this.senderUserIds)&&this.senderUserIds.every(function(e){return"string"==typeof e})||null===this.senderUserIds)&&"boolean"==typeof this.includeMetaArray&&"boolean"==typeof this.includeReactions&&"boolean"==typeof this.includeReplies&&"boolean"==typeof this.includeParentMessageText&&"boolean"==typeof this.includeThreadInfo}}]),n}(),dn=function(){function n(){v(this,n);var e=pe.get(this._iid).BaseChannel;this.prevResultSize=0,this.nextResultSize=0,this.isInclusive=!1,this.reverse=!1,this.messageType=e.MessageTypeFilter.ALL,this.customType=null,this.senderUserIds=null,this.includeMetaArray=!1,this.includeReaction=null,this.includeReactions=!1,this.includeParentMessageText=!1}return s(n,[{key:"_validate",value:function(){"boolean"==typeof this.includeReaction&&this.includeReaction&&(this.includeReactions=this.includeReaction);var e=pe.get(this._iid).BaseChannel;return"number"==typeof this.prevResultSize&&"number"==typeof this.nextResultSize&&"boolean"==typeof this.isInclusive&&"boolean"==typeof this.reverse&&"string"==typeof this.messageType&&Object.values(e.MessageTypeFilter).includes(this.messageType)&&("string"==typeof this.customType||null===this.customType)&&(Array.isArray(this.senderUserIds)&&this.senderUserIds.every(function(e){return"string"==typeof e})||null===this.senderUserIds)&&"boolean"==typeof this.includeMetaArray&&"boolean"==typeof this.includeReactions&&"boolean"==typeof this.includeParentMessageText}}]),n}(),hn=function(){function e(){v(this,e),this.includeMetaArray=!1,this.includeReaction=null,this.includeReactions=!1,this.includeReplies=!1,this.includeParentMessageText=!1,this.includeThreadInfo=!1}return s(e,[{key:"_validate",value:function(){return"boolean"==typeof this.includeReaction&&this.includeReaction&&(this.includeReactions=this.includeReaction),"boolean"==typeof this.includeMetaArray&&"boolean"==typeof this.includeReactions&&"boolean"==typeof this.includeReplies&&"boolean"==typeof this.includeParentMessageText&&"boolean"==typeof this.includeThreadInfo}}]),e}(),pn=function(){function e(){v(this,e),this.customTypes=[],this.includeEmpty=!1,this.includeFrozen=!0}return s(e,[{key:"_validate",value:function(){return(Array.isArray(this.customTypes)&&this.customTypes.every(function(e){return"string"==typeof e})||null===this.customTypes)&&("boolean"==typeof this.includeEmpty||null===this.includeEmpty)&&"boolean"==typeof this.includeFrozen}}]),e}(),fn=function(){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];v(this,t),this.key=e,this.value=Array.isArray(n)&&n.every(function(e){return"string"==typeof e})?n:[]}return s(t,[{key:"encode",value:function(){return{key:this.key,value:this.value||[]}}}]),t}(),gn=new WeakMap,_n=function(){function a(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;v(this,a),this.key=e,this.userIds=n,this.updatedAt=t;var r={};for(var i in this.userIds){r[this.userIds[i]]=this.updatedAt}gn.set(this,r)}return s(a,[{key:"serialize",value:function(){return{key:this.key,user_ids:this.userIds,updated_at:this.updatedAt}}},{key:"_applyEvent",value:function(e){if(e instanceof G){var n=gn.get(this);if(e.key===this.key&&(!n[e.userId]||n[e.userId]<e.updatedAt)){var t=this.userIds.indexOf(e.userId);switch(e.operation){case"add":t<0&&this.userIds.push(e.userId);break;case"delete":0<=t&&this.userIds.splice(t,1)}n[e.userId]=e.updatedAt}}}},{key:"isEmpty",get:function(){return 0===this.userIds.length}}],[{key:"createFromJson",value:function(e){var n=e.key,t=e.user_ids,r=e.updated_at;return"string"==typeof n&&n&&Array.isArray(t)&&0<t.length&&"number"==typeof r?new this(n,t,r):null}}]),a}(),yn=function(){function n(e){v(this,n),this.replyCount=0,this.mostRepliedUsers=[],this.lastRepliedAt=0,this.updatedAt=0,e&&this._update(e)}return s(n,[{key:"_update",value:function(e){var n=pe.get(this._iid).User;e.hasOwnProperty("reply_count")&&(this.replyCount=parseInt(e.reply_count)),e.hasOwnProperty("most_replies")&&Array.isArray(e.most_replies)&&e.most_replies.every(function(e){return"object"===fe(e)})&&(this.mostRepliedUsers=e.most_replies.map(function(e){return new n(e)})),e.hasOwnProperty("last_replied_at")&&(this.lastRepliedAt=parseInt(e.last_replied_at)),e.hasOwnProperty("updated_at")&&(this.updatedAt=parseInt(e.updated_at))}}],[{key:"objectify",value:function(e){var n=pe.get(this._iid).User,t=e.replyCount,r=e.mostRepliedUsers,i=e.lastRepliedAt,a=e.updatedAt,s={};return s.reply_count=t,Array.isArray(r)&&r.every(function(e){return e instanceof n})&&(s.most_replies=r.map(function(e){return n.objectify(e)})),s.last_replied_at=i,s.updated_at=a,s}},{key:"build",value:function(e,n,t,r){return this.objectify({replyCount:e,mostRepliedUsers:n,lastRepliedAt:t,updatedAt:r})}}]),n}(),mn=function(){function n(e){v(this,n),this.title=null,this.url=null,this.description=null,this.defaultImage=null,e&&this._update(e)}return s(n,[{key:"_update",value:function(e){var n=pe.get(this._iid).OGImage;e.hasOwnProperty("og:title")&&(this.title=e["og:title"]),e.hasOwnProperty("og:url")&&(this.url=e["og:url"]),e.hasOwnProperty("og:description")&&(this.description=e["og:description"]),e.hasOwnProperty("og:image")&&(this.defaultImage=new n(e["og:image"]))}}],[{key:"objectify",value:function(e){var n=pe.get(this._iid).OGImage,t=e.title,r=void 0===t?null:t,i=e.url,a=void 0===i?null:i,s=e.description,o=void 0===s?null:s,l=e.defaultImage,u=void 0===l?null:l,c={};return c["og:title"]=r,c["og:url"]=a,c["og:description"]=o,u&&(c["og:image"]=n.objectify(u)),c}}]),n}(),vn=function(){function n(e){v(this,n),this.url=null,this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,e&&this._update(e)}return s(n,[{key:"_update",value:function(e){e.hasOwnProperty("url")&&(this.url=e.url),e.hasOwnProperty("secure_url")&&(this.secureUrl=e.secure_url),e.hasOwnProperty("type")&&(this.type=e.type),e.hasOwnProperty("width")&&(this.width=parseInt(e.width)),e.hasOwnProperty("height")&&(this.height=parseInt(e.height)),e.hasOwnProperty("alt")&&(this.alt=e.alt)}}],[{key:"objectify",value:function(e){var n=e.url,t=void 0===n?null:n,r=e.secureUrl,i=void 0===r?null:r,a=e.type,s=void 0===a?null:a,o=e.width,l=void 0===o?0:o,u=e.height,c=void 0===u?0:u,d=e.alt,h=void 0===d?null:d,p={};return p.url=t,p.secure_url=i,p.type=s,p.width=l,p.height=c,p.alt=h,p}}]),n}(),Cn=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];v(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.userIds=e,this.metaDataKey="",this.metaDataValues=[],this._token=""}return s(n,[{key:"next",value:function(e){var s=this;return Y(this._iid,function(a){"number"==typeof s.limit&&0<s.limit&&Array.isArray(s.userIds)&&"string"==typeof s.metaDataKey&&Array.isArray(s.metaDataValues)&&!!s.metaDataKey==0<s.metaDataValues.length?s.isLoading?a(new ye("Query in progress.",ye.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,_e.get(s._iid).container.apiClient.loadUserList(g(g({},s),{},{userIdsFilter:s.userIds,metaDataKeyFilter:s.metaDataKey,metaDataValuesFilter:s.metaDataValues,token:s._token}),function(e,n){var t=null;if(!e){var r=pe.get(s._iid).User,i=String(n.next);s._token=i,s.hasNext=!!i,t=n.users.map(function(e){return new r(e)})}s.isLoading=!1,a(e,t)})):a(null,[]):a(j.error,null)},e)}}]),n}(),En=new WeakMap,Un=function(){function n(e){v(this,n),this.isLoading=!1,En.set(this,e)}return s(n,[{key:"prev",value:function(t,s,o,e){var l=arguments,u=this;return Y(this._iid,function(r){var e,i=pe.get(u._iid).BaseChannel,n=B(j.parse(l,[new j({type:"number"}),new j({type:"number"}),new j({type:"boolean"}),new j({type:"function"})]),5);if(e=n[0],t=n[1],s=n[2],o=n[3],r=n[4],e)r(e,null);else if(u.isLoading)r(new ye("Query in progress.",ye.QUERY_IN_PROGRESS),null);else{u.isLoading=!0;var a=En.get(u);_e.get(u._iid).container.apiClient.getMessageList({channelUrl:a.url,channelType:a.channelType,token:t,tokenType:"timestamp",isInclusive:!1,prevResultSize:s,nextResultSize:0,shouldReverse:o,messageType:"",customType:""},function(e,n){var t=null;e||(t=n.messages.map(function(e){return i.buildMessage(e,a)})),u.isLoading=!1,r(e,t)})}},e)}},{key:"next",value:function(t,s,o,e){var l=arguments,u=this;return Y(this._iid,function(r){var e,i=pe.get(u._iid).BaseChannel,n=B(j.parse(l,[new j({type:"number"}),new j({type:"number"}),new j({type:"boolean"}),new j({type:"function"})]),5);if(e=n[0],t=n[1],s=n[2],o=n[3],r=n[4],e)r(e,null);else if(u.isLoading)r(new ye("Query in progress.",ye.QUERY_IN_PROGRESS),null);else{u.isLoading=!0;var a=En.get(u);_e.get(u._iid).container.apiClient.getMessageList({channelUrl:a.url,channelType:a.channelType,token:t,tokenType:"timestamp",isInclusive:!1,prevResultSize:0,nextResultSize:s,shouldReverse:o,messageType:"",customType:""},function(e,n){var t=null;e||(t=n.messages.map(function(e){return i.buildMessage(e,a)})),u.isLoading=!1,r(e,t)})}},e)}},{key:"load",value:function(t,s,o,l,e){var u=arguments,c=this;return Y(this._iid,function(r){var e,i=pe.get(c._iid).BaseChannel,n=B(j.parse(u,[new j({type:"number"}),new j({type:"number"}),new j({type:"number"}),new j({type:"boolean"}),new j({type:"callback"})]),6);if(e=n[0],t=n[1],s=n[2],o=n[3],l=n[4],r=n[5],e)r(e,null);else if(c.isLoading)r(new ye("Query in progress.",ye.QUERY_IN_PROGRESS),null);else{c.isLoading=!0;var a=En.get(c);_e.get(c._iid).container.apiClient.getMessageList({channelUrl:a.url,channelType:a.channelType,token:t,tokenType:"timestamp",isInclusive:!1,prevResultSize:s,nextResultSize:o,shouldReverse:l,messageType:"",customType:""},function(e,n){var t=null;e||(t=n.messages.map(function(e){return i.buildMessage(e,a)})),c.isLoading=!1,r(e,t)})}},e)}}]),n}(),bn=null,An={},In=!1,Sn=function(){function o(e){v(this,o);var n=!1;if((e.newInstance||!bn||bn&&e.appId!==bn.getApplicationId()&&bn.getConnectionState()===bn.ConnectionState.CLOSED)&&(n=!0,bn=this),n){try{if(!e.hasOwnProperty("appId"))return me.debug("Must be set appId"),null}catch(e){return me.debug("Must be set appId"),null}var t=le.create();Object.defineProperty(this,"_iid",{get:function(){return t}}),(An[t]=this).customApiHost=null,this.customWsHost=null,this.connecting=!1,this.reconnecting=!1,this.isReconnectingOnError=!1,this.connectionCallbacks=[],this.ConnectionManager=new P(this),this.GCMPushToken="",this.APNSPushToken="",this.PUSH_TEMPLATE_DEFAULT="default",this.PUSH_TEMPLATE_ALTERNATIVE="alternative",this.currentUser=null,this.isSessionOpened=!1,this.globalTimer,this.loginTimer,this.reconnectTimer,this.loginHandler=null,this.onLoginTimerCancel,this.onReconnectTimerCancel,this.BaseChannel={MessageTypeFilter:Z.MessageTypeFilter};var r={User:J,Member:Ie,GroupChannel:Ae,OpenChannel:Oe,UserMessage:Le,FileMessage:Pe,AdminMessage:we,GroupChannelListQuery:xe,MemberListQuery:qe,GroupChannelParams:tn,BaseMessageParams:an,UserMessageParams:sn,FileMessageParams:on,ScheduledUserMessageParams:ln,GroupChannelTotalUnreadMessageCountParams:re,MessageRetrievalParams:un,MessageListParams:cn,ThreadedMessageListParams:dn,MessageChangeLogsParams:hn,GroupChannelChangeLogsParams:pn,MessageMetaArray:fn,UserEventHandler:ae,ChannelHandler:se,ConnectionHandler:ie},i={BaseChannel:Z,BaseMessage:W,UserListQuery:Cn,ApplicationUserListQuery:Fe,BannedUserListQuery:Ge,BlockedUserListQuery:Be,FriendListQuery:je,MutedUserListQuery:ze,OpenChannelListQuery:Qe,OperatorListQuery:Ke,ParticipantListQuery:We,MessageListQuery:Un,PreviousMessageListQuery:en,MessageSearchQuery:Xe,PublicGroupChannelListQuery:nn,ScheduledUserMessage:De,ThreadInfo:yn,ThreadInfoUpdateEvent:He,OGMetaData:mn,OGImage:vn,Command:H,Sender:Se,ReadStatus:oe,Reaction:_n,ReactionEvent:G,Emoji:Re,EmojiCategory:ke,EmojiContainer:Ne,FileMessageQueue:te},a=new pe(this._iid,g(g({},r),i));for(var s in a)r[s]&&(this[s]=a[s]);_e.create(t,{appId:e.appId,pinger:new S(this),apiClient:new T(this),wsAdapter:new L(this),commandHandler:new $(this),onlineDetector:new w(this),ackStateMap:{},subscribedUnreadMessageCount:{all:0,custom_types:{},ts:0},maxUnreadCountOfSuperGroupChannel:ge.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,auth:new U,appInfo:null,pingInterval:15e3,pongTimeout:5e3,connectedAt:0,extensions:{},supportedExtensionKeys:["sb_uikit","sb_syncmanager"],getUserAgentWithExtensions:function(e){var n=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",t=e.sb_uikit?"u".concat(e.sb_uikit):"";return"JS/c".concat(ge.SDK_VERSION,"/").concat(n,"/").concat(t)},stateChangeEnabled:!0,isInBackground:!1,closedByGoingBackground:!1,isErrorFirstInCallback:!1}),this.userEventHandlers={},this.channelHandlers={},this.connectionHandlers={},this.Options={_useMemberAsMessageSender:!0,get UseMemberAsMessageSender(){return this._useMemberAsMessageSender},set UseMemberAsMessageSender(e){"boolean"==typeof e&&(this._useMemberAsMessageSender=e)},get useMemberAsMessageSender(){return this._useMemberAsMessageSender},set useMemberAsMessageSender(e){"boolean"==typeof e&&(this._useMemberAsMessageSender=e)},_typingIndicatorThrottle:1e3,get typingIndicatorThrottle(){return this._typingIndicatorThrottle},set typingIndicatorThrottle(e){"number"==typeof e&&1e3<=e&&e<=9e3&&(this._typingIndicatorThrottle=e)},_websocketResponseTimeout:1e4,get websocketResponseTimeout(){return this._websocketResponseTimeout},set websocketResponseTimeout(e){"number"==typeof e&&5e3<=e&&e<=3e5&&(this._websocketResponseTimeout=e)}}}return bn}return s(o,[{key:"getApplicationId",value:function(){return _e.get(this._iid).get("appId")}},{key:"getCurrentUserId",value:function(){return this.currentUser?this.currentUser.userId:null}},{key:"getDebugMode",value:function(){return In}},{key:"setDebugMode",value:function(e){In=e,me.mode=e?me.Mode.DEBUG:me.Mode.PRODUCTION}},{key:"getErrorFirstCallback",value:function(){return _e.get(this._iid).container.isErrorFirstInCallback}},{key:"setErrorFirstCallback",value:function(e){"boolean"==typeof e&&_e.get(this._iid).set("isErrorFirstInCallback",e)}},{key:"getCurrentApiHost",value:function(){return this.customApiHost?this.customApiHost:"https://api.sendbird.com"}},{key:"clearCurrentApiHost",value:function(){this.customApiHost=null}},{key:"getCurrentWsHost",value:function(){return this.customWsHost?this.customWsHost:"wss://ws.sendbird.com"}},{key:"clearCurrentWsHost",value:function(){this.customWsHost=null}},{key:"getConnectionState",value:function(){try{var e=_e.get(this._iid).container.wsAdapter;return this.connecting||this.reconnecting?this.ConnectionState.CONNECTING:e.ws?this.connecting||this.reconnecting?this.ConnectionState.CONNECTING:this.isSessionOpened?e.ws.getConnectionState():this.ConnectionState.CLOSED:this.ConnectionState.CLOSED}catch(e){return this.ConnectionState.CLOSED}}},{key:"getPendingGCMToken",value:function(){return this.GCMPushToken}},{key:"getPendingAPNSToken",value:function(){return this.APNSPushToken}},{key:"hasLoggedIn",value:function(){var e=_e.get(this._iid);return this.currentUser&&e.get("auth").hasSession()}},{key:"getLastConnectedAt",value:function(){var e=_e.get(this._iid);return this.getConnectionState()===this.ConnectionState.OPEN&&this.currentUser?e.get("connectedAt"):0}},{key:"connect",value:function(n,t,r,i,e){var a=this,s=_e.get(this._iid).container,o=s.wsAdapter,l=s.onlineDetector;l&&l.start();var u,c=B(j.parse(arguments,[new j({type:"string",constraint:function(e){return 0<e.length}}),new j({type:"string",nullable:!0,ignoreIf:function(e){return 1===e.length||3===e.length}}),new j({type:"string",nullable:!0,ignoreIf:function(e){return 1===e.length||2===e.length}}),new j({type:"string",nullable:!0,ignoreIf:function(e){return 1===e.length||2===e.length}}),new j({type:"callback"})]),6);return u=c[0],n=c[1],t=c[2],r=c[3],i=c[4],e=c[5],Y(this._iid,function(e){u?e(u,null):(a.customApiHost=r,a.customWsHost=i,a.connecting=!0,a.reconnecting=!1,a.isReconnectingOnError=!1,a.reconnectTimer&&(clearTimeout(a.reconnectTimer),a.reconnectTimer=null,a.onReconnectTimerCancel=null),a.getConnectionState()===a.ConnectionState.OPEN&&a.currentUser&&a.currentUser.userId===n?(a.connecting=!1,e(null,a.currentUser)):(a.connectionCallbacks.push(e),1===a.connectionCallbacks.length&&(o.disconnect({clearSession:!0,err:null},null),o.connect(n,t))))},e)}},{key:"reconnect",value:function(){var e=_e.get(this._iid).container,n=e.wsAdapter;if(e.auth.sessionKey&&this.currentUser){var t=!0;return 0<n.reconnectCount&&(t=!1),n.disconnect({clearSession:!1,err:new ye("Connection has been canceled.",ye.CONNECTION_CANCELED)},null),n.reconnectCount=0,n.reconnect(this.currentUser.userId,t),!0}return!1}},{key:"disconnect",value:function(e){var i=this;return Y(this._iid,function(e){var n=_e.get(i._iid).container,t=n.wsAdapter,r=n.onlineDetector;r&&r.stop(),t.disconnect({clearSession:!0,err:new ye("Connection has been canceled.",ye.CONNECTION_CANCELED)},e)},e)}},{key:"setBackgroundState",value:function(){var e=_e.get(this._iid),n=e.container,t=n.wsAdapter,r=n.stateChangeEnabled;!n.isInBackground&&r&&(e.set("isInBackground",!0),this.getConnectionState()!==this.ConnectionState.CLOSED?(e.set("closedByGoingBackground",!0),t.disconnect({clearSession:!1,err:new ye("Websocket connection failed.",ye.WEBSOCKET_CONNECTION_FAILED)},null)):e.set("closedByGoingBackground",!1))}},{key:"setForegroundState",value:function(){var e=_e.get(this._iid),n=e.container,t=n.wsAdapter,r=n.stateChangeEnabled,i=n.isInBackground,a=n.closedByGoingBackground;i&&r&&(e.set("isInBackground",!1),a&&this.currentUser&&t.reconnect(this.currentUser.userId,!0))}},{key:"enableStateChange",value:function(){_e.get(this._iid).set("enableStateChange",!0)}},{key:"disableStateChange",value:function(){_e.get(this._iid).set("enableStateChange",!1)}},{key:"addExtension",value:function(e,n){var t=_e.get(this._iid).container,r=t.extensions;-1<t.supportedExtensionKeys.indexOf(e)&&(r[e]=n)}},{key:"createUserListQuery",value:function(e){return new(pe.get(this._iid).UserListQuery)(e)}},{key:"createApplicationUserListQuery",value:function(){return new(pe.get(this._iid).ApplicationUserListQuery)}},{key:"createBlockedUserListQuery",value:function(){return new(pe.get(this._iid).BlockedUserListQuery)}},{key:"createFriendListQuery",value:function(){return new(pe.get(this._iid).FriendListQuery)}},{key:"createMessageSearchQuery",value:function(e,n){return new(pe.get(this._iid).MessageSearchQuery)(e,n)}},{key:"sendCommand",value:function(l,e){var u=this;return Y(this._iid,function(o){u.ConnectionManager.ready(function(e,n){if(e)o(e,null);else{var t=_e.get(u._iid).container,r=t.wsAdapter,i=t.ackStateMap;if(null==r||null==r.ws||r.ws.getConnectionState()!==u.ConnectionState.OPEN||u.getConnectionState()!==u.ConnectionState.OPEN)return void o(new ye("Connection is not valid. Please reconnect.",ye.WEBSOCKET_CONNECTION_CLOSED),null);if(l.isAckRequired){var a=l.requestId,s={handler:o,timer:setTimeout(function(){o(new ye("Command received no ack.",ye.ACK_TIMEOUT),null),delete i[a]},u.Options.websocketResponseTimeout)};i[a]=s,r.ws.send(l,function(e){e&&(clearTimeout(s.timer),o(e,null))})}else r.ws.send(l,o)}},!1)},e)}},{key:"addUserEventHandler",value:function(e,n){n instanceof pe.get(this._iid).UserEventHandler&&(this.userEventHandlers[e]=n)}},{key:"removeUserEventHandler",value:function(e){delete this.userEventHandlers[e]}},{key:"removeAllUserEventHandler",value:function(){this.userEventHandlers={}}},{key:"addChannelHandler",value:function(e,n){n instanceof pe.get(this._iid).ChannelHandler&&(this.channelHandlers[e]=n)}},{key:"removeChannelHandler",value:function(e){delete this.channelHandlers[e]}},{key:"removeAllChannelHandlers",value:function(){this.channelHandlers={}}},{key:"addConnectionHandler",value:function(e,n){n instanceof pe.get(this._iid).ConnectionHandler&&(this.connectionHandlers[e]=n)}},{key:"removeConnectionHandler",value:function(e){delete this.connectionHandlers[e]}},{key:"removeAllConnectionHandlers",value:function(){this.connectionHandlers={}}},{key:"updateCurrentUserInfo",value:function(i,a,e){var n,s=this,t=B(j.parse(arguments,[new j({type:"string",nullable:!0}),new j({type:"string",nullable:!0}),new j({type:"callback"})]),4);return n=t[0],i=t[1],a=t[2],e=t[3],Y(this._iid,function(r){n?r(n,null):_e.get(s._iid).container.apiClient.updateCurrentUserInfo({nickname:i,profileUrl:a},function(e,n){var t=null;e||(s.currentUser&&(i&&(s.currentUser.nickname=i),a&&(s.currentUser.plainProfileUrl=a)),t=s.currentUser),r(e,t)})},e)}},{key:"updateCurrentUserInfoWithProfileImage",value:function(i,e,n){var t,a=this,r=B(j.parse(arguments,[new j({type:"string",nullable:!0}),new j({type:"file",nullable:!0}),new j({type:"callback"})]),4);return t=r[0],i=r[1],e=r[2],n=r[3],Y(this._iid,function(r){t?r(t,null):_e.get(a._iid).container.apiClient.updateCurrentUserInfo({nickname:i,profileImage:e},function(e,n){var t=null;e||(a.currentUser&&(i&&(a.currentUser.nickname=i),n.profile_url&&(a.currentUser.plainProfileUrl=n.profile_url)),t=a.currentUser),r(e,t)})},n)}},{key:"updateCurrentUserInfoWithPreferredLanguages",value:function(i,e){var n,a=this,t=B(j.parse(arguments,[new j({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new j({type:"callback"})]),3);return n=t[0],i=t[1],e=t[2],Y(this._iid,function(r){n?r(n,null):_e.get(a._iid).container.apiClient.updateCurrentUserInfo({preferredLanguages:i},function(e,n){var t=null;e||(a.currentUser&&i&&(a.currentUser._preferredLanguages=i),t=a.currentUser),r(e,t)})},e)}},{key:"registerGCMPushTokenForCurrentUser",value:function(e,n){var t,i=this,r=B(j.parse(arguments,[new j({type:"string",constraint:function(e){return 0<e.length}}),new j({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],Y(this._iid,function(r){t?r(t,i.pushTokenRegistrationState.ERROR):i.currentUser?_e.get(i._iid).container.apiClient.registerGCMPushToken({token:e},function(e,n){var t=i.pushTokenRegistrationState.ERROR;e||(i.GCMPushToken="",t=i.pushTokenRegistrationState.SUCCESS),r(e,t)}):(i.GCMPushToken=e,r(null,i.pushTokenRegistrationState.PENDING))},n)}},{key:"unregisterGCMPushTokenForCurrentUser",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"string",constraint:function(e){return 0<e.length}}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):i.currentUser?_e.get(i._iid).container.apiClient.unregisterGCMPushToken({token:e},function(e,n){t(e,null)}):(i.GCMPushToken=e,t(null,i.pushTokenRegistrationState.PENDING))},n)}},{key:"unregisterGCMPushTokenAllForCurrentUser",value:function(e){var n=this;return Y(this._iid,function(t){_e.get(n._iid).container.apiClient.unregisterAllGCMPushTokens({},function(e,n){t(e,null)})},e)}},{key:"registerAPNSPushTokenForCurrentUser",value:function(e,n){var t,i=this,r=B(j.parse(arguments,[new j({type:"string",constraint:function(e){return 0<e.length}}),new j({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],Y(this._iid,function(r){t?r(t,i.pushTokenRegistrationState.ERROR):i.currentUser?_e.get(i._iid).container.apiClient.registerAPNSPushToken({token:e},function(e,n){var t=i.pushTokenRegistrationState.ERROR;e||(i.APNSPushToken="",t=i.pushTokenRegistrationState.SUCCESS),r(e,t)}):(i.APNSPushToken=e,r(null,i.pushTokenRegistrationState.PENDING))},n)}},{key:"unregisterAPNSPushTokenForCurrentUser",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"string",constraint:function(e){return 0<e.length}}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):i.currentUser?_e.get(i._iid).container.apiClient.unregisterAPNSPushToken({token:e},function(e,n){t(e,null)}):(i.APNSPushToken=e,t(null,i.pushTokenRegistrationState.PENDING))},n)}},{key:"unregisterAPNSPushTokenAllForCurrentUser",value:function(e){var n=this;return Y(this._iid,function(t){_e.get(n._iid).container.apiClient.unregisterAllAPNSPushTokens({},function(e,n){t(e,null)})},e)}},{key:"unregisterPushTokenAllForCurrentUser",value:function(e){var n=this;return Y(this._iid,function(t){_e.get(n._iid).container.apiClient.unregisterAllPushTokens({},function(e,n){t(e,null)})},e)}},{key:"getMyGroupChannelChangeLogsByToken",value:function(e,n,t,r){var l=this,i=null,a=B(j.parse(arguments,[new j({type:"string",nullable:!0}),new j({type:"array",optional:!0,nullable:!0,defaultValue:null}),new j({type:"boolean",nullable:!0,optional:!0,defaultValue:null}),new j({type:"callback"})]),5);i=a[0],e=a[1],n=a[2],t=a[3],r=a[4];var s=pe.get(this._iid).GroupChannelChangeLogsParams,u=null;if(i){var o=B(j.parse(arguments,[new j({type:"string",nullable:!0}),new j({type:s,constraint:function(e){return e._validate()}}),new j({type:"callback"})]),4);i=o[0],e=o[1],u=o[2],r=o[3]}else(u=new s).customTypes=n,u.includeEmpty=t,u.includeFrozen=!0;return Y(this._iid,function(o){i?o(i,null):_e.get(l._iid).container.apiClient.getMyGroupChannelChangeLogs(g({ts:null,token:e},u),function(e,n){if(e)o(e,null);else{var t=pe.get(l._iid).GroupChannel,r=n.updated.map(function(e){return new t(e)}),i=n.deleted,a=n.has_more,s=n.next;o(null,{updatedChannels:r,deletedChannelUrls:i,hasMore:a,token:s})}})},r)}},{key:"getMyGroupChannelChangeLogsByTimestamp",value:function(e,n,t,r){var l=this,i=null,a=B(j.parse(arguments,[new j({type:"number",constraint:function(e){return 0<=e}}),new j({type:"array",optional:!0,nullable:!0,defaultValue:null}),new j({type:"boolean",nullable:!0,optional:!0,defaultValue:null}),new j({type:"callback"})]),5);i=a[0],e=a[1],n=a[2],t=a[3],r=a[4];var s=pe.get(this._iid).GroupChannelChangeLogsParams,u=null;if(i){var o=B(j.parse(arguments,[new j({type:"number",constraint:function(e){return 0<=e}}),new j({type:s,constraint:function(e){return e._validate()}}),new j({type:"callback"})]),4);i=o[0],e=o[1],u=o[2],r=o[3]}else(u=new s).customTypes=n,u.includeEmpty=t,u.includeFrozen=!0;return Y(this._iid,function(o){i?o(i,null):_e.get(l._iid).container.apiClient.getMyGroupChannelChangeLogs(g({ts:e,token:null},u),function(e,n){if(e)o(e,null);else{var t=pe.get(l._iid).GroupChannel,r=n.updated.map(function(e){return new t(e)}),i=n.deleted,a=n.has_more,s=n.next;o(null,{updatedChannels:r,deletedChannelUrls:i,hasMore:a,token:s})}})},r)}},{key:"getChannelInvitationPreference",value:function(e){var n=this;return Y(this._iid,function(r){_e.get(n._iid).container.apiClient.getChannelInvitationPreference({},function(e,n){var t=null;e||(t={autoAccept:n.auto_accept}),r(e,t)})},e)}},{key:"setChannelInvitationPreference",value:function(e,n){var t,i=this,r=B(j.parse(arguments,[new j({type:"boolean"}),new j({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],Y(this._iid,function(r){t?r(t,null):_e.get(i._iid).container.apiClient.setChannelInvitationPreference({isAutoAccept:e},function(e,n){var t=null;e||(t={autoAccept:n.auto_accept}),r(e,t)})},n)}},{key:"getDoNotDisturb",value:function(e){var n=this;return Y(this._iid,function(r){_e.get(n._iid).container.apiClient.getDoNotDisturb({},function(e,n){var t=null;e||(t={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone}),r(e,t)})},e)}},{key:"setDoNotDisturb",value:function(e,n,t,i,a,s,r){var o,l=this,u=B(j.parse(arguments,[new j({type:"boolean"}),new j({type:"number",constraint:function(e){return 0<=e&&e<=23}}),new j({type:"number",constraint:function(e){return 0<=e&&e<=59}}),new j({type:"number",constraint:function(e){return 0<=e&&e<=23}}),new j({type:"number",constraint:function(e){return 0<=e&&e<=59}}),new j({type:"string"}),new j({type:"callback"})]),8);return o=u[0],e=u[1],n=u[2],t=u[3],i=u[4],a=u[5],s=u[6],r=u[7],Y(this._iid,function(r){o?r(o,null):_e.get(l._iid).container.apiClient.setDoNotDisturb({doNotDisturbOn:e,startHour:n,startMin:t,endHour:i,endMin:a,timezone:s},function(e,n){var t=null;e||(t={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone}),r(e,t)})},r)}},{key:"getSnoozePeriod",value:function(e){var n=this;return Y(this._iid,function(r){_e.get(n._iid).container.apiClient.getSnoozePeriod({},function(e,n){var t=null;e||(t={isSnoozeOn:n.snooze_enabled,startTs:n.snooze_start_ts,endTs:n.snooze_end_ts}),r(e,t)})},e)}},{key:"setSnoozePeriod",value:function(e,n,t,r){var i,a=this,s=B(j.parse(arguments,[new j({type:"boolean"}),new j({type:"number",constraint:function(e){return 0<e}}),new j({type:"number",constraint:function(e){return 0<e}}),new j({type:"callback"})]),5);return i=s[0],e=s[1],n=s[2],t=s[3],r=s[4],Y(this._iid,function(r){i?r(i,null):_e.get(a._iid).container.apiClient.setSnoozePeriod({snoozeOn:e,startTs:n,endTs:t},function(e,n){var t=null;e||(t={isSnoozeOn:n.snooze_enabled,startTs:n.snooze_start_ts,endTs:n.snooze_end_ts}),r(e,t)})},r)}},{key:"blockUser",value:function(e,n){var t,r=B(j.parse(arguments,[new j({type:"object",constraint:function(e){return e&&e.hasOwnProperty("userId")}}),new j({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],t?Y(this._iid,function(e){e(t,null)},n):this.blockUserWithUserId(e.userId,n)}},{key:"blockUserWithUserId",value:function(e,n){var t,i=this,r=B(j.parse(arguments,[new j({type:"string",constraint:function(e){return e&&(!i.currentUser||e!==i.currentUser.userId)}}),new j({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],Y(this._iid,function(r){t?r(t,null):_e.get(i._iid).container.apiClient.blockUser({blockedUserId:e},function(e,n){var t=null;e||(t=new J(n)),r(e,t)})},n)}},{key:"unblockUser",value:function(e,n){var t,r=B(j.parse(arguments,[new j({type:"object",constraint:function(e){return e&&e.hasOwnProperty("userId")}}),new j({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],t?Y(this._iid,function(e){e(t,null)},n):this.unblockUserWithUserId(e.userId,n)}},{key:"unblockUserWithUserId",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"string",constraint:function(e){return e&&(!i.currentUser||e!==i.currentUser.userId)}}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.unblockUser({unblockedUserId:e},function(e,n){t(e,null)})},n)}},{key:"getPushTriggerOption",value:function(e){var n=this;return Y(this._iid,function(t){_e.get(n._iid).container.apiClient.getPushTriggerOption({},function(e,n){t(e,n?n.push_trigger_option:null)})},e)}},{key:"setPushTriggerOption",value:function(e,n){var r=this;return Y(this._iid,function(t){-1<Object.keys(r.PushTriggerOption).map(function(e){return r.PushTriggerOption[e]}).indexOf(e)?_e.get(r._iid).container.apiClient.setPushTriggerOption({pushTriggerOption:e},function(e,n){t(e,n?n.push_trigger_option:null)}):t(j.error,null)},n)}},{key:"getGroupChannelCount",value:function(e,n){var t,i=this,r=pe.get(this._iid).GroupChannel,a=B(j.parse(arguments,[new j({type:r.MemberStateFilter,optional:!0,defaultValue:r.MemberStateFilter.ALL}),new j({type:"callback"})]),3);return t=a[0],e=a[1],n=a[2],Y(this._iid,function(r){t?r(t,null):_e.get(i._iid).container.apiClient.getGroupChannelCount({memberStateFilter:e},function(e,n){var t=null;e||(t=parseInt(n.group_channel_count)),r(e,t)})},n)}},{key:"getTotalUnreadChannelCount",value:function(e){var n=this;return Y(this._iid,function(r){_e.get(n._iid).container.apiClient.getTotalUnreadChannelCount({},function(e,n){var t=null;e||(t=parseInt(n.unread_count)),r(e,t)})},e)}},{key:"getTotalUnreadMessageCount",value:function(t,e){var i,a=this,n=pe.get(this._iid),s=n.GroupChannel,o=n.GroupChannelTotalUnreadMessageCountParams,r=B(j.parse(arguments,[new j({type:"object",optional:!0,defaultValue:null,constraint:function(e){return Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||e instanceof o}}),new j({type:"callback"})]),3);return i=r[0],t=r[1],e=r[2],Y(this._iid,function(r){if(i)r(i,null);else{var e=s.SuperChannelFilter.ALL;if(t instanceof o){var n=t;t=n.channelCustomTypesFilter,e=n.superChannelFilter}_e.get(a._iid).container.apiClient.getTotalUnreadMessageCount({customTypesFilter:t,superChannelFilter:e},function(e,n){var t=null;e||(t=parseInt(n.unread_count)),r(e,t)})}},e)}},{key:"getUnreadItemCount",value:function(r,e){var n,i=this,t=B(j.parse(arguments,[new j({type:"array",constraint:function(e){return 0<e.length&&e.every(function(e){return-1<Object.keys(Ae.UnreadItemKey).map(function(e){return Ae.UnreadItemKey[e]}).indexOf(e)})}}),new j({type:"callback"})]),3);return n=t[0],r=t[1],e=t[2],Y(this._iid,function(t){if(n)t(n,null);else{var e=r.filter(function(e,n){return r.indexOf(e)===n});_e.get(i._iid).container.apiClient.getUnreadItemCount({keys:e},function(e,n){t(e,n)})}},e)}},{key:"getSubscribedTotalUnreadMessageCount",value:function(){var e=_e.get(this._iid).container.subscribedUnreadMessageCount;return 0<=e.all?e.all:0}},{key:"getSubscribedCustomTypeTotalUnreadMessageCount",value:function(){var e=_e.get(this._iid).container.subscribedUnreadMessageCount;if(0<Object.keys(e.custom_types).length){var n=0;for(var t in e.custom_types)n+=e.custom_types[t];return n}return 0}},{key:"getSubscribedCustomTypeUnreadMessageCount",value:function(e){if(e&&"string"==typeof e){var n=_e.get(this._iid).container.subscribedUnreadMessageCount;return n.custom_types.hasOwnProperty(e)?n.custom_types[e]:0}return 0}},{key:"getMyPushTokensByToken",value:function(e,n,t){var i,a=this,r=B(j.parse(arguments,[new j({type:"string"}),new j({type:"string",constraint:function(e){return-1<["gcm","apns","apns_voip"].indexOf(e)}}),new j({type:"callback"})]),4);return i=r[0],e=r[1],n=r[2],t=r[3],Y(this._iid,function(r){i?r(i,null):_e.get(a._iid).container.apiClient.getPushTokens({ts:null,token:e,type:n},function(e,n){if(e)r(e,null);else{var t=n.type;r(null,{deviceTokens:n.device_tokens,type:t?t.toLowerCase():"unknown",hasMore:n.has_more,token:n.token})}})},t)}},{key:"getPushTemplate",value:function(e){var n=this;return Y(this._iid,function(r){_e.get(n._iid).container.apiClient.getPushTemplate({},function(e,n){var t=null;e||(t=n.name.toString()),r(e,t)})},e)}},{key:"setPushTemplate",value:function(e,n){var t=this;return Y(this._iid,function(r){-1<[t.PUSH_TEMPLATE_DEFAULT,t.PUSH_TEMPLATE_ALTERNATIVE].indexOf(e)?_e.get(t._iid).container.apiClient.setPushTemplate({templateName:e},function(e,n){var t=null;e||(t=n.name.toString()),r(e,t)}):r(j.error,null)},n)}},{key:"markAsReadAll",value:function(e){var s=this;return Y(this._iid,function(r){var i=pe.get(s._iid).GroupChannel,a=(new Date).getTime();a-i.markAsReadAllLastSentAt<1e3?r(new ye("MarkAsRead rate limit exceeded.",ye.MARK_AS_READ_RATE_LIMIT_EXCEEDED),null):(i.markAsReadAllLastSentAt=a,_e.get(s._iid).container.apiClient.markAsReadAll({channelUrls:null},function(e,n){if(!e)for(var t in i.cachedChannels)s.currentUser&&i.cachedChannels[t].updateReadReceipt(s.currentUser.userId,a),i.cachedChannels[t]._setGroupChannelUnreadCount(0,0);r(e,null)}))},e)}},{key:"markAsReadWithChannelUrls",value:function(s,e){var n,o=this,t=B(j.parse(arguments,[new j({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new j({type:"callback"})]),3);return n=t[0],s=t[1],e=t[2],Y(this._iid,function(i){if(n)i(n,null);else{var a=(new Date).getTime();_e.get(o._iid).container.apiClient.markAsReadAll({channelUrls:s},function(e,n){if(!e)for(var t in s){var r=s[t];Ae.cachedChannels[r]&&(o.currentUser&&Ae.cachedChannels[r].updateReadReceipt(o.currentUser.userId,a),Ae.cachedChannels[r]._setGroupChannelUnreadCount(0,0))}i(e,null)})}},e)}},{key:"markAsDelivered",value:function(e){"string"==typeof e&&pe.get(this._iid).GroupChannel.getChannel(e,ge.INTERNAL_CALL,function(e,n){e||n.markAsDelivered()})}},{key:"getFriendChangeLogsByToken",value:function(e,n){var t,a=this,r=B(j.parse(arguments,[new j({type:"string",optional:!0,defaultValue:null}),new j({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],Y(this._iid,function(i){t?i(t,null):_e.get(a._iid).container.apiClient.getFriendChangeLogsByToken({token:e},function(e,n){var t=null;if(!e){var r=pe.get(a._iid).User;t={updatedUsers:n.updated.map(function(e){return new r(e)}),deletedUserIds:n.deleted,hasMore:n.has_more,token:n.next}}i(e,t)})},n)}},{key:"uploadFriendDiscoveries",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"array",constraint:function(e){return e.every(function(e){return e.hasOwnProperty("friendDiscoveryKey")})}}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.uploadFriendDiscoveries({discoveries:e},function(e,n){t(e,n)})},n)}},{key:"deleteFriendDiscovery",value:function(e,n){var t,r=B(j.parse(arguments,[new j({type:"string"}),new j({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],t?Y(this._iid,function(e){e(t,null)},n):this.deleteFriendDiscoveries([e],n)}},{key:"deleteFriendDiscoveries",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.deleteFriendDiscoveries({discoveryKeys:e},function(e,n){t(e,n)})},n)}},{key:"addFriends",value:function(e,n){var t,a=this,r=B(j.parse(arguments,[new j({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new j({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],Y(this._iid,function(i){t?i(t,null):_e.get(a._iid).container.apiClient.addFriends({userIds:e},function(e,n){var t=null;if(!e){var r=pe.get(a._iid).User;t=n.users.map(function(e){return new r(e)})}i(e,t)})},n)}},{key:"deleteFriend",value:function(e,n){var t,r=B(j.parse(arguments,[new j({type:"string"}),new j({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],t?Y(this._iid,function(e){e(t,null)},n):this.deleteFriends([e],n)}},{key:"deleteFriends",value:function(e,n){var r,i=this,t=B(j.parse(arguments,[new j({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new j({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],Y(this._iid,function(t){r?t(r,null):_e.get(i._iid).container.apiClient.deleteFriends({userIds:e},function(e,n){t(e,n)})},n)}},{key:"getAllEmoji",value:function(e){var n,i=this,t=B(j.parse(arguments,[new j({type:"callback"})]),2);return n=t[0],e=t[1],Y(this._iid,function(r){n?r(n,null):_e.get(i._iid).container.apiClient.getAllEmoji(function(e,n){if(e)r(e,null);else{var t=new(pe.get(i._iid).EmojiContainer)(n);r(null,t)}})},e)}},{key:"getEmojiCategory",value:function(e,n){var t,i=this,r=B(j.parse(arguments,[new j({type:"number",constraint:function(e){return 0<=e}}),new j({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],Y(this._iid,function(r){t?r(t,null):_e.get(i._iid).container.apiClient.getEmojiCategory({categoryId:e},function(e,n){if(e)r(e,null);else{var t=new(pe.get(i._iid).EmojiCategory)(n);r(null,t)}})},n)}},{key:"getEmoji",value:function(e,n){var t,i=this,r=B(j.parse(arguments,[new j({type:"string"}),new j({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],Y(this._iid,function(r){t?r(t,null):_e.get(i._iid).container.apiClient.getEmoji({emojiKey:e},function(e,n){if(e)r(e,null);else{var t=new(pe.get(i._iid).Emoji)(n);r(null,t)}})},n)}},{key:"ConnectionState",get:function(){return{CONNECTING:"CONNECTING",OPEN:"OPEN",CLOSED:"CLOSED"}}},{key:"MessageRequestState",get:function(){return{NONE:"none",PENDING:"pending",FAILED:"failed",SUCCEEDED:"succeeded"}}},{key:"MessageSendingStatus",get:function(){return{NONE:"none",PENDING:"pending",FAILED:"failed",CANCELED:"canceled",SUCCEEDED:"succeeded"}}},{key:"pushTokenRegistrationState",get:function(){return{SUCCESS:"success",PENDING:"pending",ERROR:"error"}}},{key:"PushTriggerOption",get:function(){return{ALL:"all",MENTION_ONLY:"mention_only",OFF:"off"}}},{key:"appInfo",get:function(){return _e.get(this._iid).container.appInfo}},{key:"ekey",get:function(){var e=_e.get(this._iid).container.auth;return e?e.eKey:""}}],[{key:"getInstance",value:function(e){return e?An[e]:bn}},{key:"version",get:function(){return ge.SDK_VERSION}}]),o}();return Sn});